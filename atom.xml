<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å°å…µæ—­æ—­çš„åšå®¢</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://summxu.github.io/"/>
  <updated>2023-08-25T10:01:39.586Z</updated>
  <id>https://summxu.github.io/</id>
  
  <author>
    <name>summxu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç°ä»£CSSè§£å†³æ–¹æ¡ˆï¼šåŸç”Ÿæ”¯æŒçš„ä¸‰è§’å‡½æ•°</title>
    <link href="https://summxu.github.io/2023/%E7%8E%B0%E4%BB%A3CSS%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%E7%9A%84%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0/"/>
    <id>https://summxu.github.io/2023/ç°ä»£CSSè§£å†³æ–¹æ¡ˆï¼šåŸç”Ÿæ”¯æŒçš„ä¸‰è§’å‡½æ•°/</id>
    <published>2023-08-25T06:11:48.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CSS-ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»"><a href="#CSS-ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»" class="headerlink" title="CSS ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»"></a>CSS ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»</h2><p>é¦–å…ˆçœ‹çœ‹ CSS ä¸‰è§’å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="comment">/* è®¾ç½®å…ƒç´ çš„å®½åº¦ä¸º sin(30deg) çš„å€¼ */</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(sin(30deg) * <span class="number">100px</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* åæ­£å¼¦ æ ¹æ®å¼§åº¦å€¼è¿”å›å¯¹åº”çš„è§’åº¦å€¼ */</span></span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(asin(-0.2));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* è®¾ç½®å…ƒç´ çš„é«˜åº¦ä¸º cos(45deg) çš„å€¼ */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(cos(45deg) * <span class="number">100%</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* è®¾ç½®å…ƒç´ çš„é€æ˜åº¦ä¸º tan(60deg) çš„å€¼ */</span></span><br><span class="line">  <span class="attribute">opacity</span>: <span class="built_in">calc</span>(tan(60deg));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨äº† calc() å‡½æ•°è¿›è¡Œäº†è®¡ç®—ï¼Œç„¶åé€šè¿‡ sin()ã€cos() å’Œ tan() å‡½æ•°å¯¹è®¡ç®—ç»“æœè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä»è€Œå®ç°äº†ä¸åŒçš„æ•ˆæœã€‚</p><p>ä¸‰è§’å‡½æ•°åœ¨ CSS3 ä¸­ä»…å¯¹å¼§åº¦ï¼ˆradianï¼‰å•ä½è¿›è¡Œæ”¯æŒã€‚å¦‚æœæƒ³è¦åœ¨å¼€å‘ä¸­ä½¿ç”¨ä¸‰è§’å‡½æ•°ï¼Œå¯ä»¥å€ŸåŠ©è½¬æ¢å‡½æ•° deg() å’Œ rad() å°†è§’åº¦ï¼ˆdegreeï¼‰å’Œå¼§åº¦è¿›è¡Œè½¬æ¢ã€‚</p><p>CSS3 çš„è¿™äº›å‡½æ•°ä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿å¤„ç†ä¸€äº›å¤æ‚çš„æ•°å­¦é—®é¢˜ï¼Œå¢å¼ºäº† CSS çš„è¡¨ç°åŠ›ã€‚</p><h2 id="ä¸‰è§’å‡½æ•°çš„è¿åŠ¨è½¨è¿¹"><a href="#ä¸‰è§’å‡½æ•°çš„è¿åŠ¨è½¨è¿¹" class="headerlink" title="ä¸‰è§’å‡½æ•°çš„è¿åŠ¨è½¨è¿¹"></a>ä¸‰è§’å‡½æ•°çš„è¿åŠ¨è½¨è¿¹</h2><p>ä¸‰è§’å‡½æ•°çš„è¿ç”¨ï¼Œå¯ä»¥ä½“ç°åœ¨åŠ¨ç”»å½“ä¸­ã€‚ä»¥æ­£å¼¦ã€ä½™å¼¦å‡½æ•°ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">property</span> --angle &#123;</span><br><span class="line">  syntax: '&lt;angle&gt;';</span><br><span class="line">  <span class="selector-tag">inherits</span>: <span class="selector-tag">false</span>;</span><br><span class="line">  <span class="selector-tag">initial-value</span>: 0<span class="selector-tag">deg</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">property</span> --dis &#123;</span><br><span class="line">  syntax: '&lt;length&gt;';</span><br><span class="line">  <span class="selector-tag">inherits</span>: <span class="selector-tag">false</span>;</span><br><span class="line">  <span class="selector-tag">initial-value</span>: 0<span class="selector-tag">px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.g-single</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: move <span class="number">5s</span> infinite ease-in-out;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(calc(var(--dis) - <span class="number">40vw</span>),</span><br><span class="line">      <span class="built_in">calc</span>(5 * sin(var(--angle)) * <span class="number">1em</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> move &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">--dis</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">--angle</span>: <span class="number">0deg</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">--dis</span>: <span class="number">80vw</span>;</span><br><span class="line">    <span class="attribute">--angle</span>: <span class="number">1080deg</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„æ ¸å¿ƒåœ¨äºè¿™ä¸€æ®µä»£ç  <code>-- transform: translate(calc(var(--dis) - 40vw), calc(5 * sin(var(--angle)) * 1em))</code><br>å†…éƒ¨ä½¿ç”¨äº†ä¸¤ä¸ª CSS @property å˜é‡ï¼š</p><ol><li>x è½´æ–¹å‘æ˜¯ <code>0px</code> åˆ° <code>80vw</code> çš„æ°´å¹³ä½ç§»åŠ¨ç”»</li><li>y è½´æ–¹å‘æ˜¯ <code>5 * sin(0deg) * 1em</code> åˆ° <code>5 * sin(1080deg) * 1em</code> çš„ç«–ç›´åŠ¨ç”»</li></ol><p>é€šè¿‡åŠ¨ç”»ï¼ŒåŠ¨æ€çš„ä¿®æ”¹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸‰è§’å‡½æ•°æ›²çº¿åŠ¨ç”»å›¾å½¢ï¼š</p><iframe src="../../html/sinAnimation.html" scrolling="no" width="100%" height="200px" frameborder="0"></iframe><h2 id="CSS-é’Ÿè¡¨"><a href="#CSS-é’Ÿè¡¨" class="headerlink" title="CSS é’Ÿè¡¨"></a>CSS é’Ÿè¡¨</h2><p>é’Ÿè¡¨ä¸Š1-12æŠ˜12ä¸ªæ•°å­—æŒ‰ç…§åœ†å½¢ç­‰é—´è·æ’å¸ƒï¼Œä¹Ÿæ˜¯CSSä¸‰è§’å‡½æ•°çš„å…¸å‹åº”ç”¨ã€‚</p><p>æ’ç‰ˆå®šä½çš„ç›¸å…³ä»£ç ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span> &#123;</span><br><span class="line">  <span class="attribute">--x</span>: <span class="built_in">calc</span>(var(--radius) + (<span class="built_in">var</span>(--radius) * <span class="built_in">cos</span>(var(--index) * <span class="number">30deg</span>)));</span><br><span class="line">  <span class="attribute">--y</span>: <span class="built_in">calc</span>(var(--radius) + (<span class="built_in">var</span>(--radius) * <span class="built_in">sin</span>(var(--index) * <span class="number">30deg</span>)));</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">place-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2em</span>; <span class="attribute">width</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="built_in">var</span>(--x);</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">var</span>(--y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(1)</span> &#123; <span class="attribute">--index</span>: <span class="number">9</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(2)</span> &#123; <span class="attribute">--index</span>: <span class="number">10</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(3)</span> &#123; <span class="attribute">--index</span>: <span class="number">11</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(4)</span> &#123; <span class="attribute">--index</span>: <span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(5)</span> &#123; <span class="attribute">--index</span>: <span class="number">1</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(6)</span> &#123; <span class="attribute">--index</span>: <span class="number">2</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(7)</span> &#123; <span class="attribute">--index</span>: <span class="number">3</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(8)</span> &#123; <span class="attribute">--index</span>: <span class="number">4</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(9)</span> &#123; <span class="attribute">--index</span>: <span class="number">5</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(10)</span> &#123; <span class="attribute">--index</span>: <span class="number">6</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(11)</span> &#123; <span class="attribute">--index</span>: <span class="number">7</span>; &#125;</span><br><span class="line"><span class="selector-class">.clock-face</span> <span class="selector-tag">time</span><span class="selector-pseudo">:nth-child(12)</span> &#123; <span class="attribute">--index</span>: <span class="number">8</span>; &#125;</span><br></pre></td></tr></table></figure><p>å®ç°çš„æ•ˆæœï¼ˆå®Œæ•´çš„ä»£ç å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹iframeçš„æºä»£ç ä¿¡æ¯ï¼‰ï¼š</p><iframe src="../../html/cssClock.html" width="100%" height="340px" scrolling="no" frameborder="0"></iframe><h2 id="CSS-æ•°å­¦å‡½æ•°"><a href="#CSS-æ•°å­¦å‡½æ•°" class="headerlink" title="CSS æ•°å­¦å‡½æ•°"></a>CSS æ•°å­¦å‡½æ•°</h2><ul><li>sqrt() æ±‚å¹³æ–¹æ ¹</li><li>pow() å¹‚æŒ‡æ•°</li><li>exp() è‡ªç„¶å¸¸æ•°eä¸ºåº•çš„æŒ‡æ•°å‡½æ•°</li><li>log() å¯¹æ•°å‡½æ•°</li><li>abs() ç»å¯¹å€¼</li><li>round() å››èˆäº”å…¥</li><li>sign() æ­£è´Ÿé›¶åˆ¤æ–­</li><li>â€¦.</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>CSS åŸç”Ÿæ”¯æŒçš„ä¸‰è§’å‡½æ•°ï¼Œç»™ CSS æ‰“å¼€äº†æ›´å¤šçš„å¯èƒ½æ€§ï¼Œè¿™ä¹Ÿå¯¼è‡´ CSS çš„å¤æ‚åº¦ä¹Ÿæ˜¯æ„ˆæ¥æ„ˆé«˜ï¼ŒCSS å·²ç»ä¸å†æ˜¯éå¸¸çº¯ç²¹çš„è´Ÿè´£æ ·å¼äº†ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¾ˆå¤šè®¡ç®—ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ CSS å½“ä¸­å®Œæˆã€‚è‡³äºå¥½åï¼Œæˆ–è®¸å·²ç»æˆäº†ä¸€ä¸ªå“²å­¦é—®é¢˜ã€‚</p><p>è®°å½•ä¸¤ä¸ªcssé¡¹ç›®ï¼Œæœ€åä¸€ä¸ªç›¸å½“ç‚¸è£‚ï¼š</p><p><a href="https://css-doodle.com/" target="_blank" rel="noopener">css-doodle</a></p><p><a href="https://keithclark.co.uk/labs/css-fps/" target="_blank" rel="noopener">css-fps-demo</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CSS-ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»&quot;&gt;&lt;a href=&quot;#CSS-ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;CSS ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»&quot;&gt;&lt;/a&gt;CSS ä¸‰è§’å‡½æ•°è¯­æ³•ä»‹ç»&lt;/h2&gt;&lt;p&gt;é¦–å…ˆçœ‹çœ‹ CSS ä¸‰è§’å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼š&lt;/p&gt;
&lt;figur
      
    
    </summary>
    
    
    
      <category term="CSS" scheme="https://summxu.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>Piniaä½¿ç”¨å’Œæºç è§£æ</title>
    <link href="https://summxu.github.io/2023/Pinia%E4%BD%BF%E7%94%A8%E5%92%8C%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://summxu.github.io/2023/Piniaä½¿ç”¨å’Œæºç è§£æ/</id>
    <published>2023-06-26T01:36:37.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ›å»ºpinia"><a href="#åˆ›å»ºpinia" class="headerlink" title="åˆ›å»ºpinia"></a>åˆ›å»ºpinia</h2><p>åŸºæœ¬ä½¿ç”¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br><span class="line"><span class="comment">//vue2 ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia, PiniaVuePlugin &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line">Vue.use(PiniaVuePlugin)</span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>, </span><br><span class="line">  pinia,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="createPinia"><a href="#createPinia" class="headerlink" title="createPinia"></a>createPinia</h2><ul><li>å°†piniaç»‘å®šåˆ°å®ä¾‹ä¸Š</li><li>åˆ›å»ºä¸€ä¸ªscopeç”¨æ¥ä¿å­˜ä¹‹ååˆ›å»ºçš„æ¯ä¸€ä¸ªstoreçš„stateï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡pinia.state.value[storeId]ç›´æ¥è®¾ç½®state</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ceatePinia.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createPinia</span>(<span class="params"></span>): <span class="title">Pinia</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸ªscope effctæ¥å•ç‹¬ç®¡ç†state</span></span><br><span class="line">  <span class="keyword">const</span> scope = effectScope(<span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// é€šè¿‡pinia.state.value[storeId]ä¼šä¿å­˜ä¹‹ååˆ›å»ºçš„storeçš„state</span></span><br><span class="line">  <span class="keyword">const</span> state = scope.run&lt;Ref&lt;Record&lt;<span class="built_in">string</span>, StateTree&gt;&gt;&gt;<span class="function">(<span class="params">(<span class="params"></span>) =&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    ref&lt;Record&lt;<span class="built_in">string</span>, StateTree&gt;&gt;(<span class="params">&#123;&#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)!</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">  // æ’ä»¶ç›¸å…³</span></span><br><span class="line"><span class="function">  <span class="params">let</span> _<span class="params">p</span>: <span class="params">Pinia</span>['_<span class="params">p</span>'] = []</span></span><br><span class="line"><span class="function">  // <span class="params">plugins</span> <span class="params">added</span> <span class="params">before</span> <span class="params">calling</span> <span class="params">app</span>.<span class="params">use</span>(<span class="params">pinia</span>)</span></span><br><span class="line"><span class="function">  <span class="params">let</span> <span class="params">toBeInstalled</span>: <span class="params">PiniaPlugin</span>[] = []</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">  // <span class="params">markRaw</span>æ ‡è®°<span class="params">pinia</span>ä¸å¯è¢«ä»£ç†,é¿å…å­˜åœ¨ç”¨æˆ·å°†å…¶å“åº”å¼åŒ–å½±å“æ€§èƒ½çš„æƒ…å†µ</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">pinia</span>: <span class="params">Pinia</span> = <span class="params">markRaw</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    install(<span class="params">app: App</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// è®¾ç½®å½“å‰æ´»è·ƒçš„piniaï¼Œæ–¹ä¾¿å…¶ä»–åœ°æ–¹è·å–</span></span></span></span><br><span class="line"><span class="function"><span class="params">      setActivePinia(<span class="params">pinia</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">if</span> (<span class="params">!isVue2</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        pinia._a = app</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="comment">// å†…éƒ¨é€šè¿‡injectè·å–pinia,å› ä¸ºpiniaSymbolæ²¡æœ‰å¯¼å‡ºï¼Œæ‰€ä»¥å¼€å‘è€…æ— æ³•é€šè¿‡injectè·å–pinia</span></span></span></span><br><span class="line"><span class="function"><span class="params">        app.provide(<span class="params">piniaSymbol, pinia</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="comment">// é€šè¿‡app.config.globalPropertieså°†piniaæŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹ä¸Š</span></span></span></span><br><span class="line"><span class="function"><span class="params">        app.config.globalProperties.$pinia = pinia</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">if</span> (<span class="params">USE_DEVTOOLS</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">          registerPiniaDevtools(<span class="params">app, pinia</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">        &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">        toBeInstalled.forEach(<span class="params">(<span class="params">plugin</span>) =&gt; _p.push(<span class="params">plugin</span>)</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">        toBeInstalled = []</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// piniaæ’ä»¶ç›¸å…³ï¼Œæš‚ä¸åˆ†æ</span></span></span></span><br><span class="line"><span class="function"><span class="params">    use(<span class="params">plugin</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">if</span> (<span class="params">!<span class="keyword">this</span>._a &amp;&amp; !isVue2</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        toBeInstalled.push(<span class="params">plugin</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        _p.push(<span class="params">plugin</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">return</span> <span class="keyword">this</span></span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    _p,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// it's actually undefined here</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// @ts-expect-error</span></span></span></span><br><span class="line"><span class="function"><span class="params">    _a: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    _e: scope,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// æ¯ä¸ªåˆ›å»ºçš„storeéƒ½ä¼šæ”¾åœ¨è¿™ä¸ªMapé‡Œ</span></span></span></span><br><span class="line"><span class="function"><span class="params">    _s: <span class="keyword">new</span> Map&lt;<span class="built_in">string</span>, StoreGeneric&gt;(<span class="params"></span>),</span></span></span><br><span class="line"><span class="function"><span class="params">    state,</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  //...</span></span><br><span class="line"><span class="function">  <span class="params">return</span> <span class="params">pinia</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®ã€è·å–pinia"><a href="#è®¾ç½®ã€è·å–pinia" class="headerlink" title="è®¾ç½®ã€è·å–pinia"></a>è®¾ç½®ã€è·å–pinia</h2><ul><li>piniaä¼šè¢«ä¿å­˜åˆ°ä¸€ä¸ªå…¨å±€å˜é‡ä¸Šï¼Œå†…éƒ¨å¯ä»¥é€šè¿‡setActivePiniaã€getActivePiniaå¿«é€Ÿè·å–åˆ°piniaï¼Œç„¶åä½¿ç”¨ä¸Šä¸€æ­¥æŒ‚åœ¨piniaä¸Šçš„å±æ€§æˆ–æ–¹æ³•</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//rootStore.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> activePinia: Pinia | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setActivePinia = <span class="function">(<span class="params">pinia: Pinia | <span class="literal">undefined</span></span>) =&gt;</span></span><br><span class="line">  (activePinia = pinia)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// å¦‚æœåœ¨vueç»„ä»¶ä¸­ï¼Œé€šè¿‡injectè·å–ï¼ˆåœ¨createPiniaä¸­å¯¼å‡ºï¼‰ã€å¦åˆ™ç›´æ¥å–å…¨å±€å˜é‡ </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getActivePinia = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  (getCurrentInstance() &amp;&amp; inject(piniaSymbol)) || activePinia</span><br></pre></td></tr></table></figure><h2 id="å…¼å®¹vue2"><a href="#å…¼å®¹vue2" class="headerlink" title="å…¼å®¹vue2"></a>å…¼å®¹vue2</h2><ul><li>çœ‹è¿‡vuexçš„è¿™æ®µåº”è¯¥å¾ˆç†Ÿæ‚‰</li><li>é€šè¿‡Object.definePropertyä»¿é€ äº†ä¸ªProvideåŠŸèƒ½</li><li>é€šè¿‡mixinså°†piniaæ³¨å…¥åˆ°æ¯ä¸€ä¸ªç»„ä»¶ä¸­</li></ul><p>PiniaVuePlugin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//vue2-plugin.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PiniaVuePlugin: Plugin = <span class="function"><span class="keyword">function</span> (<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  _Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="keyword">const</span> options = <span class="keyword">this</span>.$options</span><br><span class="line">      <span class="keyword">if</span> (options.pinia) &#123;</span><br><span class="line">      <span class="comment">// è·å–æ³¨å†Œåˆ°æ ¹ç»„ä»¶ä¸Šçš„pinia</span></span><br><span class="line">        <span class="keyword">const</span> pinia = options.pinia <span class="keyword">as</span> Pinia</span><br><span class="line">        <span class="comment">// é€šè¿‡Object.definePropertyå®ç°çš„hackç‰ˆprovidã€inject...</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">as</span> <span class="built_in">any</span>)._provided) &#123;</span><br><span class="line">          <span class="keyword">const</span> provideCache = &#123;&#125;</span><br><span class="line">          <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, <span class="string">'_provided'</span>, &#123;</span><br><span class="line">            <span class="keyword">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> provideCache,</span><br><span class="line">            <span class="keyword">set</span>: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">Object</span>.assign(provideCache, v),</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        ;(<span class="keyword">this</span> <span class="keyword">as</span> <span class="built_in">any</span>)._provided[piniaSymbol <span class="keyword">as</span> <span class="built_in">any</span>] = pinia</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.$pinia) &#123;</span><br><span class="line">          <span class="keyword">this</span>.$pinia = pinia</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pinia._a = <span class="keyword">this</span> <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">        <span class="keyword">if</span> (IS_CLIENT) &#123;</span><br><span class="line">          <span class="comment">// this allows calling useStore() outside of a component setup after</span></span><br><span class="line">          <span class="comment">// installing pinia's plugin</span></span><br><span class="line">          setActivePinia(pinia)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (USE_DEVTOOLS) &#123;</span><br><span class="line">          registerPiniaDevtools(pinia._a, pinia)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>.$pinia &amp;&amp; options.parent &amp;&amp; options.parent.$pinia) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$pinia = options.parent.$pinia</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    destroyed() &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>._pStores</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºstore"><a href="#åˆ›å»ºstore" class="headerlink" title="åˆ›å»ºstore"></a>åˆ›å»ºstore</h2><p>åˆ›å»ºstoreçš„ä¸‰ç§æ–¹å¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useUserStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> useUserStore = defineStore(&#123;</span><br><span class="line">  id: <span class="string">'counter'</span>,</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> useUserStore = defineStore(<span class="string">'counter'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    count.value++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123; count, increment &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="defineStore"><a href="#defineStore" class="headerlink" title="defineStore"></a>defineStore</h2><ul><li>ä¸»è¦æ ¹æ®defineStoreçš„ä¸åŒæ–¹å¼é€‰æ‹©è°ƒç”¨å‡½æ•°å¼createSetupStoreè¿˜æ˜¯é€‰é¡¹å¼createOptionsStore</li><li>åˆ›å»ºå¥½çš„storeä¼šæ ¹æ®defineStoreæ—¶ä¼ å…¥çš„idï¼ŒæŒ‚è½½åˆ°pinia._sè¿™ä¸ªmapä¸Š</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// <span class="doctag">TODO:</span> add proper types from above</span></span></span></span><br><span class="line"><span class="function"><span class="params">  idOrOptions: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup?: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  setupOptions?: <span class="built_in">any</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">StoreDefinition</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> id: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">let</span> options</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> isSetupStore = <span class="keyword">typeof</span> setup === <span class="string">'function'</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æŠ¹å¹³ä¸åŒæ ¼å¼å‚æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> idOrOptions === <span class="string">'string'</span>) &#123;</span><br><span class="line">    id = idOrOptions</span><br><span class="line">    options = isSetupStore ? setupOptions : setup</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    options = idOrOptions</span><br><span class="line">    id = idOrOptions.id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœ€ç»ˆäº¤ç»™å¼€å‘è€…è·å–storeçš„æ–¹æ³•</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">useStore</span>(<span class="params">pinia?: Pinia | <span class="literal">null</span>, hot?: StoreGeneric</span>): <span class="title">StoreGeneric</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> currentInstance = getCurrentInstance()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨currentInstanceè¯´æ˜åœ¨vueç»„ä»¶ä¸­ï¼Œé€šè¿‡injectè·å–åˆ°pinia</span></span><br><span class="line">    pinia =</span><br><span class="line">      (__TEST__ &amp;&amp; activePinia &amp;&amp; activePinia._testing ? <span class="literal">null</span> : pinia) ||</span><br><span class="line">      (currentInstance &amp;&amp; inject(piniaSymbol, <span class="literal">null</span>))</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//è®¾ç½®å½“å‰æ´»è·ƒçš„piniaå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªpiniaå¯¹è±¡ï¼Œæ–¹ä¾¿å¿«é€Ÿè·å–å½“å‰piniaå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (pinia) setActivePinia(pinia)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; !activePinia) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">`[ğŸ]: getActivePinia was called with no active Pinia. Did you forget to install pinia?\n`</span> +</span><br><span class="line">          <span class="string">`\tconst pinia = createPinia()\n`</span> +</span><br><span class="line">          <span class="string">`\tapp.use(pinia)\n`</span> +</span><br><span class="line">          <span class="string">`This will fail in production.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»rootStoreæ–‡ä»¶ä¸­å–çš„å…¨å±€å˜é‡</span></span><br><span class="line">    pinia = activePinia!</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰åˆ›å»ºè¿‡idå¯¹åº”çš„store,åˆ™ä¼šè°ƒç”¨createSetupStoreæˆ–createOptionsStoreè¿›è¡Œåˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> (!pinia._s.has(id)) &#123;</span><br><span class="line">      <span class="comment">// åŒºåˆ†ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°è¿˜æ˜¯optionså¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (isSetupStore) &#123;</span><br><span class="line">        createSetupStore(id, setup, options, pinia)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createOptionsStore(id, options <span class="keyword">as</span> <span class="built_in">any</span>, pinia)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error: not the right inferred type</span></span><br><span class="line">        useStore._pinia = pinia</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ä¸Šé¢åˆ›å»ºå¥½çš„storeï¼Œpinia._sæ˜¯ä¸€ä¸ªMapç»“æ„</span></span><br><span class="line">    <span class="keyword">const</span> store: StoreGeneric = pinia._s.get(id)!</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çƒ­æ›´æ–°ç›¸å…³,é‡æ–°åˆ›å»ºæ›´æ–°store</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; hot) &#123;</span><br><span class="line">      <span class="keyword">const</span> hotId = <span class="string">'__hot:'</span> + id</span><br><span class="line">      <span class="keyword">const</span> newStore = isSetupStore</span><br><span class="line">        ? createSetupStore(hotId, setup, options, pinia, <span class="literal">true</span>)</span><br><span class="line">        : createOptionsStore(hotId, assign(&#123;&#125;, options) <span class="keyword">as</span> <span class="built_in">any</span>, pinia, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">      hot._hotUpdate(newStore)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// cleanup the state properties and the store from the cache</span></span><br><span class="line">      <span class="keyword">delete</span> pinia.state.value[hotId]</span><br><span class="line">      pinia._s.delete(hotId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾€å½“å‰ç»„ä»¶å®ä¾‹ä¸Šç¼“å­˜storeï¼Œä¸»è¦æ˜¯ç»™devtoolsä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      __DEV__ &amp;&amp;</span><br><span class="line">      IS_CLIENT &amp;&amp;</span><br><span class="line">      currentInstance &amp;&amp;</span><br><span class="line">      currentInstance.proxy &amp;&amp;</span><br><span class="line">      <span class="comment">// avoid adding stores that are just built for hot module replacement</span></span><br><span class="line">      !hot</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">const</span> vm = currentInstance.proxy</span><br><span class="line">      <span class="keyword">const</span> cache = <span class="string">'_pStores'</span> <span class="keyword">in</span> vm ? vm._pStores! : (vm._pStores = &#123;&#125;)</span><br><span class="line">      cache[id] = store</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// StoreGeneric cannot be casted towards Store</span></span><br><span class="line">    <span class="keyword">return</span> store <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useStore.$id = id</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useStore</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="createSetupStore"><a href="#createSetupStore" class="headerlink" title="createSetupStore"></a>createSetupStore</h2><p>å¦‚æœdefineStoreä¼ å…¥çš„æ˜¯ä¸€ä¸ªsetupå‡½æ•°ï¼Œåˆ™ä¼šè°ƒç”¨æ­¤æ–¹æ³•åˆ›å»ºstore</p><ul><li><h3 id="å“åº”å¼å¤„ç†store"><a href="#å“åº”å¼å¤„ç†store" class="headerlink" title="å“åº”å¼å¤„ç†store"></a>å“åº”å¼å¤„ç†store</h3><ul><li>store -&gt; reactive(store)</li><li>pinia.state.value[storeId]åˆå§‹åŒ–ï¼Œstateä¼šå¾€piniaä¸Šå­˜ä¸€ä»½å’Œåœ¨storeä¸Šå­˜ä¸€ä»½</li><li>å°†storeæ³¨å†Œåˆ°pinia._sè¿™ä¸ªMapä¸Š</li></ul></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> scope!: EffectScope  <span class="comment">//ä¸ºsetupå‡½æ•°è¿”å›çš„å†…å®¹å•ç‹¬å»ºç«‹ä¸€ä¸ªscope</span></span><br><span class="line"><span class="keyword">if</span> (__DEV__ &amp;&amp; !pinia._e.active) &#123; <span class="comment">//pinia._eä¸ºåˆ›å»ºpiniaæ—¶å»ºç«‹çš„scope</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Pinia destroyed'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = pinia.state.value[$id] <span class="keyword">as</span> UnwrapRef&lt;S&gt; | <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// å¦‚æœpinia.state.value[storeId]æœªåˆå§‹åŒ–ï¼Œè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">if</span> (!isOptionsStore &amp;&amp; !initialState &amp;&amp; (!__DEV__ || !hot)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">    <span class="keyword">set</span>(pinia.state.value, $id, &#123;&#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    pinia.state.value[$id] = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å¤–æš´éœ²çš„storeå†…å®¹</span></span><br><span class="line"><span class="keyword">const</span> partialStore = &#123;</span><br><span class="line"> _p: pinia,</span><br><span class="line"> <span class="comment">// _s: scope,</span></span><br><span class="line"> $id,</span><br><span class="line"> <span class="comment">// è°ƒç”¨$onActionä¼šå°†å›è°ƒåŠ å…¥åˆ°actionSubscriptionsä¸­,wrapActionå†…ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line"> $onAction: addSubscription.bind(<span class="literal">null</span>, actionSubscriptions),</span><br><span class="line"> $patch,</span><br><span class="line"> $reset,</span><br><span class="line"> $subscribe(callback, options = &#123;&#125;) &#123;</span><br><span class="line">   <span class="keyword">const</span> removeSubscription = addSubscription(</span><br><span class="line">     subscriptions,</span><br><span class="line">     callback,</span><br><span class="line">     options.detached,</span><br><span class="line">     () =&gt; stopWatcher()</span><br><span class="line">   )</span><br><span class="line">   <span class="comment">// ç›‘å¬stateç›´æ¥ä¿®æ”¹</span></span><br><span class="line">   <span class="keyword">const</span> stopWatcher = scope.run(<span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">     watch(</span><br><span class="line">       () =&gt; pinia.state.value[$id] <span class="keyword">as</span> UnwrapRef&lt;S&gt;,</span><br><span class="line">       (state) =&gt; &#123;</span><br><span class="line">         <span class="comment">// flushé»˜è®¤ä¸º'pre',è€Œåœ¨è°ƒç”¨$patchæ—¶isListeningä¼šè¢«è®¾ç½®ä¸ºfalse,æ‰€ä»¥ä¸ä¼šè§¦å‘$patchä¿®æ”¹stateçš„ç›‘å¬å›è°ƒ</span></span><br><span class="line">         <span class="keyword">if</span> (options.flush === <span class="string">'sync'</span> ? isSyncListening : isListening) &#123;</span><br><span class="line">           callback(</span><br><span class="line">             &#123;</span><br><span class="line">               storeId: $id,</span><br><span class="line">               <span class="keyword">type</span>: MutationType.direct,</span><br><span class="line">               events: debuggerEvents <span class="keyword">as</span> DebuggerEvent,</span><br><span class="line">             &#125;,</span><br><span class="line">             state</span><br><span class="line">           )</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       assign(&#123;&#125;, $subscribeOptions, options)</span><br><span class="line">     )</span><br><span class="line">   )!</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> removeSubscription</span><br><span class="line"> &#125;,</span><br><span class="line"> $dispose,</span><br><span class="line">&#125; <span class="keyword">as</span> _StoreWithState&lt;Id, S, G, A&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›çš„storeæ˜¯ä¸ªreactiveå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> store: Store&lt;Id, S, G, A&gt; = reactive(</span><br><span class="line">  __DEV__ || USE_DEVTOOLS</span><br><span class="line">    ? assign(</span><br><span class="line">        &#123;</span><br><span class="line">          _hmrPayload,</span><br><span class="line">          _customProperties: markRaw(<span class="keyword">new</span> Set&lt;<span class="built_in">string</span>&gt;()), <span class="comment">// devtools custom properties</span></span><br><span class="line">        &#125;,</span><br><span class="line">        partialStore</span><br><span class="line">        <span class="comment">// must be added later</span></span><br><span class="line">        <span class="comment">// setupStore</span></span><br><span class="line">      )</span><br><span class="line">    : partialStore</span><br><span class="line">) <span class="keyword">as</span> unknown <span class="keyword">as</span> Store&lt;Id, S, G, A&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†storeæ³¨å†Œåˆ°piniaä¸Š</span></span><br><span class="line">pinia._s.set($id, store)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h3 id="å¤„ç†setupè¿”å›çš„å†…å®¹"><a href="#å¤„ç†setupè¿”å›çš„å†…å®¹" class="headerlink" title="å¤„ç†setupè¿”å›çš„å†…å®¹"></a>å¤„ç†setupè¿”å›çš„å†…å®¹</h3></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// å°†defineStoreä½¿ç”¨è€…å®šä¹‰çš„è¿”å›å†…å®¹æ”¾è¿›scopeä¸­,åœ¨ç»„ä»¶å¸è½½æ—¶å›æ”¶effect</span></span><br><span class="line"> <span class="keyword">const</span> setupStore = pinia._e.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   scope = effectScope()</span><br><span class="line">   <span class="keyword">return</span> scope.run(<span class="function"><span class="params">()</span> =&gt;</span> setup())</span><br><span class="line"> &#125;)!</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h3 id="åŒæ­¥setupè¿”å›å†…å®¹å’Œpinia-state"><a href="#åŒæ­¥setupè¿”å›å†…å®¹å’Œpinia-state" class="headerlink" title="åŒæ­¥setupè¿”å›å†…å®¹å’Œpinia.state"></a>åŒæ­¥setupè¿”å›å†…å®¹å’Œpinia.state</h3><ul><li>å› ä¸ºstateä¼šåœ¨storeä¸Šå­˜ä¸€ä»½ï¼Œä¹Ÿä¼šåœ¨pinia.state.value[storeId]ä¸Šå­˜ä¸€ä»½ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ä¸¤è¾¹éƒ½æ˜¯åŒä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œéœ€è¦è¿›è¡ŒåŒæ­¥</li><li>ä½¿ç”¨è€…å¯ä»¥ç›´æ¥é€šè¿‡pinia.state.valueè®¾ç½®storeå†…å®¹ï¼Œæ‰€ä»¥ç›´æ¥è®¾ç½®çš„å†…å®¹ä¹Ÿéœ€è¦åŒæ­¥</li></ul></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// å°†defineStoreä½¿ç”¨è€…å®šä¹‰çš„è¿”å›å†…å®¹æ”¾è¿›scopeä¸­,åœ¨ç»„ä»¶å¸è½½æ—¶å›æ”¶effect</span></span><br><span class="line"><span class="keyword">const</span> setupStore = pinia._e.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  scope = effectScope()</span><br><span class="line">  <span class="keyword">return</span> scope.run(<span class="function"><span class="params">()</span> =&gt;</span> setup())</span><br><span class="line">&#125;)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> setupStore) &#123;</span><br><span class="line"> <span class="keyword">const</span> prop = setupStore[key]</span><br><span class="line"> <span class="comment">// åªå¤„ç†refã€reactiveå¯¹è±¡ï¼Œcomputedç­‰ä¸å¤„ç†</span></span><br><span class="line"> <span class="keyword">if</span> ((isRef(prop) &amp;&amp; !isComputed(prop)) || isReactive(prop)) &#123;</span><br><span class="line">   <span class="comment">// mark it as a piece of state to be serialized</span></span><br><span class="line">   <span class="keyword">if</span> (__DEV__ &amp;&amp; hot) &#123;</span><br><span class="line">     <span class="comment">// çƒ­æ›´æ–°ç›¸å…³ï¼Œå¿½ç•¥</span></span><br><span class="line">     <span class="keyword">set</span>(hotState.value, key, toRef(setupStore <span class="keyword">as</span> <span class="built_in">any</span>, key))</span><br><span class="line">     <span class="comment">// optionç»“æ„å·²ç»åœ¨createOptionsStoreå°†å…¶åŠ å…¥pinia</span></span><br><span class="line">     </span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isOptionsStore) &#123;<span class="comment">// åŒæ­¥pinia.state -&gt; store</span></span><br><span class="line">   </span><br><span class="line">     <span class="comment">// å°†ç”¨æˆ·å¯èƒ½ç›´æ¥è°ƒç”¨pinia.state.value[$id]è®¾ç½®çš„refã€reactiveå¯¹è±¡è®¾ç½®åˆ°setupè¿”å›çš„ç»“æœä¸Š,è®©äºŒè€…çš„å“åº”å¼éƒ½ä»£ç†ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">     <span class="comment">// ä½¿å¾—storeã€piniaèƒ½åŒæ­¥æ›´æ”¹</span></span><br><span class="line">     <span class="keyword">if</span> (initialState &amp;&amp; shouldHydrate(prop)) &#123;</span><br><span class="line">       <span class="keyword">if</span> (isRef(prop)) &#123;</span><br><span class="line">         prop.value = initialState[key]</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// probably a reactive object, lets recursively assign</span></span><br><span class="line">         <span class="comment">// åŒæ­¥å…¶ä»–ç±»å‹</span></span><br><span class="line">         mergeReactiveObjects(prop, initialState[key])</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// transfer the ref to the pinia state to keep everything in sync</span></span><br><span class="line">     <span class="comment">// å°†setupè¿”å›çš„refã€reactiveå¯¹è±¡åŒæ­¥åˆ°pinia.stateä¸Šï¼Œä½¿å¾—storeã€piniaèƒ½åŒæ­¥æ›´æ”¹</span></span><br><span class="line">     <span class="keyword">if</span> (isVue2) &#123; <span class="comment">//åŒæ­¥ store -&gt; pinia.state</span></span><br><span class="line">       <span class="keyword">set</span>(pinia.state.value[$id], key, prop)</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       pinia.state.value[$id][key] = prop</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeReactiveObjects</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">T</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">any</span>, <span class="title">unknown</span>&gt; | <span class="title">Map</span>&lt;<span class="title">unknown</span>, <span class="title">unknown</span>&gt; | <span class="title">Set</span>&lt;<span class="title">unknown</span>&gt;</span></span><br><span class="line"><span class="function">&gt;(<span class="params">target: T, patchToApply: _DeepPartial&lt;T&gt;</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆå¹¶Mapç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (target <span class="keyword">instanceof</span> Map &amp;&amp; patchToApply <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line">    patchToApply.forEach(<span class="function">(<span class="params">value, key</span>) =&gt;</span> target.set(key, value))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆå¹¶Setç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (target <span class="keyword">instanceof</span> Set &amp;&amp; patchToApply <span class="keyword">instanceof</span> Set) &#123;</span><br><span class="line">    patchToApply.forEach(target.add, target)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> patchToApply) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!patchToApply.hasOwnProperty(key)) <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">const</span> subPatch = patchToApply[key]</span><br><span class="line">    <span class="keyword">const</span> targetValue = target[key]</span><br><span class="line">    <span class="comment">// åªæœ‰æ™®é€šå¯¹è±¡æ‰ä¼šè¿›å…¥é€’å½’</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      isPlainObject(targetValue) &amp;&amp;</span><br><span class="line">      isPlainObject(subPatch) &amp;&amp;</span><br><span class="line">      target.hasOwnProperty(key) &amp;&amp;</span><br><span class="line">      !isRef(subPatch) &amp;&amp;</span><br><span class="line">      !isReactive(subPatch)</span><br><span class="line">    ) &#123;</span><br><span class="line">      target[key] = mergeReactiveObjects(targetValue, subPatch)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      target[key] = subPatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h3 id="å¤„ç†action"><a href="#å¤„ç†action" class="headerlink" title="å¤„ç†action"></a>å¤„ç†action</h3><ul><li>å°†actionæ›¿æ¢æˆwrapActionï¼ŒwrapActionæ·»åŠ äº†è®¢é˜…å‘å¸ƒç›¸å…³çš„åŠŸèƒ½</li></ul></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// å°†defineStoreä½¿ç”¨è€…å®šä¹‰çš„è¿”å›å†…å®¹æ”¾è¿›scopeä¸­,åœ¨ç»„ä»¶å¸è½½æ—¶å›æ”¶effect</span></span><br><span class="line"><span class="keyword">const</span> setupStore = pinia._e.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  scope = effectScope()</span><br><span class="line">  <span class="keyword">return</span> scope.run(<span class="function"><span class="params">()</span> =&gt;</span> setup())</span><br><span class="line">&#125;)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> setupStore) &#123;</span><br><span class="line"> <span class="keyword">const</span> prop = setupStore[key]</span><br><span class="line"> <span class="comment">// åªå¤„ç†refã€reactiveå¯¹è±¡ï¼Œcomputedç­‰ä¸å¤„ç†</span></span><br><span class="line"> <span class="keyword">if</span> ((isRef(prop) &amp;&amp; !isComputed(prop)) || isReactive(prop)) &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> prop === <span class="string">'function'</span>) &#123; </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å°†setupä¸­çš„æ–¹æ³•æ›¿æ¢æˆwrapActionåŒ…è£…çš„æ–¹æ³•ï¼ŒwrapActionåœ¨è®¢é˜…å‘å¸ƒç« èŠ‚è§£æ</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">const</span> actionValue = __DEV__ &amp;&amp; hot ? prop : wrapAction(key, prop)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">        <span class="keyword">set</span>(setupStore, key, actionValue)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error</span></span><br><span class="line">        setupStore[key] = actionValue</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        _hmrPayload.actions[key] = prop</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// list actions so they can be used in plugins</span></span><br><span class="line">      <span class="comment">// @ts-expect-error</span></span><br><span class="line">      optionsForPlugin.actions[key] = prop</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h3 id="å¤„ç†storeåˆå¹¶setup"><a href="#å¤„ç†storeåˆå¹¶setup" class="headerlink" title="å¤„ç†storeåˆå¹¶setup"></a>å¤„ç†storeåˆå¹¶setup</h3></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// å¯¹å¤–æš´éœ²çš„store API</span></span><br><span class="line"><span class="keyword">const</span> partialStore = &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> store: Store&lt;Id, S, G, A&gt; = reactive(</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">partialStore</span><br><span class="line">)</span><br><span class="line"><span class="comment">// å°†defineStoreä½¿ç”¨è€…å®šä¹‰çš„è¿”å›å†…å®¹æ”¾è¿›scopeä¸­,åœ¨ç»„ä»¶å¸è½½æ—¶å›æ”¶effect</span></span><br><span class="line"><span class="keyword">const</span> setupStore = pinia._e.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">scope = effectScope()</span><br><span class="line"><span class="keyword">return</span> scope.run(<span class="function"><span class="params">()</span> =&gt;</span> setup())</span><br><span class="line">&#125;)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> setupStore) &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// å°†æœ€åŒæ­¥åçš„ç»“æœï¼Œåˆå¹¶è¿›storeä¸Š</span></span><br><span class="line"> <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">   <span class="built_in">Object</span>.keys(setupStore).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">set</span>(store, key, setupStore[key])</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="comment">// å°†storeçš„reactiveå¯¹è±¡ã€åŸå§‹å¯¹è±¡éƒ½è¿›è¡Œåˆå¹¶</span></span><br><span class="line">   assign(store, setupStore)</span><br><span class="line">   assign(toRaw(store), setupStore)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="createOptionsStore"><a href="#createOptionsStore" class="headerlink" title="createOptionsStore"></a>createOptionsStore</h2><p>å½“ä¼ å…¥çš„æ˜¯optioné…ç½®æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨æ­¤æ–¹æ³•åˆ›å»ºstore</p><ul><li>createSetupStoreå†…éƒ¨ä¼šå°†optionè½¬æ¢æˆsetupæ–¹æ³•ï¼Œç„¶åå®é™…è°ƒç”¨createSetupStoreè¿›è¡Œåˆ›å»º</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createOptionsStore</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">_GettersTree</span>&lt;<span class="title">S</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span> <span class="title">extends</span> <span class="title">_ActionsTree</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  options: DefineStoreOptions&lt;Id, S, G, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Store</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; state, actions, getters &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> initialState: StateTree | <span class="literal">undefined</span> = pinia.state.value[id]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> store: Store&lt;Id, S, G, A&gt;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å°†optionsè½¬åŒ–æˆsetupå‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–pinia.state</span></span><br><span class="line">    <span class="keyword">if</span> (!initialState &amp;&amp; (!__DEV__ || !hot)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">        <span class="keyword">set</span>(pinia.state.value, id, state ? state() : &#123;&#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pinia.state.value[id] = state ? state() : &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†pinia.stateå…¨éƒ¨è½¬æ¢æˆrefï¼Œå’Œsetupä¸­è¿”å›refæ•ˆæœä¸€è‡´</span></span><br><span class="line">    <span class="keyword">const</span> localState =</span><br><span class="line">      __DEV__ &amp;&amp; hot</span><br><span class="line">        ? <span class="comment">// use ref() to unwrap refs inside state <span class="doctag">TODO:</span> check if this is still necessary</span></span><br><span class="line">          toRefs(ref(state ? state() : &#123;&#125;).value)</span><br><span class="line">        : toRefs(pinia.state.value[id])</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ€ç»ˆoptions storeè¿”å›çš„å†…å®¹æ ¼å¼å’Œsetup storeè¿”å›çš„å†…å®¹æ ¼å¼ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">return</span> assign(</span><br><span class="line">      localState,</span><br><span class="line">      actions,</span><br><span class="line">      <span class="comment">// å°† getter è½¬æ¢æˆ computed</span></span><br><span class="line">      <span class="built_in">Object</span>.keys(getters || &#123;&#125;).reduce(<span class="function">(<span class="params">computedGetters, name</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; name <span class="keyword">in</span> localState) &#123;</span><br><span class="line">          <span class="built_in">console</span>.warn(</span><br><span class="line">            <span class="string">`[ğŸ]: A getter cannot have the same name as another state property. Rename one of them. Found with "<span class="subst">$&#123;name&#125;</span>" in store "<span class="subst">$&#123;id&#125;</span>".`</span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// getterå‡½æ•°ä¸å¯ä»£ç†ï¼ŒåŠä¸å¯¹computedåšé¢å¤–å¤„ç†ï¼Œå’Œsetupä¸­ä¸€è‡´</span></span><br><span class="line">        computedGetters[name] = markRaw(</span><br><span class="line">          computed(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            setActivePinia(pinia)</span><br><span class="line">            <span class="comment">// it was created just before</span></span><br><span class="line">            <span class="keyword">const</span> store = pinia._s.get(id)!</span><br><span class="line"></span><br><span class="line">            <span class="comment">// allow cross using stores</span></span><br><span class="line">            <span class="keyword">if</span> (isVue2 &amp;&amp; !store._r) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// @ts-expect-error</span></span><br><span class="line">            <span class="comment">// return getters![name].call(context, context)</span></span><br><span class="line">            <span class="keyword">return</span> getters![name].call(store, store)</span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> computedGetters</span><br><span class="line">      &#125;, &#123;&#125; <span class="keyword">as</span> Record&lt;<span class="built_in">string</span>, ComputedRef&gt;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// optioné€‰é¡¹æ³¨å†Œçš„piniaä¼šè¢«è½¬æ¢æˆsetupå‡½æ•°å½¢å¼</span></span><br><span class="line">  store = createSetupStore(id, setup, options, pinia, hot, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  store.$reset = <span class="function"><span class="keyword">function</span> <span class="title">$reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newState = state ? state() : &#123;&#125;</span><br><span class="line">    <span class="comment">// we use a patch to group all changes into one single subscription</span></span><br><span class="line">    <span class="keyword">this</span>.$patch(<span class="function">(<span class="params">$state</span>) =&gt;</span> &#123;</span><br><span class="line">      assign($state, newState)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> store <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¢é˜…å‘å¸ƒ"><a href="#è®¢é˜…å‘å¸ƒ" class="headerlink" title="è®¢é˜…å‘å¸ƒ"></a>è®¢é˜…å‘å¸ƒ</h2><p>piniaèƒ½å¤Ÿå¯¹ä¿®æ”¹stateã€actionè¿›è¡Œç›‘å¬ï¼Œå†…éƒ¨é€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ã€watch APIå®ç°</p><ul><li><h2 id="å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h2><ul><li>å°†å­˜å‚¨è®¢é˜…å™¨çš„åŠŸèƒ½å’Œæ•´ä¸ªè®¾è®¡è§£è—•ï¼Œäº¤ç»™å¤–éƒ¨æ¥ä¼ å…¥ï¼Œå¥½å¤„æ˜¯èƒ½å¤Ÿå¤„ç†ä¸åŒç±»å‹çš„å‘å¸ƒè®¢é˜…</li></ul></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//subscriptions.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addSubscription</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">_Method</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  subscriptions: T[], <span class="comment">//å¤–éƒ¨ä¼ å…¥å­˜å‚¨å™¨</span></span></span></span><br><span class="line"><span class="function"><span class="params">  callback: T,</span></span></span><br><span class="line"><span class="function"><span class="params">  detached?: <span class="built_in">boolean</span>, <span class="comment">// æ˜¯å¦åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤è®¢é˜…</span></span></span></span><br><span class="line"><span class="function"><span class="params">  onCleanup: () =&gt; <span class="built_in">void</span> = noop</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  subscriptions.push(callback)</span><br><span class="line">  <span class="comment">// æ¸…é™¤è®¢é˜…</span></span><br><span class="line">  <span class="keyword">const</span> removeSubscription = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> idx = subscriptions.indexOf(callback)</span><br><span class="line">    <span class="keyword">if</span> (idx &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      subscriptions.splice(idx, <span class="number">1</span>)</span><br><span class="line">      onCleanup()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡ä¼ detached,åˆ™ä¼šè‡ªåŠ¨åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤è®¢é˜…</span></span><br><span class="line">  <span class="keyword">if</span> (!detached &amp;&amp; getCurrentScope()) &#123;</span><br><span class="line">    onScopeDispose(removeSubscription)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> removeSubscription</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">triggerSubscriptions</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">_Method</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  subscriptions: T[],</span></span></span><br><span class="line"><span class="function"><span class="params">  ...args: Parameters&lt;T&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  subscriptions.slice().forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">    callback(...args)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h2 id="ç›‘å¬action"><a href="#ç›‘å¬action" class="headerlink" title="ç›‘å¬action"></a>ç›‘å¬action</h2></li></ul><p>åŸºæœ¬ä½¿ç”¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unsubscribe = someStore.$onAction(</span><br><span class="line">  (&#123;</span><br><span class="line">    name, <span class="comment">// action åç§°</span></span><br><span class="line">    store, <span class="comment">// store å®ä¾‹ï¼Œç±»ä¼¼ `someStore`</span></span><br><span class="line">    args, <span class="comment">// ä¼ é€’ç»™ action çš„å‚æ•°æ•°ç»„</span></span><br><span class="line">    after, <span class="comment">// åœ¨ action è¿”å›æˆ–è§£å†³åçš„é’©å­</span></span><br><span class="line">    onError, <span class="comment">// action æŠ›å‡ºæˆ–æ‹’ç»çš„é’©å­</span></span><br><span class="line">  &#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿™å°†åœ¨æ‰§è¡Œ "store "çš„ action ä¹‹å‰è§¦å‘ã€‚</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`xx`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™å°†åœ¨ action æˆåŠŸå¹¶å®Œå…¨è¿è¡Œåè§¦å‘ã€‚å®ƒç­‰å¾…ç€ä»»ä½•è¿”å›çš„ promise</span></span><br><span class="line">    after(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(</span><br><span class="line">        <span class="string">`Finished "<span class="subst">$&#123;name&#125;</span>" after <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">          <span class="built_in">Date</span>.now() - startTime</span></span></span><br><span class="line"><span class="string"><span class="subst">        &#125;</span>ms.\nResult: <span class="subst">$&#123;result&#125;</span>.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ action æŠ›å‡ºæˆ–è¿”å›ä¸€ä¸ªæ‹’ç»çš„ promiseï¼Œè¿™å°†è§¦å‘</span></span><br><span class="line">    onError(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(</span><br><span class="line">        <span class="string">`Failed "<span class="subst">$&#123;name&#125;</span>" after <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms.\nError: <span class="subst">$&#123;error&#125;</span>.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹åŠ¨åˆ é™¤ç›‘å¬å™¨</span></span><br><span class="line">unsubscribe()</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡-onActionæ·»åŠ è®¢é˜…"><a href="#é€šè¿‡-onActionæ·»åŠ è®¢é˜…" class="headerlink" title="é€šè¿‡$onActionæ·»åŠ è®¢é˜…"></a>é€šè¿‡$onActionæ·»åŠ è®¢é˜…</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">SS</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">any</span>, <span class="title">unknown</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">string</span>, <span class="title">_Method</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span> <span class="title">extends</span> <span class="title">_ActionsTree</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Store</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// å¯¹å¤–æš´éœ²çš„storeå†…å®¹</span></span><br><span class="line"><span class="keyword">const</span> partialStore = &#123;</span><br><span class="line"> _p: pinia,</span><br><span class="line"> <span class="comment">// _s: scope,</span></span><br><span class="line"> $id,</span><br><span class="line"> <span class="comment">// è°ƒç”¨$onActionä¼šå°†å›è°ƒåŠ å…¥åˆ°actionSubscriptionsä¸­,è°ƒç”¨wrapActionå†…ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line"> $onAction: addSubscription.bind(<span class="literal">null</span>, actionSubscriptions),</span><br><span class="line"> $patch,</span><br><span class="line"> $reset,</span><br><span class="line"> $subscribe(callback, options = &#123;&#125;) &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> &#125;,</span><br><span class="line"> $dispose,</span><br><span class="line">&#125; <span class="keyword">as</span> _StoreWithState&lt;Id, S, G, A&gt;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡wrapActionè¿›è¡Œå‘å¸ƒ"><a href="#é€šè¿‡wrapActionè¿›è¡Œå‘å¸ƒ" class="headerlink" title="é€šè¿‡wrapActionè¿›è¡Œå‘å¸ƒ"></a>é€šè¿‡wrapActionè¿›è¡Œå‘å¸ƒ</h3><ul><li>setupã€optionä¸­çš„æ–¹æ³•ï¼Œä¼šè¢«æ›¿æ¢æˆwrapAction</li><li>å½“è°ƒç”¨wrapActionæ—¶ï¼Œä¼šè§¦å‘actionSubscriptionsã€afterCallbackListæˆ–onErrorCallbackListä¸­çš„å›è°ƒ</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">SS</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">any</span>, <span class="title">unknown</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">string</span>, <span class="title">_Method</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span> <span class="title">extends</span> <span class="title">_ActionsTree</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Store</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// internal state</span></span><br><span class="line"><span class="keyword">let</span> isListening: <span class="built_in">boolean</span> <span class="comment">// å¼‚æ­¥ç›‘å¬</span></span><br><span class="line"><span class="keyword">let</span> isSyncListening: <span class="built_in">boolean</span> <span class="comment">// åŒæ­¥ç›‘å¬</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscriptions: SubscriptionCallback&lt;S&gt;[] = markRaw([])  <span class="comment">// ç›‘å¬stateçš„è®¢é˜…é›†åˆ</span></span><br><span class="line"><span class="keyword">let</span> actionSubscriptions: StoreOnActionListener&lt;Id, S, G, A&gt;[] = markRaw([]) <span class="comment">// ç›‘å¬actionçš„è®¢é˜…é›†åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…è£…actionè°ƒç”¨ï¼Œè¿½åŠ å‘å¸ƒè®¢é˜…åŠŸèƒ½</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapAction</span>(<span class="params">name: <span class="built_in">string</span>, action: _Method</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"><span class="keyword">this</span>: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// æ ¹æ®é—­åŒ…ä¸Šä¸‹æ–‡ï¼Œè°ƒç”¨æ—¶è®¾ç½®å½“å‰æ´»è·ƒçš„pinia</span></span><br><span class="line">   setActivePinia(pinia)</span><br><span class="line">   <span class="keyword">const</span> args = <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>)</span><br><span class="line">   <span class="comment">// è°ƒç”¨actionåå›è°ƒé›†åˆ</span></span><br><span class="line">   <span class="keyword">const</span> afterCallbackList: <span class="built_in">Array</span>&lt;<span class="function">(<span class="params">resolvedReturn: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">any</span>&gt; = []</span><br><span class="line">   <span class="keyword">const</span> onErrorCallbackList: <span class="built_in">Array</span>&lt;<span class="function">(<span class="params">error: unknown</span>) =&gt;</span> unknown&gt; = []</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">after</span>(<span class="params">callback: _ArrayType&lt;<span class="keyword">typeof</span> afterCallbackList&gt;</span>) </span>&#123;</span><br><span class="line">     afterCallbackList.push(callback)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">callback: _ArrayType&lt;<span class="keyword">typeof</span> onErrorCallbackList&gt;</span>) </span>&#123;</span><br><span class="line">     onErrorCallbackList.push(callback)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è§¦å‘actionæ—¶çš„å›è°ƒï¼ŒåŒæ—¶å°†afterç­‰æ–¹æ³•é€šè¿‡å‚æ•°ä¼ å…¥</span></span><br><span class="line">   triggerSubscriptions(actionSubscriptions, &#123;</span><br><span class="line">     args,</span><br><span class="line">     name,</span><br><span class="line">     store,</span><br><span class="line">     after,</span><br><span class="line">     onError,</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> ret: <span class="built_in">any</span></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     ret = action.apply(<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.$id === $id ? <span class="keyword">this</span> : store, args)</span><br><span class="line">   &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">     <span class="comment">// å¤„ç†åŒæ­¥é”™è¯¯</span></span><br><span class="line">     triggerSubscriptions(onErrorCallbackList, error)</span><br><span class="line">     <span class="keyword">throw</span> error</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// å¦‚æœæ˜¯å¼‚æ­¥æ–¹æ³•</span></span><br><span class="line">   <span class="keyword">if</span> (ret <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> ret</span><br><span class="line">       .then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="comment">// è·å–åˆ°actionè°ƒç”¨ç»“æœåè§¦å‘</span></span><br><span class="line">         triggerSubscriptions(afterCallbackList, value)</span><br><span class="line">         <span class="keyword">return</span> value</span><br><span class="line">       &#125;)</span><br><span class="line">       .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">         triggerSubscriptions(onErrorCallbackList, error)</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// allow the afterCallback to override the return value</span></span><br><span class="line">   triggerSubscriptions(afterCallbackList, ret)</span><br><span class="line">   <span class="keyword">return</span> ret</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›‘å¬ä¿®æ”¹state"><a href="#ç›‘å¬ä¿®æ”¹state" class="headerlink" title="ç›‘å¬ä¿®æ”¹state"></a>ç›‘å¬ä¿®æ”¹state</h2><p>ä¿®æ”¹stateæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§é€šè¿‡store.stateç›´æ¥ä¿®æ”¹ç„¶åé€šè¿‡watch APIè¿›è¡Œç›‘å¬ï¼Œå¦ä¸€ç§é€šè¿‡$patchè¿›è¡Œ<a href="https://so.csdn.net/so/search?q=%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9&spm=1001.2101.3001.7020" target="_blank" rel="noopener">æ‰¹é‡ä¿®æ”¹</a>ï¼Œé€šè¿‡$patchè¿›è¡Œæ‰¹é‡ä¿®æ”¹æ—¶ï¼Œä¸ºäº†åªè§¦å‘ä¸€æ¬¡å›è°ƒéœ€è¦æ‰‹åŠ¨è§¦å‘</p><ul><li>åŸºæœ¬ä½¿ç”¨</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cartStore.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// import &#123; MutationType &#125; from 'pinia'</span></span><br><span class="line">  mutation.type <span class="comment">// 'direct' | 'patch object' | 'patch function'</span></span><br><span class="line">  <span class="comment">// å’Œ cartStore.$id ä¸€æ ·</span></span><br><span class="line">  mutation.storeId <span class="comment">// 'cart'</span></span><br><span class="line">  <span class="comment">// åªæœ‰ mutation.type === 'patch object'çš„æƒ…å†µä¸‹æ‰å¯ç”¨</span></span><br><span class="line">  mutation.payload <span class="comment">// ä¼ é€’ç»™ cartStore.$patch() çš„è¡¥ä¸å¯¹è±¡ã€‚</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><h3 id="ç›´æ¥ä¿®æ”¹state"><a href="#ç›´æ¥ä¿®æ”¹state" class="headerlink" title="ç›´æ¥ä¿®æ”¹state"></a>ç›´æ¥ä¿®æ”¹state</h3></li></ul><p>$subscribeç›‘å¬stateç›´æ¥ä¿®æ”¹ï¼Œå†…éƒ¨é€šè¿‡watch APIå®ç°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">SS</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">any</span>, <span class="title">unknown</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">string</span>, <span class="title">_Method</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span> <span class="title">extends</span> <span class="title">_ActionsTree</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Store</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// internal state</span></span><br><span class="line"><span class="keyword">let</span> isListening: <span class="built_in">boolean</span> <span class="comment">// set to true at the end</span></span><br><span class="line"><span class="keyword">let</span> isSyncListening: <span class="built_in">boolean</span> <span class="comment">// set to true at the end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// å¯¹å¤–æš´éœ²çš„storeå†…å®¹</span></span><br><span class="line"><span class="keyword">const</span> partialStore = &#123;</span><br><span class="line"> _p: pinia,</span><br><span class="line"> <span class="comment">// _s: scope,</span></span><br><span class="line"> $id,</span><br><span class="line"> <span class="comment">// è°ƒç”¨$onActionä¼šå°†å›è°ƒåŠ å…¥åˆ°actionSubscriptionsä¸­,è°ƒç”¨wrapActionå†…ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line"> $onAction: addSubscription.bind(<span class="literal">null</span>, actionSubscriptions),</span><br><span class="line"> $patch,</span><br><span class="line"> $reset,</span><br><span class="line"> $subscribe(callback, options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨è€…è°ƒç”¨åå°†è®¢é˜…å›è°ƒæ·»åŠ è¿›subscriptions</span></span><br><span class="line"><span class="keyword">const</span> removeSubscription = addSubscription(</span><br><span class="line">  subscriptions,</span><br><span class="line">  callback,</span><br><span class="line">  options.detached,</span><br><span class="line">  () =&gt; stopWatcher()</span><br><span class="line">)</span><br><span class="line">      <span class="comment">// é€šè¿‡watchç›‘å¬store.stateç›´æ¥ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">const</span> stopWatcher = scope.run(<span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line"> watch(</span><br><span class="line">   () =&gt; pinia.state.value[$id] <span class="keyword">as</span> UnwrapRef&lt;S&gt;,</span><br><span class="line">   (state) =&gt; &#123;</span><br><span class="line">     <span class="comment">// flushé»˜è®¤ä¸º'pre',è€Œåœ¨è°ƒç”¨$patchæ—¶isListeningä¼šè¢«è®¾ç½®ä¸ºfalse,æ‰€ä»¥ä¸ä¼šè§¦å‘$patchä¿®æ”¹stateçš„ç›‘å¬å›è°ƒ</span></span><br><span class="line">     <span class="comment">// ä½†å¯¹äºstore.stateç›´æ¥ä¿®æ”¹çš„æƒ…å†µï¼Œstoreåœ¨åˆ›å»ºå®ŒæˆåisSyncListeningå’ŒisListeningéƒ½ä¼šå˜æˆtrueï¼Œæ‰€ä»¥èƒ½å¤Ÿç›‘å¬</span></span><br><span class="line">     <span class="keyword">if</span> (options.flush === <span class="string">'sync'</span> ? isSyncListening : isListening) &#123;</span><br><span class="line">       callback(</span><br><span class="line">         &#123;</span><br><span class="line">           storeId: $id,</span><br><span class="line">           <span class="keyword">type</span>: MutationType.direct, <span class="comment">// typeä¸ºdirectç›´æ¥ä¿®æ”¹</span></span><br><span class="line">           events: debuggerEvents <span class="keyword">as</span> DebuggerEvent,</span><br><span class="line">         &#125;,</span><br><span class="line">         state</span><br><span class="line">       )</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   assign(&#123;&#125;, $subscribeOptions, options)</span><br><span class="line"> )</span><br><span class="line">)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> removeSubscription</span><br><span class="line"> &#125;,</span><br><span class="line"> $dispose,</span><br><span class="line">&#125; <span class="keyword">as</span> _StoreWithState&lt;Id, S, G, A&gt;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´ä¸ªstoreåˆ›å»ºç»“æŸåå°†ä¸¤ä¸ªç›‘å¬æ ‡è¯†ä¸ºtrue,æ„å‘³ç€storeåˆ›å»ºå®Œæˆ,å¯ä»¥è¿›è¡Œç›‘å¬è®¢é˜…æ“ä½œ</span></span><br><span class="line">isListening = <span class="literal">true</span></span><br><span class="line">isSyncListening = <span class="literal">true</span></span><br><span class="line"><span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h3 id="patchä¿®æ”¹"><a href="#patchä¿®æ”¹" class="headerlink" title="$patchä¿®æ”¹"></a>$patchä¿®æ”¹</h3></li></ul><p>$patchç”¨äºæ‰¹é‡ä¿®æ”¹stateï¼Œå†…éƒ¨ä¸»è¦é€šè¿‡ä¸¤ä¸ªæ ‡è¯†ä½çš„ä¿®æ”¹ï¼Œä¸è§¦å‘<a href="https://so.csdn.net/so/search?q=watch%E7%9B%91%E5%90%AC&spm=1001.2101.3001.7020" target="_blank" rel="noopener">watchç›‘å¬</a>å›è°ƒ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSetupStore</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">SS</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">any</span>, <span class="title">unknown</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">string</span>, <span class="title">_Method</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span> <span class="title">extends</span> <span class="title">_ActionsTree</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $id: Id,</span></span></span><br><span class="line"><span class="function"><span class="params">  setup: () =&gt; SS,</span></span></span><br><span class="line"><span class="function"><span class="params">  options:</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineSetupStoreOptions&lt;Id, S, G, A&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    | DefineStoreOptions&lt;Id, S, G, A&gt; = &#123;&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pinia: Pinia,</span></span></span><br><span class="line"><span class="function"><span class="params">  hot?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  isOptionsStore?: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Store</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// internal state</span></span><br><span class="line"><span class="keyword">let</span> isListening: <span class="built_in">boolean</span> <span class="comment">// set to true at the end</span></span><br><span class="line"><span class="keyword">let</span> isSyncListening: <span class="built_in">boolean</span> <span class="comment">// set to true at the end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$patch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"> partialStateOrMutator:</span></span></span><br><span class="line"><span class="function"><span class="params">   | _DeepPartial&lt;UnwrapRef&lt;S&gt;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">   | ((state: UnwrapRef&lt;S&gt;) =&gt; <span class="built_in">void</span>)</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line"> <span class="comment">// è®¢é˜…$patchæ“ä½œtype</span></span><br><span class="line"> <span class="keyword">let</span> subscriptionMutation: SubscriptionCallbackMutation&lt;S&gt;</span><br><span class="line"> <span class="comment">// é¿å…æ‰¹é‡ä¿®æ”¹è§¦å‘$subscribe</span></span><br><span class="line"> isListening = isSyncListening = <span class="literal">false</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">   debuggerEvents = []</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// å…¼å®¹$patchä¼ é€’å‡½æ•°ã€å¯¹è±¡è°ƒç”¨çš„ä¸¤ç§è°ƒç”¨æ–¹å¼</span></span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">typeof</span> partialStateOrMutator === <span class="string">'function'</span>) &#123;</span><br><span class="line">   partialStateOrMutator(pinia.state.value[$id] <span class="keyword">as</span> UnwrapRef&lt;S&gt;)</span><br><span class="line">   subscriptionMutation = &#123;</span><br><span class="line">     <span class="keyword">type</span>: MutationType.patchFunction,  <span class="comment">// typeç±»å‹</span></span><br><span class="line">     storeId: $id,</span><br><span class="line">     events: debuggerEvents <span class="keyword">as</span> DebuggerEvent[],</span><br><span class="line">   &#125;</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="comment">// $patchä¼ é€’å¯¹è±¡èµ°åˆå¹¶æµç¨‹</span></span><br><span class="line">   mergeReactiveObjects(pinia.state.value[$id], partialStateOrMutator)</span><br><span class="line">   subscriptionMutation = &#123;</span><br><span class="line">     <span class="keyword">type</span>: MutationType.patchObject, <span class="comment">// typeç±»å‹</span></span><br><span class="line">     payload: partialStateOrMutator,</span><br><span class="line">     storeId: $id,</span><br><span class="line">     events: debuggerEvents <span class="keyword">as</span> DebuggerEvent[],</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">const</span> myListenerId = (activeListener = Symbol())</span><br><span class="line"> <span class="comment">// å¯¹äºå¼‚æ­¥ä¿®æ”¹æƒ…å†µï¼Œå¼‚æ­¥è¿˜åŸisListening,è®©$subscribeä¸ä¼šç›‘å¬é€šè¿‡$patchä¿®æ”¹state</span></span><br><span class="line"> nextTick().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (activeListener === myListenerId) &#123;</span><br><span class="line">     isListening = <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> isSyncListening = <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// æ‰‹åŠ¨è§¦å‘è®¢é˜…,å®ç°é€šè¿‡$patchæ‰¹é‡ä¿®æ”¹stateåªè§¦å‘ä¸€æ¬¡è®¢é˜…å›è°ƒ</span></span><br><span class="line"> triggerSubscriptions(</span><br><span class="line">   subscriptions,</span><br><span class="line">   subscriptionMutation,</span><br><span class="line">   pinia.state.value[$id] <span class="keyword">as</span> UnwrapRef&lt;S&gt;</span><br><span class="line"> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´ä¸ªstoreåˆ›å»ºç»“æŸåå°†ä¸¤ä¸ªç›‘å¬æ ‡è¯†ä¸ºtrue,æ„å‘³ç€storeåˆ›å»ºå®Œæˆ,å¯ä»¥è¿›è¡Œç›‘å¬è®¢é˜…æ“ä½œ</span></span><br><span class="line">isListening = <span class="literal">true</span></span><br><span class="line">isSyncListening = <span class="literal">true</span></span><br><span class="line"><span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="store-API"><a href="#store-API" class="headerlink" title="store API"></a>store API</h2><ul><li><h2 id="reset"><a href="#reset" class="headerlink" title="$reset"></a>$reset</h2></li></ul><p>å¯¹äºoptions storeæä¾›çš„è¿˜åŸåˆå§‹çŠ¶æ€çš„API</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// options store</span></span><br><span class="line">store.$reset = <span class="function"><span class="keyword">function</span> <span class="title">$reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newState = state ? state() : &#123;&#125;  <span class="comment">// stateä¸ºoptionsä¸­çš„state</span></span><br><span class="line">  <span class="comment">// é€šè¿‡$patchæ‰¹é‡ä¿®æ”¹</span></span><br><span class="line">  <span class="keyword">this</span>.$patch(<span class="function">(<span class="params">$state</span>) =&gt;</span> &#123;</span><br><span class="line">    assign($state, newState)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup store</span></span><br><span class="line"><span class="keyword">const</span> $reset = __DEV__ <span class="comment">// å¼€å‘ç¯å¢ƒä¸‹ä¼šæŠ¥é”™</span></span><br><span class="line">  ? <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">`ğŸ: Store "<span class="subst">$&#123;$id&#125;</span>" is built using the setup syntax and does not implement $reset().`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  : noop</span><br></pre></td></tr></table></figure><ul><li><h2 id="dispose"><a href="#dispose" class="headerlink" title="$dispose"></a>$dispose</h2></li></ul><p>å¸è½½storeçš„API</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¸è½½store</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$dispose</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  scope.stop() <span class="comment">//å¸è½½storeçš„scope effect</span></span><br><span class="line">  subscriptions = []</span><br><span class="line">  actionSubscriptions = []</span><br><span class="line">  pinia._s.delete($id) <span class="comment">// ä»piniaä¸Šåˆ é™¤æ‰å¯¹åº”çš„store</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="storeToRefsè§£æ„store"><a href="#storeToRefsè§£æ„store" class="headerlink" title="storeToRefsè§£æ„store"></a>storeToRefsè§£æ„store</h2><p>é€šè¿‡storeToRefsä½¿å¾—è§£æ„storeä¹Ÿä¸ä¼šä¸¢å¤±å“åº”å¼</p><ul><li>åŸºæœ¬ä½¿ç”¨</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> store = useCounterStore()</span><br><span class="line">    <span class="comment">// âŒ è¿™å°†æ— æ³•ç”Ÿæ•ˆï¼Œå› ä¸ºå®ƒç ´åäº†å“åº”æ€§</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ä» `props` ä¸­è§£æ„æ˜¯ä¸€æ ·çš„ã€‚</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, doubleCount &#125; = store</span><br><span class="line"></span><br><span class="line">    name <span class="comment">// "eduardo"</span></span><br><span class="line">    doubleCount <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// å§‹ç»ˆæ˜¯ "eduardo"</span></span><br><span class="line">      name,</span><br><span class="line">      <span class="comment">// å§‹ç»ˆæ˜¯ 2</span></span><br><span class="line">      doubleCount,</span><br><span class="line">      <span class="comment">// è¿™ä¸ªå°†æ˜¯å“åº”å¼çš„</span></span><br><span class="line">      doubleValue: computed(<span class="function"><span class="params">()</span> =&gt;</span> store.doubleCount),</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡storeToRefsè°ƒç”¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> store = useCounterStore()</span><br><span class="line">    <span class="comment">// `name` and `doubleCount` éƒ½æ˜¯å“åº”å¼ refs</span></span><br><span class="line">    <span class="comment">// è¿™ä¹Ÿå°†ä¸ºç”±æ’ä»¶æ·»åŠ çš„å±æ€§åˆ›å»º refs</span></span><br><span class="line">    <span class="comment">// åŒæ—¶ä¼šè·³è¿‡ä»»ä½• action æˆ–éå“åº”å¼(é ref/å“åº”å¼)å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, doubleCount &#125; = storeToRefs(store)</span><br><span class="line">    <span class="comment">// åä¸º increment çš„ action å¯ä»¥ç›´æ¥æå–</span></span><br><span class="line">    <span class="keyword">const</span> &#123; increment &#125; = store</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name,</span><br><span class="line">      doubleCount,</span><br><span class="line">      increment,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>storeToRefs<ul><li>ç±»ä¼¼toRefsï¼Œä½†ä¼šè·³è¿‡æ–¹æ³•å’Œéå“åº”å¼å±æ€§</li></ul></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// storeToRefs.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">storeToRefs</span>&lt;<span class="title">SS</span> <span class="title">extends</span> <span class="title">StoreGeneric</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  store: SS</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">ToRefs</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">StoreState</span>&lt;<span class="title">SS</span>&gt; &amp; <span class="title">StoreGetters</span>&lt;<span class="title">SS</span>&gt; &amp; <span class="title">PiniaCustomStateProperties</span>&lt;<span class="title">StoreState</span>&lt;<span class="title">SS</span>&gt;&gt;</span></span><br><span class="line"><span class="function">&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">    <span class="comment">// @ts-expect-error: toRefs include methods and others</span></span><br><span class="line">    <span class="keyword">return</span> toRefs(store) <span class="comment">// vue2 ç‰ˆæœ¬ç›´æ¥all in ref</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  </span><br><span class="line">    store = toRaw(store) <span class="comment">// æ‹¿åˆ°storeåŸå§‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> refs = &#123;&#125; <span class="keyword">as</span> ToRefs&lt;</span><br><span class="line">      StoreState&lt;SS&gt; &amp;</span><br><span class="line">        StoreGetters&lt;SS&gt; &amp;</span><br><span class="line">        PiniaCustomStateProperties&lt;StoreState&lt;SS&gt;&gt;</span><br><span class="line">    &gt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> store) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = store[key]</span><br><span class="line">      <span class="comment">// åªè½¬æ¢refã€reactiveå±æ€§</span></span><br><span class="line">      <span class="keyword">if</span> (isRef(value) || isReactive(value)) &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error: the key is state or getter</span></span><br><span class="line">        refs[key] =</span><br><span class="line">          <span class="comment">// ---</span></span><br><span class="line">          toRef(store, key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> refs</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mapç³»åˆ—è¾…åŠ©å‡½æ•°"><a href="#mapç³»åˆ—è¾…åŠ©å‡½æ•°" class="headerlink" title="mapç³»åˆ—è¾…åŠ©å‡½æ•°"></a>mapç³»åˆ—è¾…åŠ©å‡½æ•°</h2><ul><li><h2 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h2></li></ul><p>åŸºæœ¬ä½¿ç”¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥è®¿é—®ç»„ä»¶ä¸­çš„ this.count</span></span><br><span class="line">    <span class="comment">// ä¸ä» store.count ä¸­è¯»å–çš„æ•°æ®ç›¸åŒ</span></span><br><span class="line">    ...mapState(useCounterStore, [<span class="string">'count'</span>])</span><br><span class="line">    <span class="comment">// ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†å°†å…¶æ³¨å†Œä¸º this.myOwnName</span></span><br><span class="line">    ...mapState(useCounterStore, &#123;</span><br><span class="line">      myOwnName: <span class="string">'count'</span>,</span><br><span class="line">      <span class="comment">// ä½ ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥è·å¾—å¯¹ store çš„è®¿é—®æƒ</span></span><br><span class="line">      double: <span class="function"><span class="params">store</span> =&gt;</span> store.count * <span class="number">2</span>,</span><br><span class="line">      <span class="comment">// å®ƒå¯ä»¥è®¿é—® `this`ï¼Œä½†å®ƒæ²¡æœ‰æ ‡æ³¨ç±»å‹...</span></span><br><span class="line">      magicValue(store) &#123;</span><br><span class="line">        <span class="keyword">return</span> store.someGetter + <span class="keyword">this</span>.count + <span class="keyword">this</span>.double</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mapState</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mapHelpers.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mapState</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">_GettersTree</span>&lt;<span class="title">S</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  useStore: StoreDefinition&lt;Id, S, G, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  keysOrMapper: <span class="built_in">any</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">_MapStateReturn</span>&lt;<span class="title">S</span>, <span class="title">G</span>&gt; | <span class="title">_MapStateObjectReturn</span>&lt;<span class="title">Id</span>, <span class="title">S</span>, <span class="title">G</span>, <span class="title">A</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªå¯¹è±¡ä½¿å¾—èƒ½å¤Ÿæ”¾åˆ°ç»„ä»¶çš„computedå±æ€§ä¸Š</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(keysOrMapper)</span><br><span class="line">    ? keysOrMapper.reduce(<span class="function">(<span class="params">reduced, key</span>) =&gt;</span> &#123;</span><br><span class="line">        reduced[key] = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="keyword">this</span>: ComponentPublicInstance</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// é€šè¿‡useStoreï¼Œå› ä¸ºstoreå·²ç»åˆ›å»ºï¼Œæ‰€ä»¥å†…éƒ¨ä¼šç›´æ¥é€šè¿‡pinia._s.get(id)ç›´æ¥è¿”å›storeè€Œä¸ä¼šé‡æ–°åˆ›å»º</span></span><br><span class="line">          <span class="keyword">return</span> useStore(<span class="keyword">this</span>.$pinia)[key]</span><br><span class="line">        &#125; <span class="keyword">as</span> () =&gt; <span class="built_in">any</span></span><br><span class="line">        <span class="keyword">return</span> reduced</span><br><span class="line">      &#125;, &#123;&#125; <span class="keyword">as</span> _MapStateReturn&lt;S, G&gt;)</span><br><span class="line">    : <span class="built_in">Object</span>.keys(keysOrMapper).reduce(<span class="function">(<span class="params">reduced, key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error</span></span><br><span class="line">        reduced[key] = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="keyword">this</span>: ComponentPublicInstance</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">const</span> store = useStore(<span class="keyword">this</span>.$pinia)</span><br><span class="line">          <span class="keyword">const</span> storeKey = keysOrMapper[key]</span><br><span class="line">          <span class="comment">// for some reason TS is unable to infer the type of storeKey to be a</span></span><br><span class="line">          <span class="comment">// function</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">typeof</span> storeKey === <span class="string">'function'</span></span><br><span class="line">            ? <span class="function">(<span class="params">storeKey <span class="keyword">as</span> (<span class="params">store: Store&lt;Id, S, G, A&gt;</span>) =&gt; <span class="built_in">any</span></span>).<span class="params">call</span>(<span class="params"><span class="keyword">this</span>, store</span>)</span></span><br><span class="line"><span class="function">            : <span class="params">store</span>[<span class="params">storeKey</span>]</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">reduced</span></span></span><br><span class="line"><span class="function">      &#125;, &#123;&#125; <span class="params">as</span> _<span class="params">MapStateObjectReturn</span>&lt;<span class="params">Id</span>, <span class="params">S</span>, <span class="params">G</span>, <span class="params">A</span>&gt;)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><ul><li><h2 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h2></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapGetters = mapState <span class="comment">//ğŸ‘</span></span><br></pre></td></tr></table></figure><ul><li><h2 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h2></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mapActions</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">Id</span> <span class="title">extends</span> <span class="title">string</span>,</span></span><br><span class="line"><span class="function">  <span class="title">S</span> <span class="title">extends</span> <span class="title">StateTree</span>,</span></span><br><span class="line"><span class="function">  <span class="title">G</span> <span class="title">extends</span> <span class="title">_GettersTree</span>&lt;<span class="title">S</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">A</span>,</span></span><br><span class="line"><span class="function">  <span class="title">KeyMapper</span> <span class="title">extends</span> <span class="title">Record</span>&lt;<span class="title">string</span>, <span class="title">keyof</span> <span class="title">A</span>&gt;</span></span><br><span class="line"><span class="function">&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  useStore: StoreDefinition&lt;Id, S, G, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  keysOrMapper: <span class="built_in">Array</span>&lt;keyof A&gt; | KeyMapper</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">_MapActionsReturn</span>&lt;<span class="title">A</span>&gt; | <span class="title">_MapActionsObjectReturn</span>&lt;<span class="title">A</span>, <span class="title">KeyMapper</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(keysOrMapper)</span><br><span class="line">    ? keysOrMapper.reduce(<span class="function">(<span class="params">reduced, key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å’ŒmapStateç±»ä¼¼,é—­åŒ…å­˜äº†ä¸‹thiså’Œå…¶ä»–å‚æ•°</span></span><br><span class="line">        reduced[key] = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">this</span>: ComponentPublicInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">          ...args: <span class="built_in">any</span>[]</span></span></span><br><span class="line"><span class="function"><span class="params">        </span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> useStore(<span class="keyword">this</span>.$pinia)[key](...args)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reduced</span><br><span class="line">      &#125;, &#123;&#125; <span class="keyword">as</span> _MapActionsReturn&lt;A&gt;)</span><br><span class="line">    : <span class="built_in">Object</span>.keys(keysOrMapper).reduce(<span class="function">(<span class="params">reduced, key: keyof KeyMapper</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error</span></span><br><span class="line">        reduced[key] = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">this</span>: ComponentPublicInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">          ...args: <span class="built_in">any</span>[]</span></span></span><br><span class="line"><span class="function"><span class="params">        </span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> useStore(<span class="keyword">this</span>.$pinia)[keysOrMapper[key]](...args)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reduced</span><br><span class="line">      &#125;, &#123;&#125; <span class="keyword">as</span> _MapActionsObjectReturn&lt;A, KeyMapper&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å’ŒvuexåŒºåˆ«"><a href="#å’ŒvuexåŒºåˆ«" class="headerlink" title="å’ŒvuexåŒºåˆ«"></a>å’ŒvuexåŒºåˆ«</h2><ul><li><h2 id="ä¸å†æœ‰åµŒå¥—ç»“æ„çš„æ¨¡å—"><a href="#ä¸å†æœ‰åµŒå¥—ç»“æ„çš„æ¨¡å—" class="headerlink" title="ä¸å†æœ‰åµŒå¥—ç»“æ„çš„æ¨¡å—"></a>ä¸å†æœ‰åµŒå¥—ç»“æ„çš„æ¨¡å—</h2><ul><li>çœ‹è¿‡vuexçš„åº”è¯¥çŸ¥é“ï¼Œæ•´ä¸ªvuexå°±æ˜¯ä¸ªåµŒå¥—çš„å¤§å¯¹è±¡ï¼Œä¼šæ ¹æ®å‘½åç©ºé—´ä¸€æ­¥ä¸€æ­¥ä»å¯¹è±¡ä¸­å–å‡ºå†…å®¹ï¼Œä¸è¿‡å†…éƒ¨ä¼šå¸®ä½ æ‹¼æ¥å‘½åç©ºé—´è·¯å¾„ï¼Œå®é™…è°ƒç”¨æ—¶ä¹Ÿè¿˜å¥½</li><li>è€Œpiniaä¸å†é€šè¿‡å‘½åç©ºé—´æ¥åµŒå¥—å¯¹è±¡ï¼Œé€šè¿‡pinia._sè¿™ä¸ªMapç»“æ„æ¥å­˜å‚¨åˆ›å»ºçš„storeï¼Œé€šè¿‡pinia.state.value[storeId]æ¥å­˜å‚¨stateï¼Œæ•´ä¸ªå°±æ˜¯ä¸€å¹³çº§çš„ç»“æ„</li></ul></li><li><h2 id="åˆ›å»ºéå¸¸æ–¹ä¾¿ï¼Œå’Œå†™ä¸€ä¸ªhookå‡½æ•°ä¸€æ ·è½»æ¾"><a href="#åˆ›å»ºéå¸¸æ–¹ä¾¿ï¼Œå’Œå†™ä¸€ä¸ªhookå‡½æ•°ä¸€æ ·è½»æ¾" class="headerlink" title="åˆ›å»ºéå¸¸æ–¹ä¾¿ï¼Œå’Œå†™ä¸€ä¸ªhookå‡½æ•°ä¸€æ ·è½»æ¾"></a>åˆ›å»ºéå¸¸æ–¹ä¾¿ï¼Œå’Œå†™ä¸€ä¸ªhookå‡½æ•°ä¸€æ ·è½»æ¾</h2><ul><li>è™½ç„¶ä½†æ˜¯ï¼Œæ€»è§‰å¾—vueè¶Šæ¥è¶ŠåƒReactï¼Œç”¨è¿‡hoxçš„åº”è¯¥çŸ¥é“ï¼ŒPiniaçš„ä½¿ç”¨æ–¹å¼å‡ ä¹å’Œhoxä¸€æ¨¡ä¸€æ ·ã€‚ã€‚ã€‚</li></ul></li><li><h2 id="æ— éœ€mutation"><a href="#æ— éœ€mutation" class="headerlink" title="æ— éœ€mutation"></a>æ— éœ€mutation</h2><ul><li>è§ä»è§æ™ºå§ï¼Œæœ‰ä¸ªmutationè°ƒç”¨æµç¨‹æ›´è§„èŒƒï¼Œæ²¡æœ‰å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼Œæ— å­¦ä¹ æˆæœ¬</li></ul></li><li><p>æ€»ç»“ä¸€ä¸‹ï¼Œè™½ç„¶å•é¡¹æ•°æ®æµç±»å‹çš„çŠ¶æ€ç®¡ç†åº“ï¼ˆreduxã€vuexï¼‰å…·æœ‰ååˆ†ä¸¥è°¨çš„è°ƒç”¨æ­¥éª¤ï¼Œä½†è¿™ç§å‡½æ•°å¼çš„æ–¹å¼æ‰æ˜¯æœªæ¥ï¼ˆä¸»è¦æ˜¯å¼€å‘çˆ½äº†ã€‚ã€‚ã€‚ï¼‰</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åˆ›å»ºpinia&quot;&gt;&lt;a href=&quot;#åˆ›å»ºpinia&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºpinia&quot;&gt;&lt;/a&gt;åˆ›å»ºpinia&lt;/h2&gt;&lt;p&gt;åŸºæœ¬ä½¿ç”¨&lt;/p&gt;
&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;tab
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Vue3å“åº”å¼å±æ€§Reactiveå’ŒRef</title>
    <link href="https://summxu.github.io/2023/Vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B1%9E%E6%80%A7Reactive%E5%92%8CRef/"/>
    <id>https://summxu.github.io/2023/Vue3å“åº”å¼å±æ€§Reactiveå’ŒRef/</id>
    <published>2023-02-27T00:49:38.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ref-çš„åŸºæœ¬ä½¿ç”¨"><a href="#ref-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ref çš„åŸºæœ¬ä½¿ç”¨"></a>ref çš„åŸºæœ¬ä½¿ç”¨</h2><p>1.ref:æ¥å—ä¸€ä¸ªå†…éƒ¨å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯å˜çš„ ref å¯¹è±¡ã€‚ref å¯¹è±¡ä»…æœ‰ä¸€ä¸ª <code>.value</code> propertyï¼ŒæŒ‡å‘è¯¥å†…éƒ¨å€¼ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šè¢«refåŒ…è£…ä¹‹åéœ€è¦.value æ¥è¿›è¡Œèµ‹å€¼ï¼Œå› ä¸ºä½¿ç”¨refåŒ…è£…ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒRef TSå¯¹åº”çš„æ¥å£</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, Ref &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">const message: Ref&lt;string&gt; = ref('refå“åº”å¼æ•°æ®');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  message.value = 'ä¿®æ”¹åçš„æ•°æ®';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>tsçš„å¦å¤–ä¸€ç§æ–¹å¼ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">const message = ref&lt;string | number&gt;('refå“åº”å¼æ•°æ®');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  message.value = 'ä¿®æ”¹åçš„æ•°æ®';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>3.shallowRefåˆ›å»ºä¸€ä¸ªè·Ÿè¸ªè‡ªèº« <code>.value</code> å˜åŒ–çš„ refï¼Œä½†ä¸ä¼šä½¿å…¶å€¼ä¹Ÿå˜æˆå“åº”å¼çš„ã€‚&lt;template&gt;</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, shallowRef &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">type Obj = &#123;</span></span><br><span class="line"><span class="regexp">  name: string;</span></span><br><span class="line"><span class="regexp">  num: number;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">const message = shallowRef&lt;Obj&gt;(&#123;</span></span><br><span class="line"><span class="regexp">  name: 'vue3',</span></span><br><span class="line"><span class="regexp">  num: 100</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ä¿®æ”¹çš„å€¼æ— æ³•æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</span></span><br><span class="line"><span class="regexp">  message.value.name = 'ä¿®æ”¹äº†name';</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ä¿®æ”¹çš„å€¼å¯ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/message.value = &#123; name: 'ä¿®æ”¹äº†name', num: 123 &#125;;ã€€</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/triggerRefå¼ºåˆ¶ä¿®æ”¹ï¼Œä¿®æ”¹çš„å€¼å¯ä»¥åœ¨é¡µé¢æ˜¾ç¤º  </span></span><br><span class="line"><span class="regexp">  triggerRef(message);</span></span><br><span class="line"><span class="regexp">  console.log(message, 'message');</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>4.customRef æ˜¯ä¸ªå·¥å‚å‡½æ•°è¦æ±‚æˆ‘ä»¬è¿”å›ä¸€ä¸ªå¯¹è±¡ å¹¶ä¸”å®ç° get å’Œ setï¼š</p><p>åº”ç”¨åœºæ™¯ï¼šå®ç°é˜²æŠ–å‡½æ•°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, shallowRef, triggerRef, customRef &#125; from 'vue';</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">let message = MycustomRef('æˆ‘æ˜¯åŸå§‹æ•°æ®');</span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  message.value = 'ä¿®æ”¹äº†æ•°æ®';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">function MycustomRef&lt;T&gt;(value: T) &#123;</span></span><br><span class="line"><span class="regexp">  return customRef((track, trigger) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      get: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        track();/</span><span class="regexp">/é€šçŸ¥vueï¼Œè·Ÿè¸ªæ•°æ®çš„å˜åŒ–</span></span><br><span class="line"><span class="regexp">        return value;</span></span><br><span class="line"><span class="regexp">      &#125;,</span></span><br><span class="line"><span class="regexp">      set: (newVal: T) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        value = newVal;</span></span><br><span class="line"><span class="regexp">        trigger();/</span><span class="regexp">/é€šçŸ¥vueé‡æ–°è§£ææ¨¡ç‰ˆï¼ŒæŒ‚è½½æ•°æ®</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><h2 id="ref-ä¸ºä½•è¦ç”¨-value"><a href="#ref-ä¸ºä½•è¦ç”¨-value" class="headerlink" title="ref ä¸ºä½•è¦ç”¨.value"></a>ref ä¸ºä½•è¦ç”¨.value</h2><blockquote><p>åœ¨Vue2ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½é€šè¿‡ä¸€ä¸ªDataè¿›è¡Œç»Ÿä¸€çš„è¿”å›ï¼Œå¹¶ä¸”åœ¨dataä¸­å¯¹æŸä¸ªç»„ä»¶è¦ç”¨çš„æ•°æ®è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œå¸¸è§çš„ä½¿ç”¨å½¢å¼æ˜¯è¿™æ ·çš„ï¼š</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">Â  &lt;div <span class="keyword">class</span>=<span class="string">"div"</span>&gt;</span><br><span class="line">Â  Â  &lt;todos :Obj=<span class="string">"tos"</span> :removeObj=<span class="string">"removeObj"</span>&gt;&lt;<span class="regexp">/todos&gt;</span></span><br><span class="line"><span class="regexp">Â  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">import search from '@/</span>components/search<span class="string">'</span></span><br><span class="line"><span class="string">import todos from '</span>@/components/todos<span class="string">'</span></span><br><span class="line"><span class="string">import all from '</span>@/components/all<span class="string">'</span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string">Â  name: '</span>App<span class="string">',</span></span><br><span class="line"><span class="string">Â  data () &#123;</span></span><br><span class="line"><span class="string">Â  Â  return &#123;</span></span><br><span class="line"><span class="string">Â  Â  Â  tos: [</span></span><br><span class="line"><span class="string">Â  Â  Â  Â  &#123; id: '</span><span class="number">001</span><span class="string">', value: '</span>ç¬¬ä¸€ä¸ª<span class="string">', done: true &#125;,</span></span><br><span class="line"><span class="string">Â  Â  Â  Â  &#123; id: '</span><span class="number">002</span><span class="string">', value: '</span>ç¬¬äºŒä¸ª<span class="string">', done: true &#125;,</span></span><br><span class="line"><span class="string">Â  Â  Â  Â  &#123; id: '</span><span class="number">003</span><span class="string">', value: '</span>ç¬¬ä¸‰ä¸ª<span class="string">', done: false &#125;,</span></span><br><span class="line"><span class="string">Â  Â  Â  Â  &#123; id: '</span><span class="number">004</span><span class="string">', value: '</span>ç¬¬å››ä¸ª<span class="string">', done: true &#125;,</span></span><br><span class="line"><span class="string">Â  Â  Â  ],</span></span><br><span class="line"><span class="string">Â  Â  &#125;</span></span><br><span class="line"><span class="string">Â  &#125;,</span></span><br><span class="line"><span class="string">Â  computed: &#123; &#125;,</span></span><br><span class="line"><span class="string">Â  components: &#123;</span></span><br><span class="line"><span class="string">Â  Â  search, todos, all,</span></span><br><span class="line"><span class="string">Â  &#125;,</span></span><br><span class="line"><span class="string">Â  methods: &#123;</span></span><br><span class="line"><span class="string">Â  Â  removeObj (obj) &#123;</span></span><br><span class="line"><span class="string">Â  Â  Â  console.log(obj.id)</span></span><br><span class="line"><span class="string">Â  Â  Â  this.tos = this.tos.filter(item =&gt; item.id !== obj.id)</span></span><br><span class="line"><span class="string">Â  Â  Â  console.log(this.tos)</span></span><br><span class="line"><span class="string">Â  Â  &#125;,</span></span><br><span class="line"><span class="string">Â  &#125;,</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥è¿™é‡Œå®šä¹‰çš„å†…å®¹éƒ½åœ¨ä¸€ä¸ªæ•°ç»„ä¸­è¿›è¡Œï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°†è¦ä½¿ç”¨çš„æ•°æ®è¿”å›å‡ºæ¥ï¼Œè¿™é‡Œæ— è®ºæ€ä¹ˆè¿›è¡Œæ“ä½œå¤„ç†ï¼Œæœ€ç»ˆè¿›è¡Œæ•°æ®ä»£ç†çš„æ—¶å€™å¾—åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒVue2ä¸­ç›´æ¥é€šè¿‡definePropertyè¿›è¡Œå¤„ç†ï¼Œå¹¶ç»‘å®šå¯¹åº”çš„ç›‘å¬äº‹ä»¶è¿›è¡Œå“åº”å¼çš„å¤„ç†ã€‚</p><p>è€ŒVue3ä¸­ï¼Œæ•°æ®çš„å®šä¹‰å¯ä»¥æ˜¯å•ç‹¬çš„ï¼ŒVueå¯ä»¥è®©éšæ—¶éœ€è¦éšæ—¶å®šä¹‰ï¼Œè¿™ä¹Ÿå°±å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦çš„ä¸€ä¸ªæ•°æ®å¯èƒ½ä¸æ˜¯å¯¹è±¡</p><p><strong>å¦‚æœè¦å®šä¹‰çš„æ•°æ®ä¸æ˜¯å¯¹è±¡ï¼Œè¿˜éœ€è¦ä»£ç†ä¼šæ€ä¹ˆæ ·ï¼Ÿ</strong></p><ul><li><code>Object.defineProperty()</code> æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡ã€‚</li></ul><p>é€šè¿‡è¿™ä¸ªå¯ä»¥æ˜ç¡®çœ‹å‡ºï¼Œåªèƒ½è¿›è¡Œå¯¹è±¡çš„ä»£ç†ï¼Œä¸èƒ½è¿›è¡Œæ™®é€šæ•°æ®çš„ä»£ç†</p><p>åœ¨Vue3ä¸­æ•°æ®ä»£ç†å¯ä»¥ä½¿ç”¨å•ä¸€æ•°æ®äº†ï¼Œå¹¶ä¸”ä¹Ÿæ”¹è¿›äº†æ•°æ®ä»£ç†çš„æ–¹å¼ï¼Œä½¿ç”¨çš„æ˜¯<code>Proxy</code>å®Œæˆäº†æ•°æ®ä»£ç†ï¼Œè€ŒMDNä¸­å¯¹<code>Proxy</code>ä¹Ÿè¿›è¡Œäº†å®šä¹‰ï¼š</p><ul><li><code>Proxy</code> å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚</li></ul><p>å³ä½¿æ˜¯Vue3ä¸­ä½¿ç”¨çš„<code>Proxy</code>çš„ä»£ç†æ–¹å¼ä¹Ÿä¸èƒ½è¿›è¡Œæ™®é€šæ•°æ®çš„ä»£ç†ï¼Œæ‰€ä»¥å½“è°ƒç”¨Refçš„æ—¶å€™å…¶å®ä»ç„¶åˆ›å»ºäº†ä¸€ä¸ª<code>Proxy</code>å¯¹è±¡ï¼Œå¹¶ä¸”Vueå¸®ä½ ç»™è¿™ä¸ªå¯¹è±¡äº†ä¸€ä¸ªvalueå±æ€§ï¼Œå±æ€§å€¼å°±æ˜¯ä½ å®šä¹‰çš„å†…å®¹ï¼Œæ”¹å˜çš„æ—¶å€™ç›‘è§†çš„æ”¹å˜ä¾ç„¶æ˜¯é€šè¿‡<code>Proxy</code>çš„æ•°æ®åŠ«æŒæ¥è¿›è¡Œå“åº”å¼çš„å¤„ç†ï¼Œè€Œæ¨¡æ¿ä¸­ä½¿ç”¨çš„æ—¶å€™Vueä¼šé»˜è®¤è°ƒç”¨å¯¹åº”çš„valueå±æ€§ï¼Œä»è€Œå®Œæˆæ¨¡æ¿ä¸­çš„å†…å®¹çš„ç›´æ¥è°ƒç”¨ </p><h2 id="Reactive-çš„åŸºæœ¬ä½¿ç”¨"><a href="#Reactive-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Reactive çš„åŸºæœ¬ä½¿ç”¨"></a>Reactive çš„åŸºæœ¬ä½¿ç”¨</h2><p>1.reactive:ç”¨æ¥ç»‘å®šå¤æ‚çš„æ•°æ®ç±»å‹ï¼šæ•°ç»„ï¼Œå¯¹è±¡ç­‰ã€‚</p><p><strong>æ³¨æ„</strong>:reactiveå¦‚æœç»‘å®šçš„æ˜¯åŸºç¡€ç±»å‹æ•°æ®ä¼šæŠ¥é”™ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; obj.name &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; reactive &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">let obj = reactive(&#123;</span></span><br><span class="line"><span class="regexp">  name: 'å¼ ä¸‰',</span></span><br><span class="line"><span class="regexp">  age: 18,</span></span><br><span class="line"><span class="regexp">  boj: &#123;</span></span><br><span class="line"><span class="regexp">    namespaced: true</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  obj.name = 'å¼‚æ­¥èµ‹å€¼æ— æ•ˆ';</span></span><br><span class="line"><span class="regexp">&#125;, 2000);</span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  obj.name = 'æå››';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>2.readonly:æ‹·è´ä¸€ä»½proxyå¯¹è±¡å¹¶è®¾ç½®ä¸ºåªè¯»å±æ€§</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; obj.name &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; reactive, readonly &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">let obj = reactive(&#123;</span></span><br><span class="line"><span class="regexp">  name: 'å¼ ä¸‰',</span></span><br><span class="line"><span class="regexp">  age: 18,</span></span><br><span class="line"><span class="regexp">  boj: &#123;</span></span><br><span class="line"><span class="regexp">    namespaced: true</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">let CopyObj = readonly(obj);</span></span><br><span class="line"><span class="regexp">setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  CopyObj.name = 'å¼‚æ­¥èµ‹å€¼æ— æ•ˆ';</span></span><br><span class="line"><span class="regexp">&#125;, 2000);</span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  CopyObj.name = 'æå››';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>3.shallowReactive:æ‹·è´ä¸€ä»½å¯¹è±¡ï¼Œå¯ä»¥ä¿®æ”¹æµ…å±‚æ•°æ®ï¼Œæ— æ³•ä¿®æ”¹æ·±å±‚æ•°æ®</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"onChangeMsg"</span>&gt;ä¿®æ”¹æ•°æ®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&#123;&#123; obj.name &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; reactive, shallowReactive &#125; from 'vue';</span></span><br><span class="line"><span class="regexp">let obj = reactive(&#123;</span></span><br><span class="line"><span class="regexp">  name: 'å¼ ä¸‰',</span></span><br><span class="line"><span class="regexp">  age: 18,</span></span><br><span class="line"><span class="regexp">  boj: &#123;</span></span><br><span class="line"><span class="regexp">    namespaced: true</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">let CopyObj = shallowReactive(obj);</span></span><br><span class="line"><span class="regexp">setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/å¯ä»¥ä¿®æ”¹</span></span><br><span class="line"><span class="regexp">  CopyObj.name = 'å¼‚æ­¥èµ‹å€¼';</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/æ— æ³•ä¿®æ”¹</span></span><br><span class="line"><span class="regexp">  CopyObj.boj.namespaced = false;</span></span><br><span class="line"><span class="regexp">&#125;, 2000);</span></span><br><span class="line"><span class="regexp">console.log(CopyObj.boj.namespaced);</span></span><br><span class="line"><span class="regexp">const onChangeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  CopyObj.name = 'æå››';</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ref-çš„åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#ref-çš„åŸºæœ¬ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ref çš„åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;/a&gt;ref çš„åŸºæœ¬ä½¿ç”¨&lt;/h2&gt;&lt;p&gt;1.ref:æ¥å—ä¸€ä¸ªå†…éƒ¨å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯å˜çš„ ref å¯¹è±¡ã€‚ref å¯¹è±¡ä»…æœ‰ä¸€
      
    
    </summary>
    
    
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Vue3ä¸­watchå’ŒwatchEffectçš„ç”¨æ³•å’ŒåŒºåˆ«</title>
    <link href="https://summxu.github.io/2022/Vue3%E4%B8%ADwatch%E5%92%8CwatchEffect%E7%9A%84%E7%94%A8%E6%B3%95%E5%92%8C%E5%8C%BA%E5%88%AB/"/>
    <id>https://summxu.github.io/2022/Vue3ä¸­watchå’ŒwatchEffectçš„ç”¨æ³•å’ŒåŒºåˆ«/</id>
    <published>2022-10-12T09:13:34.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-1-watch-åŸºæœ¬ä½¿ç”¨"><a href="#1-1-watch-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1.1 watch åŸºæœ¬ä½¿ç”¨"></a>1.1 watch åŸºæœ¬ä½¿ç”¨</h3><p>åœ¨ Vue3 ä¸­çš„ç»„åˆå¼ API ä¸­ï¼Œwatch çš„ä½œç”¨å’Œ Vue2 ä¸­çš„ watch ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬éƒ½æ˜¯ç”¨æ¥ç›‘å¬å“åº”å¼çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„ï¼Œå½“å“åº”å¼çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;img alt=<span class="string">"Vue logo"</span> src=<span class="string">"./assets/logo.png"</span> /&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button @click="changeMsg"&gt;æ›´æ”¹ message&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, watch &#125; from "vue";</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const message = ref("æå››");</span></span><br><span class="line"><span class="regexp">watch(message, (newValue, oldValue) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log("æ–°çš„å€¼:", newValue);</span></span><br><span class="line"><span class="regexp">  console.log("æ—§çš„å€¼:", oldValue);</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">const changeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  message.value = "å¼ ä¸‰";</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­ç‚¹å‡»æŒ‰é’®å°±ä¼šæ›´æ”¹å“åº”å¼å˜é‡ message çš„å€¼ã€‚åˆä½¿ç”¨ watch ç›‘å¬å™¨ç›‘å¬äº† message å˜é‡ï¼Œå½“å®ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘ watch ç›‘å¬å‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å›è°ƒå‡½æ•°é»˜è®¤æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šæ–°å€¼å’Œæ—§å€¼ã€‚</p><p><strong>æ³¨æ„ï¼šå½“ç¬¬ä¸€è¿›å…¥é¡µé¢æ—¶ï¼Œwatch ç›‘å¬å‡½æ•°çš„å›è°ƒå‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚</strong></p><h3 id="1-2-watch-ç›‘å¬ç±»å‹"><a href="#1-2-watch-ç›‘å¬ç±»å‹" class="headerlink" title="1.2 watch ç›‘å¬ç±»å‹"></a>1.2 watch ç›‘å¬ç±»å‹</h3><p>å‰é¢ä¸€ç›´å¼ºè°ƒ watch ç›‘å¬çš„æ˜¯å“åº”å¼æ•°æ®ï¼Œå¦‚æœç›‘å¬çš„æ•°æ®ä¸æ˜¯å“åº”å¼çš„ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæŠ›å‡ºè­¦å‘Šã€‚</p><p><strong>ï¼ˆ1ï¼‰ref å’Œè®¡ç®—å±æ€§</strong></p><p>ref å®šä¹‰çš„æ•°æ®æ˜¯å¯ä»¥ç›‘å¬åˆ°çš„ï¼Œå› ä¸ºå‰é¢çš„ä»£ç ä»¥åŠè¯æ˜äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè®¡ç®—å±æ€§ä¹Ÿæ˜¯å¯ä»¥ç›‘å¬åˆ°çš„ï¼Œæ¯”å¦‚ä¸‹åˆ—ä»£ç ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> message = ref(<span class="string">"æå››"</span>);</span><br><span class="line"><span class="keyword">const</span> newMessage = computed(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> message.value;</span><br><span class="line">&#125;);</span><br><span class="line">watch(newMessage, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“ message å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®¡ç®—å±æ€§ newMessage ä¹Ÿä¼šé‡æ–°è®¡ç®—å¾—å‡ºæ–°çš„ç»“æœï¼Œ watch ç›‘å¬å‡½æ•°æ˜¯å¯ä»¥ç›‘å¬åˆ°è®¡ç®—å±æ€§å˜åŒ–çš„ã€‚</p><p><strong>ï¼ˆ2ï¼‰getter å‡½æ•°</strong></p><p>è¿™é‡Œçš„ getter å‡½æ•°å¯ä»¥ç®€å•çš„ç†è§£ä¸ºè·å–æ•°æ®çš„ä¸€ä¸ªå‡½æ•°ï¼Œè¯´ç™½äº†è¯¥å‡½æ•°å°±æ˜¯ä¸€ä¸ªè¿”å›å€¼çš„æ“ä½œï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸è®¡ç®—å±æ€§ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;img alt=<span class="string">"Vue logo"</span> src=<span class="string">"./assets/logo.png"</span> /&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;p&gt;&#123;&#123; x1 + x2 &#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">  &lt;button <span class="meta">@click</span>=<span class="string">"changeMsg"</span>&gt;æ›´æ”¹ message&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script setup lang=<span class="string">"ts"</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message = ref(<span class="string">"æå››"</span>);</span><br><span class="line"><span class="keyword">const</span> x1 = ref(<span class="number">12</span>);</span><br><span class="line"><span class="keyword">const</span> x2 = ref(<span class="number">13</span>);</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; x1.value + x2.value,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> changeMsg = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  message.value = <span class="string">"å¼ ä¸‰"</span>;</span><br><span class="line">  x1.value = <span class="number">14</span>;</span><br><span class="line">  x2.value = <span class="number">23</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­ watch ç›‘å¬å™¨ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ getter å‡½æ•°ï¼Œgetter å‡½æ•°è¿”å›çš„æ˜¯å“åº”å¼æ•°æ® x1 å’Œ x2 ç›¸åŠ çš„å€¼ï¼Œå½“è¿™ä¸¤ä¸ªä¸­ä¸­æœ‰ä¸€ä¸ªå˜åŒ–ï¼Œéƒ½ä¼šæ‰§è¡Œ watch ä¸­çš„å›è°ƒå‡½æ•°ã€‚æœ‰ç‚¹åƒæ˜¯ç›´æ¥æŠŠè®¡ç®—å±æ€§å†™åˆ°ç›‘å¬å™¨é‡Œé¢å»äº†ã€‚</p><p><strong>ï¼ˆ3ï¼‰ç›‘å¬å“åº”å¼å¯¹è±¡</strong></p><p>å‰é¢ç›‘å¬çš„éƒ½æ˜¯å€¼ç±»å‹çš„å“åº”å¼æ•°æ®ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç›‘å¬å“åº”å¼çš„å¯¹è±¡ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watch(<span class="built_in">number</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“ watch ç›‘å¬çš„æ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡æ—¶ï¼Œä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªæ·±å±‚ä¾¦å¬å™¨ï¼Œå³è¯¥å“åº”å¼å¯¹è±¡é‡Œé¢çš„ä»»ä½•å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šè§¦å‘ç›‘å¬å‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°ã€‚</p><p>éœ€è¦æ³¨æ„çš„ï¼Œwatch ä¸èƒ½ç›´æ¥ç›‘å¬å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œå³ä¸‹é¢çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watch(<span class="built_in">number</span>.count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­ç›¸å½“äºä½ ç›´æ¥å‘ watch ä¼ é€’äº†ä¸€ä¸ªéå“åº”å¼çš„æ•°å­—ï¼Œç„¶è€Œ watch åªèƒ½ç›‘å¬å“åº”å¼æ•°æ®ã€‚</p><p><strong>ä½†æ˜¯ï¼š</strong></p><p>å¦‚æœéè¦ç›‘å¬å“åº”å¼å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ getter å‡½æ•°çš„å½¢å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">watch(</span><br><span class="line">  () =&gt; <span class="built_in">number</span>.count,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¹Ÿæ˜¯å¯ä»¥ç›‘å¬åˆ° count å˜åŒ–çš„ã€‚</p><p><strong>ï¼ˆ4ï¼‰ç›‘å¬å¤šä¸ªæ¥æºçš„æ•°ç»„</strong></p><p>watch è¿˜å¯ä»¥ç›‘å¬æ•°ç»„ï¼Œå‰ææ˜¯è¿™ä¸ªæ•°ç»„å†…éƒ¨å«æœ‰å“åº”å¼æ•°æ®ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x1 = ref(<span class="number">12</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watch([x1, <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">number</span>.count], <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="1-3-æ·±åº¦ç›‘å¬"><a href="#1-3-æ·±åº¦ç›‘å¬" class="headerlink" title="1.3 æ·±åº¦ç›‘å¬"></a>1.3 æ·±åº¦ç›‘å¬</h3><p>åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œå¦‚æœå°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡ä¼ é€’ç»™ watch ç›‘å¬å™¨æ—¶ï¼Œåªè¦å¯¹è±¡é‡Œé¢çš„æŸä¸ªå±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œç›‘å¬å™¨å›è°ƒå‡½æ•°ã€‚</p><p>ç©¶å…¶åŸå› ï¼Œå› ä¸ºä¼ å…¥å“åº”å¯¹è±¡ç»™ watch æ—¶ï¼Œéšå¼çš„æ·»åŠ ä¸€ä¸ªæ·±åº¦ç›‘å¬å™¨ï¼Œè¿™å°±è®©é€ æˆäº†ç‰µä¸€å‘è€Œè‡³å…¨èº«çš„æ•ˆæœã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨çš„ getter å‡½æ•°è¿”å›å“åº”å¼å¯¹è±¡çš„å½¢å¼ï¼Œé‚£ä¹ˆå“åº”å¼å¯¹è±¡çš„å±æ€§å€¼å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯ä¸ä¼šè§¦å‘ watch çš„å›è°ƒå‡½æ•°çš„ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; <span class="built_in">number</span>,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­ä½¿ç”¨ getter å‡½æ•°è¿”å›äº†å“åº”å¼å¯¹è±¡ï¼Œå½“æ›´æ”¹ number ä¸­ count çš„å€¼æ—¶ï¼Œwatch çš„å›è°ƒå‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚</p><p>ä¸ºäº†å®ç°ä¸Šè¿°ä»£ç çš„ç›‘å¬ï¼Œå¯ä»¥æ‰‹åŠ¨ç»™ç›‘å¬å™¨åŠ ä¸Šæ·±åº¦ç›‘å¬çš„æ•ˆæœã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; <span class="built_in">number</span>,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; deep: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ·»åŠ æ·±åº¦ç›‘å¬å¾ˆç®€å•ï¼Œåªéœ€è¦ç»™ watch æ·»åŠ ç¬¬ä¸‰ä¸ªå‚æ•°å³å¯ï¼š{ deep: true }ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä¸Šæ®µä»£ç ä¸­çš„ newValue å’Œ oldValue çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œé™¤éæŠŠå“åº”å¼å¯¹è±¡å³ number æ•´ä¸ªæ›¿æ¢æ‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå€¼æ‰ä¼šå˜å¾—ä¸ä¸€æ ·ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ·±åº¦ç›‘å¬ä¼šéå†å“åº”å¼å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¼€é”€è¾ƒå¤§ï¼Œå½“å¯¹è±¡ä½“å¾ˆå¤§æ—¶ï¼Œéœ€è¦æ…ç”¨<strong>ã€‚</strong></p><p><strong>æ‰€ä»¥æ¨è getter å‡½æ•°åªè¿”å›ç›¸åº”æ˜¯å¯¹è±¡ä¸­çš„æŸä¸€ä¸ªå±æ€§ï¼ï¼</strong></p><h2 id="2-watchEffect"><a href="#2-watchEffect" class="headerlink" title="2.watchEffect"></a>2.watchEffect</h2><p>å‰é¢ä½¿ç”¨ watch ç›‘å¬æ•°æ®çŠ¶æ€æ—¶ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å‘ç°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šåªæœ‰å½“ç›‘å¬çš„æ•°æ®æºå‘ç”Ÿäº†å˜åŒ–ï¼Œç›‘å¬å‡½æ•°çš„å›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚ä½†æ˜¯éœ€æ±‚æ€»æ˜¯å¤šå˜çš„ï¼Œæœ‰äº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦åˆšè¿›é¡µé¢ï¼Œæˆ–è€…è¯´ç¬¬ä¸€æ¬¡æ¸²æŸ“é¡µé¢çš„æ—¶å€™ï¼Œwatch ç›‘å¬å™¨é‡Œé¢çš„å›è°ƒå‡½æ•°å°±æ‰§è¡Œä¸€éã€‚</p><p>é¢å¯¹è¿™ç§éœ€æ±‚æ€æ ·å¤„ç†å‘¢ï¼Ÿä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p><strong>æ–¹å¼ä¸€ï¼š</strong></p><p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ watch å®ç°çš„ï¼Œç¡®åˆ‡çš„è¯´æ˜¯å·§å¦™çš„å®ç°ï¼Œè€Œä¸æ˜¯ä¾èµ–äº watch ç›‘å¬å™¨ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="comment">// è¿›å…¥é¡µé¢å…ˆæ‰§è¡Œä¸€é</span></span><br><span class="line"><span class="keyword">const</span> callback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, <span class="built_in">number</span>.count);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, <span class="built_in">number</span>.count);</span><br><span class="line">&#125;;</span><br><span class="line">callback();</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; <span class="built_in">number</span>.count,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; deep: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æƒ³è¦ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢çš„æ—¶å€™å°±æ‰§è¡Œä¸€éå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆä¸å¦¨æŠŠå›è°ƒå‡½æ•°ç›´æ¥æå–å‡ºæ¥ï¼Œè¿›å…¥é¡µé¢æ‰§è¡Œä¸€éå³å¯ï¼Œè¿™ä¹Ÿç®—æ˜¯å·§å¦™çš„å®ç°äº†çš„éœ€æ±‚ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼ä¼¼ä¹ä¸å¤ªä¼˜é›…ï¼Œè€Œä¸”æœ‰äº›ç¹çã€‚æ‰€ä»¥ Vue æ¨å‡ºäº†æ›´åŠ ä¼˜é›…çš„æ–¹æ³•ï¼šwatchEffect ç›‘å¬å™¨ã€‚</p><p><strong>æ–¹å¼äºŒï¼š</strong></p><p>watchEffect ä¹Ÿæ˜¯ä¸€ä¸ªç›‘å¬å™¨ï¼Œåªä¸è¿‡å®ƒä¸ä¼šåƒ watch é‚£æ ·æ¥æ”¶ä¸€ä¸ªæ˜ç¡®çš„æ•°æ®æºï¼Œå®ƒåªæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è€Œåœ¨è¿™ä¸ªå›è°ƒå‡½æ•°å½“ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨ç›‘å¬å“åº”æ•°æ®ï¼Œå½“å›è°ƒå‡½æ•°é‡Œé¢çš„å“åº”æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå›è°ƒå‡½æ•°å°±ä¼šç«‹å³æ‰§è¡Œã€‚</p><p>æ‰€ä»¥å¯ä»¥å°†æ–¹å¼ä¸€ä¸­çš„ä»£ç ä½¿ç”¨ watchEffect ä¼˜é›…çš„å®ç°ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">number</span> = reactive(&#123; count: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">number</span>.count++;</span><br><span class="line">&#125;;</span><br><span class="line">watchEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, <span class="built_in">number</span>.count);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­ï¼Œå½“ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼Œnumber å“åº”æ•°æ®ä»æ— åˆ°æœ‰ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè§¦å‘ watchEffect çš„å›è°ƒå‡½æ•°ï¼Œå› ä¸ºåœ¨ watchEffect å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨äº† number å“åº”æ•°æ®ï¼Œæ‰€ä»¥å®ƒä¼šè‡ªåŠ¨è·Ÿè¸ª number æ•°æ®çš„å˜åŒ–ã€‚å½“ç‚¹å‡»æŒ‰é’®æ›´æ”¹ count çš„å€¼æ—¶ï¼ŒwatchEffect ä¸­çš„å›è°ƒå‡½æ•°ä¾¿ä¼šå†æ¬¡æ‰§è¡Œã€‚</p><p>è¿™æ ·ä»£ç æ˜¯ä¸æ˜¯ç®€å•å¾ˆå¤šå‘€ï¼</p><h2 id="3-watch-å’Œ-watchEffect-åŒºåˆ«"><a href="#3-watch-å’Œ-watchEffect-åŒºåˆ«" class="headerlink" title="3.watch å’Œ watchEffect åŒºåˆ«"></a>3.watch å’Œ watchEffect åŒºåˆ«</h2><p>å·²ç»å¤§æ¦‚çŸ¥é“äº† watch å’Œ watchEffect çš„ç”¨æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ç›¸ä¿¡ä¹Ÿäº†è§£äº†ä¸€äº›ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p><ul><li>watch å’Œ watchEffect éƒ½èƒ½ç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œä¸åŒçš„æ˜¯å®ƒä»¬ç›‘å¬æ•°æ®å˜åŒ–çš„æ–¹å¼ä¸åŒã€‚</li><li>watch ä¼šæ˜ç¡®ç›‘å¬æŸä¸€ä¸ªå“åº”æ•°æ®ï¼Œè€Œ watchEffect åˆ™æ˜¯éšå¼çš„ç›‘å¬å›è°ƒå‡½æ•°ä¸­å“åº”æ•°æ®ã€‚</li><li>watch åœ¨å“åº”æ•°æ®åˆå§‹åŒ–æ—¶æ˜¯ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°çš„ï¼ŒwatchEffect åœ¨å“åº”æ•°æ®åˆå§‹åŒ–æ—¶å°±ä¼šç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</li></ul><h2 id="4-å›è°ƒä¸­çš„-DOM"><a href="#4-å›è°ƒä¸­çš„-DOM" class="headerlink" title="4.å›è°ƒä¸­çš„ DOM"></a>4.å›è°ƒä¸­çš„ DOM</h2><p>å¦‚æœåœ¨ç›‘å¬å™¨çš„å›è°ƒå‡½æ•°ä¸­æˆ–å– DOMï¼Œè¿™ä¸ªæ—¶å€™çš„ DOM æ˜¯æ›´æ–°å‰çš„è¿˜æ˜¯æ›´æ–°åçš„ï¼Ÿ</p><p>ä¸å¦¨å®éªŒä¸€ä¸‹ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;img alt=<span class="string">"Vue logo"</span> src=<span class="string">"./assets/logo.png"</span> /&gt;</span><br><span class="line">  &lt;p ref=<span class="string">"msgRef"</span>&gt;&#123;&#123; message &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button @click="changeMsg"&gt;æ›´æ”¹ message&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">&lt;script setup lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">import &#123; computed, reactive, ref, watch, watchEffect &#125; from "vue";</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const message = ref("æå››");</span></span><br><span class="line"><span class="regexp">const msgRef = ref&lt;any&gt;(null);</span></span><br><span class="line"><span class="regexp">const changeMsg = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  message.value = "å¼ ä¸‰";</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">watch(message, (newValue, oldValue) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log("DOM èŠ‚ç‚¹", msgRef.value.innerHTML);</span></span><br><span class="line"><span class="regexp">  console.log("æ–°çš„å€¼:", newValue);</span></span><br><span class="line"><span class="regexp">  console.log("æ—§çš„å€¼:", oldValue);</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç‚¹å‡»æŒ‰é’®æ›´æ”¹ message çš„å€¼ï¼Œä»â€œæå››â€å˜ä¸ºâ€œå¼ ä¸‰â€ã€‚ä½†æ˜¯å‘ç°åœ¨ç›‘å¬å™¨çš„å›è°ƒå‡½æ•°é‡Œé¢è·å–åˆ°çš„ DOM å…ƒç´ è¿˜æ˜¯â€œæå››â€ï¼Œè¯´æ˜ DOM è¿˜æ²¡æœ‰æ›´æ–°ã€‚</p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>å¦‚æœæƒ³è¦åœ¨å›è°ƒå‡½æ•°é‡Œé¢è·å–æ›´æ–°åçš„ DOMï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦å†ç»™ç›‘å¬å™¨å¤šä¼ é€’ä¸€ä¸ªå‚æ•°é€‰é¡¹å³å¯ï¼šflush: â€˜postâ€™ã€‚watch å’Œ watchEffect åŒç†ã€‚</p><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">watch(source, callback, &#123;</span><br><span class="line">  flush: <span class="string">'post'</span></span><br><span class="line">&#125;)</span><br><span class="line">watchEffect(callback, &#123;</span><br><span class="line">  flush: <span class="string">'post'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹åçš„ä»£ç ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">watch(</span><br><span class="line">  message,</span><br><span class="line">  (newValue, oldValue) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"DOM èŠ‚ç‚¹"</span>, msgRef.value.innerHTML);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ–°çš„å€¼:"</span>, newValue);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ—§çš„å€¼:"</span>, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    flush: <span class="string">"post"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™åœ¨å›è°ƒå‡½æ•°ä¸­è·å–åˆ°çš„å·²ç»æ˜¯æ›´æ–°åçš„ DOM èŠ‚ç‚¹äº†ã€‚</p><p><strong>è¡¥å……ï¼š</strong></p><p>è™½ç„¶ watch å’Œ watchEffect éƒ½å¯ä»¥ç”¨ä¸Šè¿°æ–¹æ³•è§£å†³ DOM é—®é¢˜ï¼Œä½†æ˜¯ Vue3 å•ç‹¬ç»™ watchEffect æä¾›äº†ä¸€ä¸ªæ›´æ–¹ä¾¿çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å«åš watchEffect çš„åˆ«åï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">watchPostEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* åœ¨ Vue æ›´æ–°åæ‰§è¡Œ */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="5-æ‰‹åŠ¨åœæ­¢ç›‘å¬å™¨"><a href="#5-æ‰‹åŠ¨åœæ­¢ç›‘å¬å™¨" class="headerlink" title="5.æ‰‹åŠ¨åœæ­¢ç›‘å¬å™¨"></a>5.æ‰‹åŠ¨åœæ­¢ç›‘å¬å™¨</h2><p>é€šå¸¸æ¥è¯´ï¼Œçš„ä¸€ä¸ªç»„ä»¶è¢«é”€æ¯æˆ–è€…å¸è½½åï¼Œç›‘å¬å™¨ä¹Ÿä¼šè·Ÿç€è¢«åœæ­¢ï¼Œå¹¶ä¸éœ€è¦æ‰‹åŠ¨å»å…³é—­ç›‘å¬å™¨ã€‚ä½†æ˜¯æ€»æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå³ä½¿ç»„ä»¶å¸è½½äº†ï¼Œä½†æ˜¯ç›‘å¬å™¨ä¾ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªæ—¶å€™å…¶å®å¼éœ€è¦æ‰‹åŠ¨å…³é—­å®ƒçš„ï¼Œå¦åˆ™å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸­å†™æ³•ï¼Œå°±éœ€è¦æ‰‹åŠ¨åœæ­¢ç›‘å¬å™¨ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; watchEffect &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="comment">// å®ƒä¼šè‡ªåŠ¨åœæ­¢</span></span><br><span class="line">watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// ...è¿™ä¸ªåˆ™ä¸ä¼šï¼</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šæ®µä»£ç ä¸­é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œè¿™ä¸ªæ—¶å€™ç›‘å¬å™¨æ²¡æœ‰ä¸å½“å‰ç»„ä»¶ç»‘å®šï¼Œæ‰€ä»¥å³ä½¿ç»„ä»¶é”€æ¯äº†ï¼Œç›‘å¬å™¨ä¾ç„¶å­˜åœ¨ã€‚</p><p>å…³é—­æ–¹æ³•å¾ˆç®€å•ï¼Œ<strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unwatch = watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// ...å½“è¯¥ä¾¦å¬å™¨ä¸å†éœ€è¦æ—¶</span></span><br><span class="line">unwatch()</span><br></pre></td></tr></table></figure><p>éœ€è¦ç”¨ä¸€ä¸ªå˜é‡æ¥æ”¶ç›‘å¬å™¨å‡½æ•°çš„è¿”å›å€¼ï¼Œå…¶å®å°±æ˜¯è¿”å›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ï¼Œå³å¯å…³é—­å½“å‰ç›‘å¬å™¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-1-watch-åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#1-1-watch-åŸºæœ¬ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;1.1 watch åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;/a&gt;1.1 watch åŸºæœ¬ä½¿ç”¨&lt;/h3&gt;&lt;p&gt;åœ¨ Vue3 ä¸­çš„ç»„åˆå¼ API ä¸­ï¼Œwat
      
    
    </summary>
    
    
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Reactå®ç°åŸç†åŠFiberæ¶æ„</title>
    <link href="https://summxu.github.io/2022/React%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8AFiber%E6%9E%B6%E6%9E%84/"/>
    <id>https://summxu.github.io/2022/Reactå®ç°åŸç†åŠFiberæ¶æ„/</id>
    <published>2022-05-12T01:36:14.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vdom"><a href="#vdom" class="headerlink" title="vdom"></a>vdom</h2><p><strong>å®šä¹‰</strong>ï¼švdom å°±æ˜¯æ ¹æ®çœŸå®domçš„å±æ€§ä½¿ç”¨jsé‡æ–°æŒ‰ç…§åŸæœ‰ç»“æ„æ¨¡æ‹Ÿå‡ºä¸€ä»½domå¯¹è±¡ï¼Œdom api å¯¹çœŸå® dom åšå¢åˆ æ”¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: <span class="string">'div'</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        id: <span class="string">'aaa'</span>,</span><br><span class="line">        className: [<span class="string">'bbb'</span>, <span class="string">'ccc'</span>],</span><br><span class="line">        onClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    children: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº† vdom çš„å¥½å¤„ï¼Œå°±æ²¡æœ‰å’Œ dom å¼ºç»‘å®šäº†ï¼Œå¯ä»¥è·¨å¹³å°æ¸²æŸ“ï¼Œæ¯”å¦‚ nativeã€canvas ç­‰ç­‰ã€‚</p><p>ä½†æ˜¯è¦è®©å¼€å‘å»å†™è¿™æ ·çš„ vdom ä¹ˆï¼Ÿ</p><p>é‚£è‚¯å®šä¸è¡Œï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œå¤§å®¶ç†Ÿæ‚‰çš„æ˜¯ html é‚£ç§æ–¹å¼ï¼Œæ‰€ä»¥è¦å¼•å…¥ä¸€äº›ç¼–è¯‘çš„æ‰‹æ®µã€‚</p><h2 id="dsl-çš„ç¼–è¯‘"><a href="#dsl-çš„ç¼–è¯‘" class="headerlink" title="dsl çš„ç¼–è¯‘"></a>dsl çš„ç¼–è¯‘</h2><p>dsl æ˜¯ domain specific languageï¼Œé¢†åŸŸç‰¹å®šè¯­è¨€çš„æ„æ€ï¼Œhtmlã€css éƒ½æ˜¯ web é¢†åŸŸçš„ dslã€‚</p><p>ç›´æ¥å†™ vdom å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å‰ç«¯æ¡†æ¶éƒ½ä¼šè®¾è®¡ä¸€å¥— dslï¼Œç„¶åç¼–è¯‘æˆ render functionï¼Œæ‰§è¡Œåäº§ç”Ÿ vdomã€‚</p><p>vue å’Œ react éƒ½æ˜¯è¿™æ ·ï¼š</p><blockquote><p>jsx -&gt; render function -&gt; vdom</p></blockquote><p>è¿™å¥— dsl æ€ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p><p>å‰ç«¯é¢†åŸŸå¤§å®¶ç†Ÿæ‚‰çš„æè¿° dom çš„æ–¹å¼æ˜¯ htmlï¼Œæœ€å¥½çš„æ–¹å¼è‡ªç„¶æ˜¯ä¹Ÿè®¾è®¡æˆé‚£æ ·ã€‚</p><p>æ‰€ä»¥ vue çš„ templateï¼Œreact çš„ jsx å°±éƒ½æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚</p><p>vue çš„ template compiler æ˜¯è‡ªå·±å®ç°çš„ï¼Œè€Œ react çš„ jsx çš„ç¼–è¯‘å™¨æ˜¯ babel å®ç°çš„ï¼Œæ˜¯ä¸¤ä¸ªå›¢é˜Ÿåˆä½œçš„ç»“æœã€‚</p><h2 id="æ¸²æŸ“-vdom"><a href="#æ¸²æŸ“-vdom" class="headerlink" title="æ¸²æŸ“ vdom"></a>æ¸²æŸ“ vdom</h2><p>æ¸²æŸ“ vdom ä¹Ÿå°±æ˜¯é€šè¿‡ dom api å¢åˆ æ”¹ domã€‚</p><p>æ¯”å¦‚ä¸€ä¸ª divï¼Œé‚£å°±è¦ document.createElement åˆ›å»ºå…ƒç´ ï¼Œç„¶å setAttribute è®¾ç½®å±æ€§ï¼ŒaddEventListener è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>å¦‚æœæ˜¯æ–‡æœ¬ï¼Œé‚£å°±è¦ document.createTextNode æ¥åˆ›å»ºã€‚</p><p>æ‰€ä»¥è¯´æ ¹æ® vdom ç±»å‹çš„ä¸åŒï¼Œå†™ä¸ª if elseï¼Œåˆ†åˆ«åšä¸åŒçš„å¤„ç†å°±è¡Œäº†ã€‚</p><p>æ²¡é”™ï¼Œä¸ç®¡ vue è¿˜æ˜¯ reactï¼Œæ¸²æŸ“å™¨é‡Œè¿™æ®µ if else æ˜¯å°‘ä¸äº†çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (vdom.tag) &#123;</span><br><span class="line">  <span class="keyword">case</span> HostComponent:</span><br><span class="line">    <span class="comment">// åˆ›å»ºæˆ–æ›´æ–° dom</span></span><br><span class="line">  <span class="keyword">case</span> HostText:</span><br><span class="line">    <span class="comment">// åˆ›å»ºæˆ–æ›´æ–° dom</span></span><br><span class="line">  <span class="keyword">case</span> FunctionComponent: </span><br><span class="line">    <span class="comment">// åˆ›å»ºæˆ–æ›´æ–° dom</span></span><br><span class="line">  <span class="keyword">case</span> ClassComponent: </span><br><span class="line">    <span class="comment">// åˆ›å»ºæˆ–æ›´æ–° dom</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>react é‡Œæ˜¯é€šè¿‡ tag æ¥åŒºåˆ† vdom ç±»å‹çš„ï¼Œæ¯”å¦‚ <code>HostComponent</code> å°±æ˜¯å…ƒç´ ï¼Œ<code>HostText</code> å°±æ˜¯æ–‡æœ¬ï¼Œ<code>FunctionComponent</code>ã€<code>ClassComponent</code> å°±åˆ†åˆ«æ˜¯å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ã€‚</p><h2 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h2><p>react <strong>æ²¡æœ‰å“åº”å¼ç³»ç»Ÿ</strong>ï¼Œæ˜¯é€šè¿‡ <code>setState</code> çš„ api è§¦å‘çŠ¶æ€æ›´æ–°çš„ï¼Œæ›´æ–°ä»¥åå°±<strong>é‡æ–°æ¸²æŸ“æ•´ä¸ª vdom</strong>ã€‚</p><blockquote><p>vue æ˜¯é€šè¿‡å¯¹çŠ¶æ€åšä»£ç†ï¼Œget çš„æ—¶å€™æ”¶é›†ä»¥æ¥ï¼Œç„¶åä¿®æ”¹çŠ¶æ€çš„æ—¶å€™å°±å¯ä»¥è§¦å‘å¯¹åº”ç»„ä»¶çš„ render äº†ï¼Œä¸ç®¡æ˜¯å­ç»„ä»¶ã€çˆ¶ç»„ä»¶ã€è¿˜æ˜¯å…¶ä»–ä½ç½®çš„ç»„ä»¶ï¼Œåªè¦ç”¨åˆ°äº†å¯¹åº”çš„çŠ¶æ€ï¼Œé‚£å°±ä¼šè¢«ä½œä¸ºä¾èµ–æ”¶é›†èµ·æ¥ï¼ŒçŠ¶æ€å˜åŒ–çš„æ—¶å€™å°±å¯ä»¥è§¦å‘å®ƒä»¬çš„ renderï¼Œä¸ç®¡æ˜¯ç»„ä»¶æ˜¯åœ¨å“ªé‡Œçš„ã€‚</p></blockquote><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ react éœ€è¦é‡æ–°æ¸²æŸ“æ•´ä¸ª vdomï¼Œè€Œ vue ä¸ç”¨ã€‚</p><p>react çš„ <code>setState</code> ä¼šæ¸²æŸ“æ•´ä¸ª vdomï¼Œè€Œä¸€ä¸ªåº”ç”¨çš„æ‰€æœ‰ vdom å¯èƒ½æ˜¯å¾ˆåºå¤§çš„ï¼Œè®¡ç®—é‡å°±å¯èƒ½å¾ˆå¤§ã€‚</p><p>æµè§ˆå™¨é‡Œ js è®¡ç®—æ—¶é—´å¤ªé•¿æ˜¯ä¼šé˜»å¡æ¸²æŸ“çš„ï¼Œä¼šå ç”¨æ¯ä¸€å¸§çš„åŠ¨ç”»ã€é‡ç»˜é‡æ’çš„æ—¶é—´ï¼Œè¿™æ ·åŠ¨ç”»å°±ä¼šå¡é¡¿ã€‚</p><p>ä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚çš„å‰ç«¯æ¡†æ¶ï¼ŒåŠ¨ç”»å¡é¡¿è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚ä½†æ˜¯å› ä¸º <code>setState</code> çš„æ–¹å¼åªèƒ½æ¸²æŸ“æ•´ä¸ª vdomï¼Œæ‰€ä»¥è®¡ç®—é‡å¤§æ˜¯ä¸å¯é¿å…çš„ã€‚</p><p>é‚£èƒ½ä¸èƒ½æŠŠè®¡ç®—é‡æ‹†åˆ†ä¸€ä¸‹ï¼Œæ¯ä¸€å¸§è®¡ç®—ä¸€éƒ¨åˆ†ï¼Œä¸è¦é˜»å¡åŠ¨ç”»çš„æ¸²æŸ“å‘¢ï¼Ÿ</p><p>é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œreact å°±æ”¹é€ ä¸ºäº† fiber æ¶æ„ã€‚</p><h2 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h2><h3 id="ä¸€ï¼šFiberçš„æ¦‚å¿µ"><a href="#ä¸€ï¼šFiberçš„æ¦‚å¿µ" class="headerlink" title="ä¸€ï¼šFiberçš„æ¦‚å¿µ"></a>ä¸€ï¼šFiberçš„æ¦‚å¿µ</h3><p>React Fiberæ˜¯reactæ‰§è¡Œæ¸²æŸ“æ—¶çš„ä¸€ç§æ–°çš„è°ƒåº¦ç­–ç•¥ï¼ŒJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€æ—¦ç»„ä»¶å¼€å§‹æ›´æ–°ï¼Œä¸»çº¿ç¨‹å°±ä¸€ç›´è¢«Reactæ§åˆ¶ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœå†æ¬¡æ‰§è¡Œäº¤äº’æ“ä½œï¼Œå°±ä¼šå¡é¡¿ã€‚</p><p>â€ƒâ€ƒReact Fiberå°±æ˜¯é€šè¿‡å¯¹è±¡è®°å½•ç»„ä»¶ä¸Šéœ€è¦åšæˆ–è€…å·²ç»å®Œæˆçš„æ›´æ–°ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥å¯¹åº”å¤šä¸ªFiberã€‚</p><p>â€ƒâ€ƒåœ¨renderå‡½æ•°ä¸­åˆ›å»ºçš„React Elementæ ‘åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ä¼šåˆ›å»ºä¸€é¢—ç»“æ„ä¸€æ¨¡ä¸€æ ·çš„çš„FiberèŠ‚ç‚¹æ ‘ã€‚ä¸åŒçš„React Elementç±»å‹å¯¹åº”ä¸åŒçš„FiberèŠ‚ç‚¹ç±»å‹ã€‚ä¸€ä¸ªReact Elementçš„å·¥ä½œå°±ç”±å®ƒå¯¹åº”çš„FiberèŠ‚ç‚¹æ¥è´Ÿè´£ã€‚</p><p>â€ƒâ€ƒä¸€ä¸ªReact Elementå¯ä»¥å¯¹åº”ä¸æ­¢ä¸€ä¸ªFiberï¼Œå› ä¸ºFiberåœ¨updateçš„æ—¶å€™ï¼Œä¼šä»åŸæ¥çš„Fiber(æˆ‘ä»¬ç§°ä¸ºcurrent)cloneå‡ºä¸€ä¸ªæ–°çš„Fiber(æˆ‘ä»¬ç§°ä¹‹ä¸ºalternate)ã€‚ä¿©ä¸ªFiber diffå‡ºçš„å˜åŒ–(side effect)è®°å½•åœ¨alternateä¸Šã€‚æ‰€ä»¥ä¸€ä¸ªç»„ä»¶åœ¨æ›´æ–°æ—¶æœ€å¤šä¼šæœ‰ä¿©ä¸ªFiberä¸å…¶å¯¹åº”ï¼Œåœ¨æ›´æ–°ç»“æŸåalternateä¼šå–ä»£ä¹‹å‰çš„currentç§°ä¸ºæ–°çš„currentèŠ‚ç‚¹ã€‚</p><p>â€ƒâ€ƒReact Fiberé‡æ„è¿™ç§æ–¹å¼ï¼Œæ¸²æŸ“è¿‡ç¨‹é‡‡ç”¨åˆ‡ç‰‡çš„æ–¹å¼ï¼Œæ¯æ‰§è¡Œä¸€ä¼šå„¿ï¼Œå°±æ­‡ä¸€ä¼šå„¿ã€‚å¦‚æœæœ‰ä¼˜å…ˆçº§æ›´é«˜çš„ä»»åŠ¡åˆ°æ¥ä»¥åå‘¢ï¼Œå°±ä¼šå…ˆå»æ‰§è¡Œï¼Œé™ä½é¡µé¢å‘ç”Ÿå¡é¡¿çš„å¯èƒ½æ€§ï¼Œä½¿å¾—Reactå¯¹åŠ¨ç”»ç­‰å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ä½“éªŒæ›´å¥½ã€‚</p><h3 id="äºŒï¼šä»€ä¹ˆæ˜¯Fiberï¼Ÿ"><a href="#äºŒï¼šä»€ä¹ˆæ˜¯Fiberï¼Ÿ" class="headerlink" title="äºŒï¼šä»€ä¹ˆæ˜¯Fiberï¼Ÿ"></a>äºŒï¼šä»€ä¹ˆæ˜¯Fiberï¼Ÿ</h3><p>â€ƒâ€ƒå½“jsåœ¨å¤„ç†å¤§å‹è®¡ç®—çš„æ—¶å€™ä¼šå¯¼è‡´é¡µé¢å‡ºç°å¡å¸§çš„ç°è±¡ï¼Œæ›´ä¸¥é‡çš„ä¼šå‡ºç°é¡µé¢â€œå‡æ­»â€ã€‚æ‰€ä»¥åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¿…ç„¶ä¼šå¯¼è‡´åŠ¨ç”»ä¸¢å¸§ã€ä¸è¿è´¯ï¼Œç”¨æˆ·ä½“éªŒå°±ç‰¹åˆ«å·®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤§å‹çš„è®¡ç®—æ‹†åˆ†æˆä¸€ä¸ªä¸ªå°å‹è®¡ç®—ï¼Œç„¶åæŒ‰ç…§æ‰§è¡Œé¡ºåºå¼‚æ­¥è°ƒç”¨ï¼Œè¿™æ ·å°±ä¸ä¼šé•¿æ—¶é—´éœ¸å çº¿ç¨‹ï¼ŒUIä¹Ÿèƒ½åœ¨ä¿©æ¬¡å°å‹è®¡ç®—çš„æ‰§è¡Œé—´éš™è¿›è¡Œæ›´æ–°ï¼Œä»è€Œç»™ä¸ç”¨æˆ·åŠæ—¶çš„åé¦ˆï¼ŒFiberå°±æ˜¯è¿™æ ·åšçš„ï¼Œå¹¶ä¸”ä»¥ä¸€ç§æ›´é«˜é€¼æ ¼çš„æ–¹å¼å®ç°äº†ã€‚<br><strong>Driving Idea</strong><br>â€ƒâ€ƒå¦‚æœè¯´v16.0ä¹‹å‰çš„Reactè§£å†³äº†HOW(å¦‚ä½•ç”¨æœ€å°‘çš„DOMæ“ä½œæˆæœ¬æ¥updateè§†å›¾)çš„é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡Fiberçš„å‡ºç°ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿˜è§£å†³äº†WHEN(ä½•æ—¶updateè§†å›¾çš„å“ªä¸€éƒ¨åˆ†)çš„é—®é¢˜ã€‚<br>â€ƒâ€ƒâ€ƒ<strong>åˆ†ç‰‡ä¼˜å…ˆçº§ï¼ï¼ï¼</strong></p><p>â€ƒâ€ƒåŸºäºä¸Šè¿°è¿™äº›åŸå› ï¼ŒFiberå®ç°äº†ä¸€ä¸ªè™šæ‹Ÿè°ƒç”¨æ ˆï¼Œå¹¶ç»™æ‰€æœ‰çš„updateè¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">export type PriorityLevel = 0 | 1 | 2 | 3 | 4 | 5;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line"> </span><br><span class="line">NoWork: 0, // No work is pending.</span><br><span class="line"> </span><br><span class="line">SynchronousPriority: 1, // ç”¨äºæ§åˆ¶æ–‡æœ¬è¾“å…¥ã€‚åŒæ­¥çš„å‰¯ä½œç”¨.</span><br><span class="line"></span><br><span class="line">AnimationPriority: 2, //éœ€è¦åœ¨ä¸‹ä¸€å¸§ä¹‹å‰å®Œæˆ.</span><br><span class="line"> </span><br><span class="line">HighPriority: 3, // éœ€è¦å¾ˆå¿«å®Œæˆçš„äº’åŠ¨æ‰èƒ½äº§ç”Ÿååº”.</span><br><span class="line"> </span><br><span class="line">LowPriority: 4, // æ•°æ®è·å–ï¼Œæˆ–æ›´æ–°å­˜å‚¨çš„ç»“æœ.</span><br><span class="line"> </span><br><span class="line">OffscreenPriority: 5, // å°†ä¸å¯è§ï¼Œä½†åšçš„å·¥ä½œï¼Œä»¥é˜²å®ƒæˆä¸ºå¯è§.</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒç„¶åæ ¹æ®è¿™äº›updateçš„ä¼˜å…ˆçº§ï¼Œæ¥å†³å®šæ‰§è¡Œçš„é¡ºåºã€‚<br>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŠ¨ç”»å’Œé¡µé¢äº¤äº’éƒ½æ˜¯ä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„ï¼Œè¿™ä¹Ÿæ˜¯Fiberèƒ½å¤Ÿä½¿å¾—åŠ¨ç”»ã€å¸ƒå±€å’Œé¡µé¢äº¤äº’å˜å¾—æ›´åŠ çš„æµç•…çš„åŸå› ä¹‹ä¸€ã€‚<br>â€ƒâ€ƒå¯ä»¥æŠŠPriorityåˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ä¸¤ä¸ªç±»åˆ«ï¼ŒåŒæ­¥ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šåœ¨å½“å‰å¸§å®Œæˆï¼ŒåŒ…æ‹¬SynchronousPriorityå’ŒTaskPriorityã€‚å¼‚æ­¥ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ™å¯èƒ½åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªå¸§ä¸­è¢«å®Œæˆï¼ŒåŒ…æ‹¬HighPriorityã€LowPriorityä»¥åŠOffscreenPriorityã€‚<br>â€ƒâ€ƒReact v16.3.2çš„ä¼˜å…ˆçº§ï¼Œä¸å†è¿™ä¹ˆåˆ’åˆ†ï¼Œåˆ†ä¸ºä¸‰ç±»ï¼šNoWorkã€syncã€asyncï¼Œå‰ä¸¤ç±»å¯ä»¥è®¤ä¸ºæ˜¯åŒæ­¥ä»»åŠ¡ï¼Œéœ€è¦åœ¨å½“å‰tickå®Œæˆï¼Œè¿‡æœŸæ—¶é—´ä¸ºnullï¼Œæœ€åä¸€ç±»å¼‚æ­¥ä»»åŠ¡ä¼šè®¡ç®—ä¸€ä¸ªã€‚<br>â€ƒâ€ƒexpirationTimeï¼Œåœ¨workLoopä¸­ï¼Œæ ¹æ®è¿‡æœŸæ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€ä¸ªåˆ†ç‰‡ä»»åŠ¡ï¼ŒscheduleWorkä¸­æ›´æ–°ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯æ›´æ–°è¿™ä¸ªexpirationTimeã€‚è‡³äºè¿™ä¸ªæ—¶é—´æ€ä¹ˆè®¡ç®—ï¼Œå¯ä»¥æŸ¥çœ‹æºç ã€‚</p><h3 id="ä¸‰ï¼šFiberçš„åŸºæœ¬åŸåˆ™ï¼š"><a href="#ä¸‰ï¼šFiberçš„åŸºæœ¬åŸåˆ™ï¼š" class="headerlink" title="ä¸‰ï¼šFiberçš„åŸºæœ¬åŸåˆ™ï¼š"></a>ä¸‰ï¼šFiberçš„åŸºæœ¬åŸåˆ™ï¼š</h3><p>â€ƒâ€ƒæ›´æ–°ä»»åŠ¡åˆ†æˆä¿©ä¸ªé˜¶æ®µï¼ŒReconcilition Phase(è°ƒå’Œé˜¶æ®µ)å’ŒCommit Phase(äº¤ä»˜é˜¶æ®µ)ã€‚Reconciliation Phaseçš„ä»»åŠ¡å¹²çš„äº‹æƒ…æ˜¯ï¼Œæ‰¾å‡ºè¦åšçš„æ›´æ–°å·¥ä½œ(Diff Fiber Tree),å°±æ˜¯ä¸€ä¸ªè®¡ç®—é˜¶æ®µï¼Œè®¡ç®—ç»“æœå¯ä»¥è¢«ç¼“å­˜ï¼Œä¹Ÿå°±å¯ä»¥è¢«æ‰“æ–­ï¼›Commit Phaseéœ€è¦æäº¤æ‰€æœ‰æ›´æ–°å¹¶æ¸²æŸ“ï¼Œä¸ºäº†é˜²æ­¢é¡µé¢æŠ–åŠ¨ï¼Œè¢«è®¾ç½®ä¸ºä¸èƒ½æ‰“æ–­ã€‚<br>â€ƒâ€ƒ<strong>PSï¼šcomponentWillMount</strong><br>â€ƒâ€ƒomponentWillReceiveProps componentWillUpdate å‡ ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œåœ¨Reconciliation Phaseè¢«è°ƒç”¨ï¼Œæœ‰è¢«æ‰“æ–­çš„å¯èƒ½ï¼ˆæ—¶é—´ç”¨å°½ç­‰æƒ…å†µï¼‰ï¼Œæ‰€ä»¥å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ã€‚å…¶å®shouldComponentUpdate ä¹Ÿå¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œåªæ˜¯å®ƒåªè¿”å›trueæˆ–è€…falseï¼Œæ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥ã€‚</p><h3 id="å››ï¼šFiberçš„æ•°æ®ç»“æ„"><a href="#å››ï¼šFiberçš„æ•°æ®ç»“æ„" class="headerlink" title="å››ï¼šFiberçš„æ•°æ®ç»“æ„"></a>å››ï¼šFiberçš„æ•°æ®ç»“æ„</h3><p>â€ƒâ€ƒfiberæ˜¯ä¸ªé“¾è¡¨ï¼Œæœ‰childå’Œsibingå±æ€§ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å’Œç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œä»è€Œæ„æˆfiber treeã€‚return å±æ€§æŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹ã€‚<br>â€ƒâ€ƒæ›´æ–°é˜Ÿåˆ—ï¼ŒupdateQueueï¼Œæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæœ‰firstå’Œlastä¿©ä¸ªå±æ€§ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªupdateå¯¹è±¡ã€‚<br>â€ƒâ€ƒæ¯ä¸ªfiberæœ‰ä¸€ä¸ªå±æ€§updateQueueæŒ‡å‘å…¶å¯¹åº”çš„æ›´æ–°é˜Ÿåˆ—ã€‚<br>â€ƒâ€ƒæ¯ä¸ªfiber(å½“å‰fiberå¯ä»¥ç§°ä¸ºcurrent)æœ‰ä¸€ä¸ªå±æ€§alternateï¼Œå¼€å§‹æ—¶æŒ‡å‘ä¸€ä¸ªè‡ªå·±çš„cloneä½“ï¼Œupdateçš„å˜åŒ–ä¼šå…ˆæ›´æ–°åˆ°alternateä¸Šï¼Œå½“æ›´æ–°å®Œæ¯•ï¼Œalternateæ›¿æ¢currentã€‚</p><h3 id="äº”ï¼šFiberçš„æ‰§è¡Œæµç¨‹"><a href="#äº”ï¼šFiberçš„æ‰§è¡Œæµç¨‹" class="headerlink" title="äº”ï¼šFiberçš„æ‰§è¡Œæµç¨‹"></a>äº”ï¼šFiberçš„æ‰§è¡Œæµç¨‹</h3><ol><li>ç”¨æˆ·æ“ä½œå¼•èµ·setStateè¢«è°ƒç”¨ä»¥åï¼Œå…ˆè°ƒç”¨enqueueSetStateæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥åˆ’åˆ†æˆä¿©ä¸ªé˜¶æ®µï¼ˆä¸ªäººç†è§£ï¼‰ï¼Œç¬¬ä¸€é˜¶æ®µData Preparationï¼Œæ˜¯åˆå§‹åŒ–ä¸€äº›æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚fiberï¼ŒupdateQueueï¼Œupdateã€‚</li><li>æ–°çš„updateä¼šé€šè¿‡insertUpdateIntoQueueæ–¹æ³•ï¼Œæ ¹æ®ä¼˜å…ˆçº§æ’å…¥åˆ°é˜Ÿåˆ—çš„å¯¹åº”ä½ç½®ï¼ŒensureUpdateQueuesæ–¹æ³•åˆå§‹åŒ–ä¿©ä¸ªæ›´æ–°é˜Ÿåˆ—ï¼Œqueue1å’Œcurrent.updateQueueå¯¹åº”ï¼Œqueue2å’Œcurrent.alternate.updateQueueå¯¹åº”ã€‚</li><li>ç¬¬äºŒé˜¶æ®µï¼ŒFiber Reconcilerï¼Œå°±å¼€å§‹è¿›è¡Œä»»åŠ¡åˆ†ç‰‡è°ƒåº¦ï¼ŒscheduleWorké¦–å…ˆæ›´æ–°æ¯ä¸ªfiberçš„ä¼˜å…ˆçº§ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰updatePriorityè¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å¹²äº†è¿™ä»¶äº‹ã€‚å½“fiber.return === nullï¼Œæ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼ŒæŠŠæ‰€æœ‰diffå‡ºçš„å˜åŒ–(side effect)å½’ç»“åˆ°rootä¸Šã€‚</li><li>requestWorkï¼Œé¦–å…ˆæŠŠå½“å‰çš„æ›´æ–°æ·»åŠ åˆ°schedule listä¸­(addRootToSchedule),ç„¶åæ ¹æ®å½“å‰æ˜¯å¦ä¸ºå¼‚æ­¥æ¸²æŸ“(isAsyncå‚æ•°)ï¼Œå¼‚æ­¥æ¸²æŸ“è°ƒç”¨ã€‚scheduleCallbackWithExpriationæ–¹æ³•ï¼Œä¸‹ä¸€æ­¥é«˜èƒ½ï¼ï¼</li><li>scheduleCallbackWithExpriationè¿™ä¸ªæ–¹æ³•åœ¨ä¸åŒç¯å¢ƒï¼Œå®ç°ä¸ä¸€æ ·ï¼Œchromeç­‰æµè§ˆå™¨ä¸­ä½¿ç”¨requestIdleCallback APIï¼Œæ²¡æœ‰è¿™ä¸ªAPIçš„æµè§ˆå™¨ä¸­ï¼Œé€šè¿‡requestAnimationFrameæ¨¡æ‹Ÿä¸€ä¸ªrequestIdCallbackï¼Œæ¥åœ¨æµè§ˆå™¨ç©ºé—²æ—¶ï¼Œå®Œæˆä¸‹ä¸€ä¸ªåˆ†ç‰‡çš„å·¥ä½œï¼Œæ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä¼ å…¥ä¸€ä¸ªexpirationTimeï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æ´»æ²¡å¹²å®Œï¼Œå°±æ”¾å¼ƒäº†ã€‚</li><li>æ‰§è¡Œåˆ°performWorkOnRootï¼Œå°±æ˜¯fiberæ–‡æ¡£ä¸­æåˆ°çš„Commit Phaseå’ŒReconciliation Phaseä¿©é˜¶æ®µã€‚</li><li>ç¬¬ä¸€é˜¶æ®µReconciliation Phase,åœ¨workLoopä¸­ï¼Œé€šè¿‡ä¸€ä¸ªwhileå¾ªç¯ï¼Œå®Œæˆæ¯ä¸ªåˆ†ç‰‡ä»»åŠ¡ã€‚</li><li>performUnitOfWorkä¹Ÿå¯ä»¥åˆ†æˆä¿©é˜¶æ®µï¼Œè“è‰²æ¡†è¡¨ç¤ºã€‚beginWorkæ˜¯ä¸€ä¸ªå…¥å£å‡½æ•°ï¼Œæ ¹æ®workInProgressçš„ç±»å‹å»å®ä¾‹åŒ–ä¸åŒçš„react element classã€‚workInProgressæ˜¯é€šè¿‡alternateæŒ‚è½½ä¸€äº›æ–°å±æ€§è·å¾—çš„ã€‚</li><li>å®ä¾‹åŒ–ä¸åŒçš„react element classæ—¶å€™ä¼šè°ƒç”¨å’Œwillæœ‰å…³çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</li><li>completeUnitOfWorkæ˜¯è¿›è¡Œä¸€äº›æ”¶å°¾å·¥ä½œï¼Œdiffå®Œä¸€ä¸ªèŠ‚ç‚¹ä»¥åï¼Œæ›´æ–°propså’Œè°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç­‰ã€‚</li><li>ç„¶åè¿›å…¥Commit Phaseé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µä¸èƒ½è¢«æ‰“æ–­ã€‚</li></ol><h3 id="å…­ï¼šFiberå¯¹å¼€å‘è€…æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"><a href="#å…­ï¼šFiberå¯¹å¼€å‘è€…æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ" class="headerlink" title="å…­ï¼šFiberå¯¹å¼€å‘è€…æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"></a>å…­ï¼šFiberå¯¹å¼€å‘è€…æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</h3><ol><li>componentWillMount,componentWillReceiveProps,componentWillUpdateå‡ ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸å†å®‰å…¨ï¼Œç”±äºä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹å¯ä»¥è¢«æ‰“æ–­ï¼Œè¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸå¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œå¦‚æœå®ƒä»¬åŒ…å«å‰¯ä½œç”¨(æ¯”å¦‚Ajax)ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„bugã€‚Reactå›¢é˜Ÿæä¾›äº†æ›¿æ¢çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚å»ºè®®å¦‚æœä½¿ç”¨ä»¥ä¸Šæ–¹æ³•ï¼Œå°½é‡ä½¿ç”¨çº¯å‡½æ•°ï¼Œé¿å…ä»¥åè¸©å‘ã€‚</li><li>éœ€è¦å…³æ³¨reactä¸ºä»»åŠ¡ç‰‡è®¾ç½®çš„ä¼˜å…ˆçº§ï¼Œç‰¹åˆ«æ˜¯é¡µé¢ç”¨åŠ¨ç”»çš„æƒ…å†µã€‚</li><li>å¦‚æœä¸€ç›´æœ‰æ›´é«˜çš„çº§åˆ«ä»»åŠ¡ï¼Œé‚£ä¹ˆfiberç®—æ³•ä¼šå…ˆæ‰§è¡Œçº§åˆ«æ›´é«˜çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åå†é€šè¿‡callbackå›åˆ°ä¹‹å‰æ¸²æŸ“åˆ°ä¸€åŠçš„ç»„ä»¶ï¼Œä»å¤´å¼€å§‹æ¸²æŸ“ã€‚ï¼ˆçœ‹èµ·æ¥æ”¾å¼ƒå·²ç»æ¸²æŸ“å®Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šæœ‰ç‚¹ä¸åˆç†ï¼Œåè€Œä¼šå¢åŠ æ¸²æŸ“æ—¶é•¿ï¼Œä½†æ˜¯reactç¡®å®æ˜¯è¿™ä¹ˆå¹²çš„ï¼‰</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vdom&quot;&gt;&lt;a href=&quot;#vdom&quot; class=&quot;headerlink&quot; title=&quot;vdom&quot;&gt;&lt;/a&gt;vdom&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼švdom å°±æ˜¯æ ¹æ®çœŸå®domçš„å±æ€§ä½¿ç”¨jsé‡æ–°æŒ‰ç…§åŸæœ‰ç»“æ„æ¨¡æ‹Ÿå‡ºä¸€ä»½domå¯¹è±¡ï¼Œdo
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
      <category term="React" scheme="https://summxu.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reduxæºç å…¨é¢è§£æ</title>
    <link href="https://summxu.github.io/2022/Redux%E6%BA%90%E7%A0%81%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90/"/>
    <id>https://summxu.github.io/2022/Reduxæºç å…¨é¢è§£æ/</id>
    <published>2022-02-26T01:36:37.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>Reduxä½¿ç”¨ä¸­çš„å‡ ä¸ªç‚¹ï¼š</p><ol><li>Reduxä¸‰å¤§è®¾è®¡åŸåˆ™</li><li>Create Store</li><li>Redux middleware</li><li>combineReducer</li><li>Providerä¸Connect</li><li>Reduxæµç¨‹æ¢³ç†</li><li>Reduxè®¾è®¡ç‰¹ç‚¹</li></ol><h4 id="1-å•ä¸€æ•°æ®æº"><a href="#1-å•ä¸€æ•°æ®æº" class="headerlink" title="1. å•ä¸€æ•°æ®æº"></a>1. å•ä¸€æ•°æ®æº</h4><p>åœ¨ä¼ ç»Ÿçš„ MVC æ¶æ„ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ— æ•°ä¸ª Modelï¼Œè€Œ Model ä¹‹é—´å¯ä»¥äº’ç›¸ç›‘å¬ã€è§¦å‘äº‹ä»¶ç”šè‡³å¾ªç¯æˆ–åµŒå¥—è§¦å‘äº‹ä»¶ï¼Œè¿™äº›åœ¨ Redux ä¸­éƒ½æ˜¯ä¸å…è®¸çš„ã€‚å› ä¸ºåœ¨ Redux çš„æ€æƒ³é‡Œï¼Œä¸€ä¸ªåº”ç”¨æ°¸è¿œåªæœ‰å”¯ä¸€çš„æ•°æ®æºã€‚å®é™…ä¸Šï¼Œä½¿ç”¨å•ä¸€æ•°æ®æºçš„å¥½å¤„åœ¨äºæ•´ä¸ªåº”ç”¨çŠ¶æ€éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè¿™æ ·éšæ—¶å¯ä»¥æå–å‡ºæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€è¿›è¡ŒæŒä¹…åŒ–ï¼ˆæ¯”å¦‚å®ç°ä¸€ä¸ªé’ˆå¯¹æ•´ä¸ªåº”ç”¨çš„å³æ—¶ä¿å­˜åŠŸèƒ½ï¼‰ã€‚æ­¤å¤–ï¼Œè¿™æ ·çš„è®¾è®¡ä¹Ÿä¸ºæœåŠ¡ç«¯æ¸²æŸ“æä¾›äº†å¯èƒ½ã€‚</p><h4 id="2-çŠ¶æ€æ˜¯åªè¯»çš„"><a href="#2-çŠ¶æ€æ˜¯åªè¯»çš„" class="headerlink" title="2. çŠ¶æ€æ˜¯åªè¯»çš„"></a>2. çŠ¶æ€æ˜¯åªè¯»çš„</h4><p>åœ¨ Redux ä¸­ï¼Œå¹¶ä¸ä¼šè‡ªå·±ç”¨ä»£ç æ¥å®šä¹‰ä¸€ä¸ª storeã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®šä¹‰ä¸€ä¸ª reducerï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æ ¹æ®å½“å‰è§¦å‘çš„ action å¯¹å½“å‰åº”ç”¨çš„çŠ¶æ€ï¼ˆstateï¼‰è¿›è¡Œè¿­ä»£ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç›´æ¥ä¿®æ”¹åº”ç”¨çš„çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä»½å…¨æ–°çš„çŠ¶æ€ã€‚</p><p>Redux æä¾›çš„ createStore æ–¹æ³•ä¼šæ ¹æ® reducer ç”Ÿæˆ storeã€‚æœ€åï¼Œå¯ä»¥åˆ©ç”¨ store. dispatchæ–¹æ³•æ¥è¾¾åˆ°ä¿®æ”¹çŠ¶æ€çš„ç›®çš„ã€‚</p><h4 id="3-çŠ¶æ€ä¿®æ”¹å‡ç”±çº¯å‡½æ•°å®Œæˆ"><a href="#3-çŠ¶æ€ä¿®æ”¹å‡ç”±çº¯å‡½æ•°å®Œæˆ" class="headerlink" title="3.çŠ¶æ€ä¿®æ”¹å‡ç”±çº¯å‡½æ•°å®Œæˆ"></a>3.çŠ¶æ€ä¿®æ”¹å‡ç”±çº¯å‡½æ•°å®Œæˆ</h4><p>åœ¨ Redux é‡Œï¼Œé€šè¿‡å®šä¹‰ reducer æ¥ç¡®å®šçŠ¶æ€çš„ä¿®æ”¹ï¼Œè€Œæ¯ä¸€ä¸ª reducer éƒ½æ˜¯çº¯å‡½æ•°ï¼Œè¿™æ„å‘³ç€å®ƒæ²¡æœ‰å‰¯ä½œç”¨ï¼Œå³æ¥å—ä¸€å®šçš„è¾“å…¥ï¼Œå¿…å®šä¼šå¾—åˆ°ä¸€å®šçš„è¾“å‡ºã€‚</p><p>è¿™æ ·è®¾è®¡çš„å¥½å¤„ä¸ä»…åœ¨äº reducer é‡Œå¯¹çŠ¶æ€çš„ä¿®æ”¹å˜å¾—ç®€å•ã€çº¯ç²¹ã€å¯æµ‹è¯•ï¼Œæ›´æœ‰æ„æ€çš„æ˜¯ï¼ŒRedux åˆ©ç”¨æ¯æ¬¡æ–°è¿”å›çš„çŠ¶æ€ç”Ÿæˆé…·ç‚«çš„æ—¶é—´æ—…è¡Œï¼ˆtime travelï¼‰è°ƒè¯•æ–¹å¼ï¼Œè®©è·Ÿè¸ªæ¯ä¸€æ¬¡å› ä¸ºè§¦å‘ action è€Œæ”¹å˜çŠ¶æ€çš„ç»“æœæˆä¸ºäº†å¯èƒ½ã€‚</p><h2 id="2-Create-Store"><a href="#2-Create-Store" class="headerlink" title="2.Create Store"></a>2.Create Store</h2><p>ä»storeçš„è¯ç”Ÿå¼€å§‹è¯´èµ·ã€‚create storeå‡½æ•°APIæ–‡æ¡£å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createStore(reducer, [initialState], enhancer)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šreducerã€initialState å’Œ enhancer ã€‚Store enhancer æ˜¯ä¸€ä¸ªç»„åˆ store creator çš„é«˜é˜¶å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¼ºåŒ–è¿‡çš„ store creatorã€‚è¿™ä¸ middleware ç›¸ä¼¼ï¼Œå®ƒä¹Ÿå…è®¸ä½ é€šè¿‡å¤åˆå‡½æ•°æ”¹å˜ store æ¥å£ã€‚</p><p>å†æ¥çœ‹çœ‹ä»–çš„è¿”å›å€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    dispatch: f (action),</span><br><span class="line">    getState: f (),</span><br><span class="line">    replaceReducer: f (nextReducer),</span><br><span class="line">    subscribe: f (listener),</span><br><span class="line">    <span class="built_in">Symbol</span>(observable): f ()    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>storeçš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œé‡Œé¢æœ‰å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼š</p><ul><li>dispatchï¼šå°±æ˜¯æœ€å¸¸ç”¨çš„dispatchæ–¹æ³•ï¼Œæ´¾å‘actionã€‚</li><li>getStateï¼šé€šè¿‡è¯¥æ–¹æ³•ï¼Œå¯ä»¥æ‹¿åˆ°å½“å‰çŠ¶æ€æ ‘stateã€‚</li><li>replaceReducerï¼šè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äº reducer çš„çƒ­æ›¿æ¢ï¼Œä¸‹é¢ä»‹ç»è¯¥æ–¹æ³•ã€‚</li><li>subscribeï¼šæ·»åŠ ä¸€ä¸ªå˜åŒ–ç›‘å¬å™¨ã€‚æ¯å½“ dispatchï¼ˆactionï¼‰çš„æ—¶å€™å°±ä¼šæ‰§è¡Œï¼Œstate æ ‘ä¸­çš„ä¸€éƒ¨åˆ†å¯èƒ½å·²ç»å˜åŒ–ã€‚</li><li>observableï¼šè§‚å¯Ÿè€…æ¨¡å¼ï¼Œç”¨äºå¤„ç†è®¢é˜…å…³ç³»ã€‚</li></ul><p>è¿™é‡ŒæŒ‘å‡ ä¸ªæ–¹æ³•ä»‹ç»ï¼š</p><h3 id="getState"><a href="#getState" class="headerlink" title="getState"></a>getState</h3><p>åœ¨å®ŒæˆåŸºæœ¬çš„å‚æ•°æ ¡éªŒä¹‹åï¼Œåœ¨ createStore ä¸­å£°æ˜å¦‚ä¸‹å˜é‡åŠ getState æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentReducer = reducer</span><br><span class="line"><span class="keyword">var</span> currentState = initialState</span><br><span class="line"><span class="keyword">var</span> listeners = [] <span class="comment">// å½“å‰ç›‘å¬ store å˜åŒ–çš„ç›‘å¬å™¨</span></span><br><span class="line"><span class="keyword">var</span> isDispatching = <span class="literal">false</span> <span class="comment">// æŸä¸ª action æ˜¯å¦å¤„äºåˆ†å‘çš„å¤„ç†è¿‡ç¨‹ä¸­</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Reads the state tree managed by the store.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">* @returns &#123;any&#125; The current state tree of your application.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> currentState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getStateæ–¹æ³•å°±æ˜¯ç®€å•è¿”å›å½“å‰stateï¼Œå¦‚æœstateæ²¡æœ‰è¢«reducerå¤„ç†è¿‡ï¼Œä»–å°±æ˜¯initialStateã€‚</p><h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><p>åœ¨ getState ä¹‹åï¼Œå®šä¹‰äº† store çš„å¦ä¸€ä¸ªæ–¹æ³• subscribeï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line"> listeners.push(listener)</span><br><span class="line"> <span class="keyword">var</span> isSubscribed = <span class="literal">true</span></span><br><span class="line"> <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (!isSubscribed) &#123;</span><br><span class="line"> <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> isSubscribed = <span class="literal">false</span></span><br><span class="line"> <span class="keyword">var</span> index = listeners.indexOf(listener)</span><br><span class="line"> listeners.splice(index, <span class="number">1</span>)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Store å…è®¸ä½¿ç”¨<code>store.subscribe</code>æ–¹æ³•è®¾ç½®ç›‘å¬å‡½æ•°ï¼Œä¸€æ—¦ State å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><p>æ˜¾ç„¶ï¼Œåªè¦æŠŠ View çš„æ›´æ–°å‡½æ•°ï¼ˆå¯¹äº React é¡¹ç›®ï¼Œå°±æ˜¯ç»„ä»¶çš„<code>render</code>æ–¹æ³•æˆ–<code>setState</code>æ–¹æ³•ï¼‰æ”¾å…¥<code>listen</code>ï¼Œå°±ä¼šå®ç° View çš„è‡ªåŠ¨æ¸²æŸ“ã€‚ä½ å¯èƒ½ä¼šæ„Ÿåˆ°å¥‡æ€ªï¼Œå¥½åƒåœ¨ Redux åº”ç”¨ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ store.subscribe æ–¹æ³•ï¼Ÿäº‹å®ä¸Šï¼Œ</p><p>React Redux ä¸­çš„ connect æ–¹æ³•éšå¼åœ°å¸®å®Œæˆäº†è¿™ä¸ªå·¥ä½œã€‚</p><p><code>store.subscribe</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è§£é™¤ç›‘å¬ã€‚</p><h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p>dispatchæ˜¯reduxçš„æ ¸å¿ƒæ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">            <span class="string">'Actions must be plain objects. '</span> +</span><br><span class="line">            <span class="string">'Use custom middleware for async actions.'</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">            <span class="string">'Actions may not have an undefined "type" property. '</span> +</span><br><span class="line">            <span class="string">'Have you misspelled a constant?'</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        isDispatching = <span class="literal">true</span></span><br><span class="line">        currentState = currentReducer(currentState, action)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        isDispatching = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    listeners.slice().forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener())</span><br><span class="line">    <span class="keyword">return</span> action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºæŸä¸ª action çš„åˆ†å‘è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªæ£€æŸ¥ä¸»è¦æ˜¯ä¸ºäº†é¿å…åœ¨ reducer ä¸­åˆ†å‘ action çš„æƒ…å†µï¼Œå› ä¸ºè¿™æ ·åšå¯èƒ½å¯¼è‡´åˆ†å‘æ­»å¾ªç¯ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†æ•°æ®æµåŠ¨çš„å¤æ‚åº¦ã€‚</p><p>ç¡®è®¤å½“å‰ä¸å±äºåˆ†å‘è¿‡ç¨‹ä¸­åï¼Œå…ˆè®¾å®šæ ‡å¿—ä½ï¼Œç„¶åå°†å½“å‰çš„çŠ¶æ€å’Œ action ä¼ ç»™å½“å‰çš„reducerï¼Œç”¨äºç”Ÿæˆæœ€æ–°çš„ stateã€‚è¿™çœ‹èµ·æ¥ä¸€ç‚¹éƒ½ä¸å¤æ‚ï¼Œè¿™ä¹Ÿæ˜¯åå¤å¼ºè°ƒçš„ reducer å·¥ä½œè¿‡ç¨‹â€”â€”çº¯å‡½æ•°ã€æ¥å—çŠ¶æ€å’Œ action ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚</p><p>åœ¨å¾—åˆ°æ–°çš„çŠ¶æ€åï¼Œä¾æ¬¡è°ƒç”¨æ‰€æœ‰çš„ç›‘å¬å™¨ï¼Œé€šçŸ¥çŠ¶æ€çš„å˜æ›´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é€šçŸ¥ç›‘å¬å™¨å˜æ›´å‘ç”Ÿæ—¶ï¼Œå¹¶æ²¡æœ‰å°†æœ€æ–°çš„çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™äº›ç›‘å¬å™¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç›‘å¬å™¨ä¸­ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ store.getState() æ–¹æ³•æ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚</p><p>æœ€ç»ˆï¼Œå¤„ç†ä¹‹åçš„ action ä¼šè¢« dispatch æ–¹æ³•è¿”å›ã€‚</p><h3 id="replaceReducer"><a href="#replaceReducer" class="headerlink" title="replaceReducer"></a>replaceReducer</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    currentReducer = nextReducer;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ºäº†æ‹¿åˆ°æ‰€æœ‰ reducer ä¸­çš„åˆå§‹çŠ¶æ€ï¼ˆä½ æ˜¯å¦è¿˜è®°å¾—åœ¨å®šä¹‰ reducer æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºpreviousStateï¼Œå¦‚æœè¯¥å‚æ•°ä¸ºç©ºï¼Œæä¾›é»˜è®¤çš„ initialStateï¼‰ã€‚åªæœ‰æ‰€æœ‰çš„åˆå§‹çŠ¶æ€éƒ½æˆåŠŸè·å–åï¼ŒRedux åº”ç”¨æ‰èƒ½æœ‰æ¡ä¸ç´Šåœ°å¼€å§‹è¿ä½œã€‚</p><h2 id="3-Redux-middleware"><a href="#3-Redux-middleware" class="headerlink" title="3.Redux middleware"></a>3.Redux middleware</h2><blockquote><p>It provides a third-party extension point between dispatching an action, and the moment it reachesthe reducer</p></blockquote><p>å®ƒæä¾›äº†ä¸€ä¸ªåˆ†ç±»å¤„ç† action çš„æœºä¼šã€‚åœ¨middleware ä¸­ï¼Œä½ å¯ä»¥æ£€é˜…æ¯ä¸€ä¸ªæµè¿‡çš„ actionï¼ŒæŒ‘é€‰å‡ºç‰¹å®šç±»å‹çš„action è¿›è¡Œç›¸åº”æ“ä½œï¼Œç»™ä½ ä¸€æ¬¡æ”¹å˜ action çš„æœºä¼šã€‚</p><p>å¸¸è§„çš„åŒæ­¥æ•°æ®æµæ¨¡å¼çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://sslstatic.ktanx.com/images/release/201811/Tr2gHBdB9tYoeS97.png" alt="f2BVgyd4bOqmbmPx.png](https://sslstatic.ktanx.com/images/release/201811/f2BVgyd4bOqmbmPx.png)ä¸åŒä¸šåŠ¡éœ€æ±‚ä¸‹ï¼Œæ¯”å¦‚æ‰§è¡Œactionä¹‹å‰å’Œä¹‹åéƒ½è¦æ‰“logï¼›actionè§¦å‘ä¸€ä¸ªå¼‚æ­¥çš„è¯·æ±‚ï¼Œè¯·æ±‚å›æ¥ä¹‹åæ¸²æŸ“viewç­‰ã€‚éœ€è¦ä¸ºè¿™ä¸€ç±»çš„actionæ·»åŠ å…¬å…±çš„æ–¹æ³•æˆ–è€…å¤„ç†ï¼Œä½¿ç”¨redux middlewareæµç¨‹å›¾å¦‚ä¸‹ï¼š![Tr2gHBdB9tYoeS97.png" title>                </div>                <div class="image-caption">f2BVgyd4bOqmbmPx.png](https://sslstatic.ktanx.com/images/release/201811/f2BVgyd4bOqmbmPx.png)ä¸åŒä¸šåŠ¡éœ€æ±‚ä¸‹ï¼Œæ¯”å¦‚æ‰§è¡Œactionä¹‹å‰å’Œä¹‹åéƒ½è¦æ‰“logï¼›actionè§¦å‘ä¸€ä¸ªå¼‚æ­¥çš„è¯·æ±‚ï¼Œè¯·æ±‚å›æ¥ä¹‹åæ¸²æŸ“viewç­‰ã€‚éœ€è¦ä¸ºè¿™ä¸€ç±»çš„actionæ·»åŠ å…¬å…±çš„æ–¹æ³•æˆ–è€…å¤„ç†ï¼Œä½¿ç”¨redux middlewareæµç¨‹å›¾å¦‚ä¸‹ï¼š![Tr2gHBdB9tYoeS97.png</div>            </figure>æ¯ä¸€ä¸ª middleware å¤„ç†ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ä¸šåŠ¡éœ€æ±‚ï¼Œé€šè¿‡ä¸²è”ä¸åŒçš„ middleware å®ç°å˜åŒ–å¤šæ ·çš„åŠŸèƒ½ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¸šåŠ¡ï¼ŒæŠŠå¤„ç†logçš„ä»£ç å°è£…æˆä¸€ä¸ªmiddlewareï¼Œå¤„ç†å¼‚æ­¥çš„ä¹Ÿæ˜¯ä¸€ä¸ªmiddlewareï¼Œä¸¤è€…ä¸²è”ï¼Œå´åˆç›¸äº’ç‹¬ç«‹ã€‚</p><p>ä½¿ç”¨middlewareä¹‹åï¼Œactionè§¦å‘çš„dispatchå¹¶ä¸æ˜¯åŸæ¥çš„dispatchï¼Œè€Œæ˜¯ç»è¿‡å°è£…çš„new dispatchï¼Œåœ¨è¿™ä¸ªnew dispatchä¸­ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œæ¯ä¸ªmiddlewareï¼Œæœ€åè°ƒç”¨åŸç”Ÿçš„dispatchã€‚</p><p>æ¥çœ‹ä¸‹logger middlewareå¦‚ä½•å®ç°çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'dispatch:'</span>, action); </span><br><span class="line">    next(action);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finish:'</span>, action);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»£ç ååˆ†ç®€æ´ï¼Œå°±æ˜¯åœ¨nextè°ƒç”¨ä¸‹ä¸€ä¸ªmiddlewareä¹‹å‰å’Œä¹‹åï¼Œåˆ†åˆ«æ‰“å°ä¸¤æ¬¡ã€‚</p><p>Redux æä¾›äº† applyMiddleware æ–¹æ³•æ¥åŠ è½½ middlewareï¼Œè¯¥æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">'./compose'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">reducer, initialState</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> store = next(reducer, initialState);</span><br><span class="line">            <span class="keyword">let</span> dispatch = store.dispatch;</span><br><span class="line">            <span class="keyword">let</span> chain = [];</span><br><span class="line">            <span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">                getState: store.getState,</span><br><span class="line">                dispatch: <span class="function">(<span class="params">action</span>) =&gt;</span> dispatch(action),</span><br><span class="line">            &#125;;</span><br><span class="line">            chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI));</span><br><span class="line">            dispatch = compose(...chain)(store.dispatch);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...store,</span><br><span class="line">                dispatch,</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­composeæºç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> funcs.reduceRight(<span class="function">(<span class="params">composed, f</span>) =&gt;</span> f(composed), arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newStore = applyMiddleware([mid1, mid2, mid3, ...])(createStore)(reducer, initialState);</span><br></pre></td></tr></table></figure><p>okï¼Œç›¸å…³æºç å·²å°±ä½ï¼Œæ¥è¯¦ç»†è§£æä¸€æ³¢ã€‚</p><p><strong>å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³è®¾è®¡</strong> ï¼šmiddleware çš„è®¾è®¡æœ‰ç‚¹ç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªå±‚å±‚åŒ…è£¹çš„åŒ¿åå‡½æ•°ï¼Œè¿™å…¶å®æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„curryingï¼Œå®ƒæ˜¯ä¸€ç§ä½¿ç”¨åŒ¿åå•å‚æ•°å‡½æ•°æ¥å®ç°å¤šå‚æ•°å‡½æ•°çš„æ–¹æ³•ã€‚applyMiddleware ä¼šå¯¹ logger è¿™ä¸ªmiddleware è¿›è¡Œå±‚å±‚è°ƒç”¨ï¼ŒåŠ¨æ€åœ°å°† store å’Œ next å‚æ•°èµ‹å€¼ã€‚currying çš„ middleware ç»“æ„çš„å¥½å¤„ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ã€‚</p><ul><li>æ˜“ä¸²è”ï¼šcurrying å‡½æ•°å…·æœ‰å»¶è¿Ÿæ‰§è¡Œçš„ç‰¹æ€§ï¼Œé€šè¿‡ä¸æ–­ currying å½¢æˆçš„ middleware å¯ä»¥ç´¯ç§¯å‚æ•°ï¼Œå†é…åˆç»„åˆï¼ˆcomposeï¼‰çš„æ–¹å¼ï¼Œå¾ˆå®¹æ˜“å½¢æˆ pipeline æ¥å¤„ç†æ•°æ®æµã€‚</li><li>ï± å…±äº« store: åœ¨ applyMiddleware æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œstore è¿˜æ˜¯æ—§çš„ï¼Œä½†æ˜¯å› ä¸ºé—­åŒ…çš„å­˜åœ¨ï¼ŒapplyMiddleware å®Œæˆåï¼Œæ‰€æœ‰çš„ middleware å†…éƒ¨æ‹¿åˆ°çš„ store æ˜¯æœ€æ–°ä¸”ç›¸åŒçš„ã€‚</li></ul><p><strong>ç»™ middleware åˆ†å‘ store</strong>ï¼šnewStoreåˆ›å»ºå®Œæˆä¹‹åï¼ŒapplyMiddleware æ–¹æ³•é™†ç»­è·å¾—äº†3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ middlewares æ•°ç»„[mid1, mid2, mid3, â€¦]ï¼Œç¬¬äºŒä¸ªæ˜¯ Redux åŸç”Ÿçš„ createStore ï¼Œæœ€åä¸€ä¸ªæ˜¯ reducerã€‚ç„¶åï¼Œå¯ä»¥çœ‹åˆ° applyMiddleware åˆ©ç”¨ createStore å’Œ reducer åˆ›å»ºäº†ä¸€ä¸ª storeã€‚è€Œ store çš„ getStateæ–¹æ³•å’Œ dispatch æ–¹æ³•åˆåˆ†åˆ«è¢«ç›´æ¥å’Œé—´æ¥åœ°èµ‹å€¼ç»™ middlewareAPI å˜é‡ storeï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line"> getState: store.getState,</span><br><span class="line"> dispatch: <span class="function">(<span class="params">action</span>) =&gt;</span> dispatch(action),</span><br><span class="line">&#125;;</span><br><span class="line">chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI));</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè®©æ¯ä¸ª middleware å¸¦ç€ middlewareAPI è¿™ä¸ªå‚æ•°åˆ†åˆ«æ‰§è¡Œä¸€éã€‚æ‰§è¡Œå®Œåï¼Œè·å¾— chainæ•°ç»„ [f1, f2, â€¦ , fx, â€¦, fn]ï¼Œå®ƒä¿å­˜çš„å¯¹è±¡æ˜¯ç¬¬äºŒä¸ªç®­å¤´å‡½æ•°è¿”å›çš„åŒ¿åå‡½æ•°ã€‚å› ä¸ºæ˜¯é—­åŒ…ï¼Œæ¯ä¸ªåŒ¿åå‡½æ•°éƒ½å¯ä»¥è®¿é—®ç›¸åŒçš„ storeï¼Œå³ middlewareAPIã€‚</p><blockquote><p>middlewareAPI ä¸­çš„ dispatch ä¸ºä»€ä¹ˆè¦ç”¨åŒ¿åå‡½æ•°åŒ…è£¹å‘¢ï¼Ÿ</p><p>ç”¨ applyMiddleware æ˜¯ä¸ºäº†æ”¹é€  dispatchï¼Œæ‰€ä»¥ applyMiddleware æ‰§è¡Œå®Œåï¼Œdispatch æ˜¯å˜åŒ–äº†çš„ï¼Œè€Œ middlewareAPI æ˜¯ applyMiddleware æ‰§è¡Œä¸­åˆ†å‘åˆ°å„ä¸ª middleware çš„ï¼Œæ‰€ä»¥å¿…é¡»ç”¨åŒ¿åå‡½æ•°åŒ…è£¹ dispatchï¼Œè¿™æ ·åªè¦ dispatch æ›´æ–°äº†ï¼ŒmiddlewareAPI ä¸­çš„ dispatch åº”ç”¨ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p></blockquote><p><strong>ç»„åˆä¸²è” middleware</strong>ï¼šè¿™ä¸€å±‚åªæœ‰ä¸€è¡Œä»£ç ï¼Œå´æ˜¯ applyMiddleware ç²¾åä¹‹æ‰€åœ¨<code>dispatch = compose(...chain)(store.dispatch);</code>ï¼Œå…¶ä¸­ compose æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ç»„åˆï¼Œå®ƒå°† chain ä¸­çš„æ‰€æœ‰åŒ¿åå‡½æ•° [f1, f2, â€¦ , fx, â€¦, fn]ç»„è£…æˆä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå³æ–°çš„ dispatchã€‚å½“æ–° dispatch æ‰§è¡Œæ—¶ï¼Œ[f1, f2, â€¦ , fx, â€¦, fn]ï¼Œä»å³åˆ°å·¦ä¾æ¬¡æ‰§è¡Œã€‚</p><p>compose(â€¦funcs) è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå…¶ä¸­ funcs å°±æ˜¯ chain æ•°ç»„ã€‚å½“è°ƒç”¨ reduceRightæ—¶ï¼Œä¾æ¬¡ä» funcs æ•°ç»„çš„å³ç«¯å–ä¸€ä¸ªå‡½æ•° fx æ‹¿æ¥æ‰§è¡Œï¼Œfx çš„å‚æ•° composed å°±æ˜¯å‰ä¸€æ¬¡ fx+1 æ‰§è¡Œçš„ç»“æœï¼Œè€Œç¬¬ä¸€æ¬¡æ‰§è¡Œçš„ fnï¼ˆn ä»£è¡¨ chain çš„é•¿åº¦ï¼‰çš„å‚æ•° arg å°±æ˜¯ store.dispatchã€‚æ‰€ä»¥ï¼Œå½“ compose æ‰§è¡Œå®Œåï¼Œå¾—åˆ°çš„ dispatch æ˜¯è¿™æ ·çš„ï¼Œå‡è®¾ n = 3ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch = f1(f2(f3(store.dispatch))));</span><br></pre></td></tr></table></figure><p>è¿™æ—¶è°ƒç”¨æ–° dispatchï¼Œæ¯ä¸€ä¸ª middleware å°±ä¾æ¬¡æ‰§è¡Œäº†ã€‚</p><p><strong>åœ¨ middleware ä¸­è°ƒç”¨ dispatch ä¼šå‘ç”Ÿä»€ä¹ˆ</strong>ï¼šç»è¿‡ compose åï¼Œæ‰€æœ‰çš„ middleware ç®—æ˜¯ä¸²è”èµ·æ¥äº†ã€‚å¯æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨åˆ†å‘ store æ—¶ï¼Œæåˆ°è¿‡æ¯ä¸ª middleware éƒ½å¯ä»¥è®¿é—® storeï¼Œå³ middlewareAPI è¿™ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥æ‹¿åˆ° store çš„dispatch å±æ€§ã€‚é‚£ä¹ˆï¼Œåœ¨ middleware ä¸­è°ƒç”¨ store.dispatch() ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå’Œè°ƒç”¨ next() æœ‰åŒºåˆ«å—ï¼Ÿç°åœ¨æ¥è¯´æ˜ä¸¤è€…çš„ä¸åŒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'dispatch:'</span>, action);</span><br><span class="line"> next(action);</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'finish:'</span>, action);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'dispatch:'</span>, action);</span><br><span class="line"> store.dispatch(action);</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'finish:'</span>, action);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨åˆ†å‘ store æ—¶è§£é‡Šè¿‡ï¼Œmiddleware ä¸­ store çš„ dispatch é€šè¿‡åŒ¿åå‡½æ•°çš„æ–¹å¼å’Œæœ€ç»ˆcompose ç»“æŸåçš„æ–° dispatch ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥ï¼Œåœ¨ middleware ä¸­è°ƒç”¨ store.dispatch() å’Œåœ¨å…¶ä»–ä»»ä½•åœ°æ–¹è°ƒç”¨çš„æ•ˆæœä¸€æ ·ã€‚è€Œåœ¨ middleware ä¸­è°ƒç”¨ next()ï¼Œæ•ˆæœæ˜¯è¿›å…¥ä¸‹ä¸€ä¸ª middlewareï¼Œä¸‹å›¾å°±æ˜¯redux middlewareæœ€è‘—åçš„æ´‹è‘±æ¨¡å‹å›¾ã€‚<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://sslstatic.ktanx.com/images/release/201811/IArjf9kjKecPhnFF.png" alt="IArjf9kjKecPhnFF.png" title>                </div>                <div class="image-caption">IArjf9kjKecPhnFF.png</div>            </figure></p><h2 id="4-combineReducer"><a href="#4-combineReducer" class="headerlink" title="4.combineReducer"></a>4.combineReducer</h2><p>å¦‚æœä¸€ä¸ªé¡¹ç›®è¿‡å¤§ï¼Œé€šå¸¸æŒ‰æ¨¡å—æ¥å†™reducerï¼Œä½†æ˜¯redux create storeåªæ¥å—ä¸€ä¸ªreducerå‚æ•°ï¼Œæ‰€ä»¥éœ€è¦åˆå¹¶reducerã€‚è¿™é‡Œå°±ç”¨åˆ°äº†reduxæä¾›çš„<code>combineReducer</code>è¾…åŠ©å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">combineReducers(&#123;</span><br><span class="line">      layout,</span><br><span class="line">      home,</span><br><span class="line">      ...asyncReducers</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œkeyæ˜¯æ¨¡å—reducerå¯¹åº”çš„åå­—ï¼Œ å€¼æ˜¯å¯¹åº”reducerã€‚å€¼æ˜¯ä¸€ä¸ªfunctionï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªæ–°çš„reducerï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line">  <span class="keyword">var</span> finalReducers = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = reducerKeys[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        warning(<span class="string">`No reducer provided for key "<span class="subst">$&#123;key&#125;</span>"`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'function'</span>) &#123;</span><br><span class="line">      finalReducers[key] = reducers[key]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> finalReducerKeys = <span class="built_in">Object</span>.keys(finalReducers)</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> unexpectedKeyCache = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> sanityError</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    assertReducerSanity(finalReducers)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    sanityError = e</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sanityError) &#123;</span><br><span class="line">      <span class="keyword">throw</span> sanityError</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache)</span><br><span class="line">      <span class="keyword">if</span> (warningMessage) &#123;</span><br><span class="line">        warning(warningMessage)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> hasChanged = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> nextState = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> key = finalReducerKeys[i]</span><br><span class="line">      <span class="keyword">var</span> reducer = finalReducers[key]</span><br><span class="line">      <span class="keyword">var</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="keyword">var</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> nextStateForKey === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(errorMessage)</span><br><span class="line">      &#125;</span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hasChanged ? nextState : state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç ä¸æ˜¯å¾ˆå¤šï¼Œé™¤å»ä¸€äº›éªŒè¯ä»£ç ï¼Œå‰©ä¸‹çš„å°±æ˜¯è¯´ï¼šreturnä¸€ä¸ªfunctionï¼Œæš‚æ—¶ç§°å‘¼ä»–combinationï¼Œå°±ç›¸å½“äºæ˜¯ä¸ä¸€ä¸ªæ€»çš„reducerï¼Œæ¯æ¬¡actionéƒ½ä¼šèµ°åˆ°combinationä¸­ï¼Œcombinationä¼šéå†è¾“å…¥çš„reducerï¼Œå°†actionæ”¾åˆ°æ¯ä¸ªreducerä¸­æ‰§è¡Œä¸€ä¸‹ï¼Œè®¡ç®—å‡ºè¿”å›ç»“æœå°±æ˜¯nextStateï¼ŒnextStateäºpreviousStateå¦‚æœ!==è¯´æ˜æ”¹å˜äº†ï¼Œè¿”å›nextStateï¼Œå¦åˆ™è¿”å›æ‰§è¡Œä¹‹å‰çš„stateã€‚</p><p>è¿™ä¹Ÿè§£é‡Šäº†ä¸åŒæ¨¡å—actionTypeå¦‚æœç›¸åŒçš„è¯ï¼Œä¸¤ä¸ªæ¨¡å—çš„reduceréƒ½ä¼šèµ°ä¸€éçš„é—®é¢˜ï¼Œåœ¨actionTypeåç§°å‰é¢åŠ ä¸Šæ¨¡å—å‰ç¼€å³å¯è§£å†³é—®é¢˜ã€‚</p><h2 id="5-Providerä¸Connect"><a href="#5-Providerä¸Connect" class="headerlink" title="5. Providerä¸Connect"></a>5. Providerä¸Connect</h2><p>Providerä¸Connetç»„ä»¶éƒ½æ˜¯React-Reduxæä¾›çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸¤è€…çœ‹èµ·æ¥åŠŸèƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯å¸®åŠ©å®¹å™¨ç»„ä»¶è·å–storeä¸­çš„æ•°æ®ï¼Œä½†æ˜¯åŸç†ä¸åŠŸèƒ½å´ä¸åŒã€‚</p><h3 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h3><p>Providerç»„ä»¶åœ¨æ‰€æœ‰ç»„ä»¶çš„æœ€å¤–å±‚ï¼Œå…¶æ¥å—storeä½œä¸ºå‚æ•°ï¼Œå°†storeé‡Œçš„stateä½¿ç”¨contextå±æ€§å‘ä¸‹ä¼ é€’ã€‚éƒ¨åˆ†æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"> getChildContext() &#123;</span><br><span class="line"> <span class="keyword">return</span> &#123; <span class="attr">store</span>: <span class="keyword">this</span>.store &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line"> <span class="keyword">super</span>(props, context)</span><br><span class="line"> <span class="keyword">this</span>.store = props.store</span><br><span class="line"> &#125;</span><br><span class="line"> render() &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; children &#125; = <span class="keyword">this</span>.props</span><br><span class="line"> <span class="keyword">return</span> Children.only(children)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨contextè¿™ä¸ªå±æ€§ï¼ŒProvideræ‰€æœ‰å­ç»„ä»¶å‡å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå±æ€§ã€‚</p><h3 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h3><p>connectå®ç°çš„åŠŸèƒ½æ˜¯å°†éœ€è¦å…³è”storeçš„ç»„ä»¶å’Œstoreçš„dispatchç­‰æ•°æ®æ··åˆåˆ°ä¸€å—ï¼Œè¿™å—å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶å…¸å‹çš„åº”ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hoistStatics <span class="keyword">from</span> <span class="string">'hoist-non-react-statics'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps, mergeProps, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">wrapWithConnect</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> render() &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> <span class="keyword">if</span> (withRef) &#123;</span><br><span class="line"> <span class="keyword">this</span>.renderedElement = createElement(WrappedComponent, &#123;</span><br><span class="line"> ...this.mergedProps,</span><br><span class="line"> ref: <span class="string">'wrappedInstance'</span></span><br><span class="line"> &#125;)</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">this</span>.renderedElement = createElement(WrappedComponent,</span><br><span class="line"> <span class="keyword">this</span>.mergedProps</span><br><span class="line"> )</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">this</span>.renderedElement</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> <span class="keyword">return</span> hoistStatcis(Connect, WrappedComponent);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å…ˆä»ä»–çš„å››ä¸ªå‚æ•°è¯´èµ·ï¼š</p><h4 id="1-mapStateToProps"><a href="#1-mapStateToProps" class="headerlink" title="1.mapStateToProps"></a>1.mapStateToProps</h4><p>connect çš„ç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰äº†éœ€è¦ä» Redux çŠ¶æ€æ ‘ä¸­æå–å“ªäº›éƒ¨åˆ†å½“ä½œ props ä¼ ç»™å½“å‰ç»„ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¹Ÿæ˜¯ä½¿ç”¨ connect æ—¶ç»å¸¸ä¼ å…¥çš„å‚æ•°ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸ä¼ å…¥è¿™ä¸ªå‚æ•°ï¼ŒReact ç»„ä»¶å°†æ°¸è¿œä¸ä¼šå’Œ Redux çš„çŠ¶æ€æ ‘äº§ç”Ÿä»»ä½•å…³ç³»ã€‚å…·ä½“åœ¨æºä»£ç ä¸­çš„è¡¨ç°ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps, mergeProps, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> shouldSubscribe = <span class="built_in">Boolean</span>(mapStateToProps)</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> trySubscribe() &#123;</span><br><span class="line"> <span class="keyword">if</span> (shouldSubscribe &amp;&amp; !<span class="keyword">this</span>.unsubscribe) &#123;</span><br><span class="line"> <span class="keyword">this</span>.unsubscribe = <span class="keyword">this</span>.store.subscribe(<span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>))</span><br><span class="line"> <span class="keyword">this</span>.handleChange()</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>mapStateToProps</code>ä¼šè®¢é˜… Storeï¼Œæ¯å½“<code>state</code>æ›´æ–°çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œé‡æ–°è®¡ç®— UI ç»„ä»¶çš„å‚æ•°ï¼Œä»è€Œè§¦å‘ UI ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p><p><code>mapStateToProps</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯<code>state</code>å¯¹è±¡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»£è¡¨å®¹å™¨ç»„ä»¶çš„<code>props</code>å¯¹è±¡ã€‚</p><p>è¿™å—çš„æºç ç›¸å¯¹è¾ƒç®€å•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapState = mapStateToProps || defaultMapStateToProps </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123; </span><br><span class="line">    computeStateProps(store, props) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.finalMapStateToProps) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.configureFinalMapState(store, props)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> state = store.getState()</span><br><span class="line">        <span class="keyword">const</span> stateProps = <span class="keyword">this</span>.doStatePropsDependOnOwnProps ?</span><br><span class="line">          <span class="keyword">this</span>.finalMapStateToProps(state, props) :</span><br><span class="line">          <span class="keyword">this</span>.finalMapStateToProps(state)</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          checkStateShape(stateProps, <span class="string">'mapStateToProps'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stateProps</span><br><span class="line">      &#125;</span><br><span class="line">      configureFinalMapState(store, props) &#123;</span><br><span class="line">        <span class="keyword">const</span> mappedState = mapState(store.getState(), props)</span><br><span class="line">        <span class="keyword">const</span> isFactory = <span class="keyword">typeof</span> mappedState === <span class="string">'function'</span></span><br><span class="line">        <span class="keyword">this</span>.finalMapStateToProps = isFactory ? mappedState : mapState</span><br><span class="line">        <span class="keyword">this</span>.doStatePropsDependOnOwnProps = <span class="keyword">this</span>.finalMapStateToProps.length !== <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (isFactory) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.computeStateProps(store, props)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          checkStateShape(mappedState, <span class="string">'mapStateToProps'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mappedState</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å—åŸç†å¾ˆç®€å•ï¼Œè¿›è¡Œä¸€äº›å‚æ•°æ ¡éªŒï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°mapStateToPropsè¿”å›å€¼æ˜¯å¦ä¸ºfunctionï¼Œå¦‚æœæ˜¯é€’å½’è°ƒç”¨ï¼Œä¸æ˜¯çš„è¯ç®—å‡ºè¿”å›å€¼ã€‚å¦‚æœæ²¡ä¼ è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤ç»™{}ã€‚</p><blockquote><p>å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¼ ç»™ connect çš„ç¬¬ä¸€ä¸ªå‚æ•°æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œreact-redux è¿˜å…è®¸è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å‘¢ï¼Ÿç®€å•åœ°è¯´ï¼Œè¿™æ ·è®¾è®¡å¯ä»¥å…è®¸åœ¨ connect çš„ç¬¬ä¸€ä¸ªå‚æ•°é‡Œåˆ©ç”¨å‡½æ•°é—­åŒ…è¿›è¡Œä¸€äº›å¤æ‚è®¡ç®—çš„ç¼“å­˜ï¼Œä»è€Œå®ç°æ•ˆç‡ä¼˜åŒ–çš„ç›®çš„</p></blockquote><p>å½“ä½¿ç”¨çš„æ—¶å€™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">    home: state.home,</span><br><span class="line">    layout: state.layout</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ownProps</code>ä½œä¸ºå‚æ•°åï¼Œå¦‚æœå®¹å™¨ç»„ä»¶çš„å‚æ•°å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¼šå¼•å‘ UI ç»„ä»¶é‡æ–°æ¸²æŸ“</p><h4 id="2-mapDispatchToProps"><a href="#2-mapDispatchToProps" class="headerlink" title="2.mapDispatchToProps"></a>2.mapDispatchToProps</h4><p>äººå¦‚å…¶åï¼Œå®ƒæ¥å— store çš„ dispatch ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒæ—¶æ¥å— this.props ä½œä¸ºå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åœ¨ connect ä¸­æ–¹ä¾¿åœ°å°† actionCreator ä¸ dispatch ç»‘å®šåœ¨ä¸€èµ·ï¼ˆåˆ©ç”¨ bindActionCreators æ–¹æ³•ï¼‰ï¼Œæœ€ç»ˆç»‘å®šå¥½çš„æ–¹æ³•ä¹Ÿä¼šä½œä¸º props ä¼ ç»™å½“å‰ç»„ä»¶ã€‚è¿™å—çš„æºç ä¸mapStateToPropsä¸€æ ·ï¼Œå°±ä¸è´´äº†ã€‚</p><p>bindActionCreator</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(actionCreator(...args))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-mergeProps"><a href="#3-mergeProps" class="headerlink" title="3.mergeProps"></a>3.mergeProps</h4><p>å‰ä¸¤ä¸ªå‚æ•°è¿”å›çš„å¯¹è±¡ï¼Œéƒ½è¦è·Ÿç»„ä»¶è‡ªèº«çš„props mergeä¸€ä¸‹ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å¯¹è±¡èµ‹å€¼ç»™å¯¹åº”ç»„ä»¶ï¼Œå¯ä»¥åœ¨è¿™ä¸€æ­¥åšä¸€äº›å¤„ç†ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼Œè¯¥å‚æ•°ç­¾åï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mergeProps(stateProps, dispatchProps, ownProps): props</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µå¦‚æœæ²¡ä¼ è¯¥å‚æ•°ï¼Œè¿”å›<code>Object.assign(ownProps, stateProps, dispatchProps)</code>ã€‚</p><h4 id="4-options"><a href="#4-options" class="headerlink" title="4.options"></a>4.options</h4><p>å¦‚æœæŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥å®šåˆ¶ connector çš„è¡Œä¸ºã€‚</p><ul><li>[<code>pure = true</code>] <em>(Boolean)</em>: å¦‚æœä¸º trueï¼Œconnector å°†æ‰§è¡Œ <code>shouldComponentUpdate</code> å¹¶ä¸”æµ…å¯¹æ¯” <code>mergeProps</code> çš„ç»“æœï¼Œé¿å…ä¸å¿…è¦çš„æ›´æ–°ï¼Œå‰ææ˜¯å½“å‰ç»„ä»¶æ˜¯ä¸€ä¸ªâ€œçº¯â€ç»„ä»¶ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•çš„è¾“å…¥æˆ– state è€Œåªä¾èµ–äº props å’Œ Redux store çš„ stateã€‚*é»˜è®¤å€¼ä¸º trueã€‚*</li><li>[<code>withRef = false</code>] <em>(Boolean)</em>: å¦‚æœä¸º trueï¼Œconnector ä¼šä¿å­˜ä¸€ä¸ªå¯¹è¢«åŒ…è£…ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ï¼Œè¯¥å¼•ç”¨é€šè¿‡ <code>getWrappedInstance()</code> æ–¹æ³•è·å¾—ã€‚*é»˜è®¤å€¼ä¸º falseã€‚*</li></ul><p>è¿™ä¸ªconnectç»„ä»¶è¿˜å¹²äº†ä¸€ä»¶äº‹ï¼ŒçŠ¶æ€ç¼“å­˜åˆ¤æ–­ã€‚å½“storeå˜äº†çš„æ—¶å€™ï¼Œå‰åçŠ¶æ€åˆ¤æ–­ï¼Œå¦‚æœçŠ¶æ€ä¸ç­‰ï¼Œæ›´æ–°ç»„ä»¶ï¼Œå¹¶ä¸”å®Œæˆäº‹ä»¶åˆ†å‘ã€‚</p><h2 id="6-Reduxæµç¨‹æ¢³ç†"><a href="#6-Reduxæµç¨‹æ¢³ç†" class="headerlink" title="6. Reduxæµç¨‹æ¢³ç†"></a>6. Reduxæµç¨‹æ¢³ç†</h2><p>ä¸Šé¢è®²äº†å¤§é‡çš„å‡½æ•°æºç ï¼Œè¿™ä¹ˆäº›å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼š<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://sslstatic.ktanx.com/images/release/201811/4g40yEqEfjeRqxs6.png" alt="4g40yEqEfjeRqxs6.png" title>                </div>                <div class="image-caption">4g40yEqEfjeRqxs6.png</div>            </figure>åˆå§‹åŒ–é˜¶æ®µï¼š</p><ol><li>createStoreåˆ›å»ºä¸€ä¸ªstoreå¯¹è±¡</li><li>å°†storeå¯¹è±¡é€šè¿‡å‚æ•°ç»™Providerç»„ä»¶</li><li>Providerç»„ä»¶å°†storeé€šè¿‡contextå‘å­ç»„ä»¶ä¼ é€’</li><li>Connectç»„ä»¶é€šè¿‡contextè·å–åˆ°storeï¼Œå­˜å…¥è‡ªå·±çš„state</li><li>componentDidMounté‡Œé¢è®¢é˜…store.subscribeäº‹ä»¶</li></ol><p>æ›´æ–°æ•°æ®é˜¶æ®µï¼š</p><ol><li>ç”¨æˆ·äº‹ä»¶è§¦å‘</li><li>actionCreatorç”Ÿæˆactionäº¤ç»™dispatch</li><li>å®é™…ä¸Šäº¤ç»™äº†å°è£…åçš„ä¸­é—´å±‚ï¼ˆcompose(applyMiddleware(â€¦))ï¼‰</li><li>è¯·æ±‚ä¾æ¬¡é€šè¿‡æ¯ä¸ªä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶é€šè¿‡nextè¿›è¡Œä¸‹ä¸€æ­¥</li><li>æœ€åä¸€ä¸ªä¸­é—´ä»¶å°†actionäº¤ç»™store.dispatch</li><li>dispatchå†…éƒ¨å°†actionäº¤ç»™reduceræ‰§è¡Œ</li><li>combineReducerå°†æ¯ä¸ªå­reduceræ‰§è¡Œä¸€éç®—å‡ºæ–°çš„state</li><li>dispatchå†…éƒ¨è°ƒç”¨æ‰€æœ‰è®¢é˜…äº‹ä»¶</li><li>Connectç»„ä»¶handleChangeäº‹ä»¶è§¦å‘åˆ¤æ–­æ–°stateå’Œæ—§stateæ˜¯å¦===</li><li>å¹¶ä¸”åˆ¤æ–­æ–°çš„stateæ˜¯å¦ä¸mapStateToProps shallowEqual</li><li>ä¸ç­‰åˆ™setStateè§¦å‘æ›´æ–°</li></ol><h2 id="7-Reduxè®¾è®¡æŠ€å·§"><a href="#7-Reduxè®¾è®¡æŠ€å·§" class="headerlink" title="7.Reduxè®¾è®¡æŠ€å·§"></a>7.Reduxè®¾è®¡æŠ€å·§</h2><ol><li><p>åŒ¿åå‡½æ•°&amp;&amp;é—­åŒ…ä½¿ç”¨</p><p>reduxæ ¸å¿ƒå‡½æ•°å¤§é‡ä½¿ç”¨äº†åŒ¿åå‡½æ•°å’Œé—­åŒ…æ¥å®ç°æ•°æ®å…±äº«å’ŒçŠ¶æ€åŒæ­¥ã€‚</p></li><li><p>å‡½æ•°æŸ¯é‡ŒåŒ–ä½¿ç”¨</p><p>ä½¿ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–så®ç°å‚æ•°å¤ç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯é™ä½é€šç”¨æ€§ï¼Œæé«˜é€‚ç”¨æ€§ã€‚</p></li><li><p>æ ¸å¿ƒçŠ¶æ€è¯»å–æ˜¯æ‹·è´è€Œä¸æ˜¯åœ°å€</p><p>å¯¹äºstateè¿™ç§æ ¸å¿ƒçŠ¶æ€ä½¿ç”¨getState()è®¡ç®—å‡ºæ–°çš„stateï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªstateå¯¹è±¡ã€‚</p></li><li><p>è§‚å¯Ÿè€…è®¢é˜…è€…æ˜¯æ ¸å¿ƒå®ç°</p><p>ä½¿ç”¨è§‚å¯Ÿè€…è®¢é˜…è€…æ¨¡å¼å®ç°æ•°æ®å“åº”ã€‚</p></li><li><p>contextè¿™ä¸ªapiçš„ä½¿ç”¨</p><p>å¹³æ—¶å¼€å‘ä¸å¸¸æ¥è§¦çš„apiå®ç°Providerä¸Connecté€šä¿¡ã€‚</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Reduxä½¿ç”¨ä¸­çš„å‡ ä¸ªç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Reduxä¸‰å¤§è®¾è®¡åŸåˆ™&lt;/li&gt;
&lt;li&gt;Create Store&lt;/li&gt;
&lt;li&gt;Redux middleware&lt;/li&gt;
&lt;li&gt;combineReducer&lt;/li&gt;
&lt;li&gt;Providerä¸Connect&lt;
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥äº†è§£useMemoå’ŒuseCallback</title>
    <link href="https://summxu.github.io/2021/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3useMemo%E5%92%8CuseCallback/"/>
    <id>https://summxu.github.io/2021/æ·±å…¥äº†è§£useMemoå’ŒuseCallback/</id>
    <published>2021-10-31T01:06:38.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>ä» <code>useMemo</code> å¼€å§‹ã€‚<code>useMemo</code> çš„åŸºæœ¬æ€æƒ³æ˜¯å®ƒå…è®¸åœ¨æ¸²æŸ“ä¹‹é—´â€œè®°ä½â€è®¡ç®—å€¼ã€‚è¿™ä¸ªå®šä¹‰éœ€è¦ä¸€äº›è§£é‡Šï¼Œå…ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>React åšçš„ä¸»è¦äº‹æƒ…æ˜¯ä¿æŒUIä¸åº”ç”¨ç¨‹åºçŠ¶æ€åŒæ­¥ã€‚å®ƒç”¨æ¥åšè¿™ä»¶äº‹çš„å·¥å…·å«åšâ€œre-renderâ€ã€‚åŸºäºå½“å‰åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œæ¯æ¬¡é‡æ–°å‘ˆç°éƒ½æ˜¯åº”ç”¨ç¨‹åºUIåœ¨ç»™å®šæ—¶åˆ»åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„å¿«ç…§ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€å †ç…§ç‰‡ï¼Œæ¯ä¸€å¼ ç…§ç‰‡éƒ½è®°å½•äº†ç»™å®šæ¯ä¸ªçŠ¶æ€å˜é‡çš„ç‰¹å®šå€¼æ—¶äº‹ç‰©çš„æ ·å­ã€‚</p><p>æ¯æ¬¡â€œre-renderâ€éƒ½ä¼šæ ¹æ®å½“å‰çŠ¶æ€åœ¨è„‘æµ·ä¸­ç”Ÿæˆ DOM åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„å›¾åƒã€‚ä½†å®é™…ä¸Šå®ƒæ˜¯ä¸€å †JSå¯¹è±¡ï¼Œè¢«ç§°ä¸ºâ€œ<strong>virtual DOM</strong>â€ã€‚</p><p>ä¸ç›´æ¥å‘Šè¯‰ React éœ€è¦æ›´æ”¹å“ªäº› DOM èŠ‚ç‚¹ã€‚ç›¸åï¼Œæ ¹æ®å½“å‰çŠ¶æ€å‘Šè¯‰React UIåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚é€šè¿‡é‡æ–°æ¸²æŸ“ï¼ŒReact åˆ›å»ºä¸€ä¸ªæ–°çš„å¿«ç…§ï¼Œå®ƒå¯ä»¥é€šè¿‡æ¯”è¾ƒå¿«ç…§æ‰¾å‡ºéœ€è¦æ›´æ”¹çš„å†…å®¹ï¼Œå°±åƒç©â€œå¯»æ‰¾å·®å¼‚â€æ¸¸æˆä¸€æ ·ã€‚</p><p>React åœ¨å¼€ç®±å³ç”¨æ—¶è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œé‡æ–°æ¸²æŸ“ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåˆ›å»ºè¿™äº›å¿«ç…§ç¡®å®éœ€è¦ä¸€äº›æ—¶é—´ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚ UI åœ¨ç”¨æˆ·æ‰§è¡Œæ“ä½œåæ›´æ–°ä¸å¤Ÿå¿«ã€‚</p><p>è€Œ <code>useMemo</code> å’Œ <code>useCallback</code> æ˜¯ç”¨æ¥å¸®åŠ©ä¼˜åŒ–é‡æ¸²æŸ“çš„å·¥å…·ã€‚ä»–ä»¬é€šè¿‡ä¸¤ç§æ–¹å¼åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><ol><li>å‡å°‘åœ¨ç»™å®šæ¸²æŸ“ä¸­éœ€è¦å®Œæˆçš„å·¥ä½œé‡ã€‚</li><li>å‡å°‘ç»„ä»¶éœ€è¦é‡æ–°å‘ˆç°çš„æ¬¡æ•°ã€‚</li></ol><p>è®©é€šè¿‡ä¸‹é¢çš„æ —å­æ¥ç†è§£å®ƒä»¬å§ã€‚</p><h2 id="2-ç¤ºä¾‹1ï¼šå¤§é‡çš„è®¡ç®—"><a href="#2-ç¤ºä¾‹1ï¼šå¤§é‡çš„è®¡ç®—" class="headerlink" title="2. ç¤ºä¾‹1ï¼šå¤§é‡çš„è®¡ç®—"></a>2. ç¤ºä¾‹1ï¼šå¤§é‡çš„è®¡ç®—</h2><p>å‡è®¾æ­£åœ¨æ„å»ºä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©ç”¨æˆ·æŸ¥æ‰¾ 0 åˆ° <code>selectedNum</code> ä¹‹é—´çš„æ‰€æœ‰ç´ æ•°ï¼Œå…¶ä¸­ <code>selectedNum</code> æ˜¯ç”¨æˆ·æä¾›çš„å€¼ã€‚**è´¨æ•°æ˜¯åªèƒ½è¢«1å’Œè‡ªèº«æ•´é™¤çš„æ•°ï¼Œæ¯”å¦‚17ã€‚**ä¸‹é¢æ˜¯ä¸€ä¸ªå¯èƒ½çš„å®ç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å­˜å‚¨ç”¨æˆ·æ‰€é€‰å·ç çš„çŠ¶æ€ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> [selectedNum, setSelectedNum] = React.useState(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—ä» 0 åˆ°ç”¨æˆ·é€‰æ‹©çš„æ•°å­— selectedNum ä¹‹é—´çš„æ‰€æœ‰ç´ æ•°</span></span><br><span class="line">  <span class="keyword">const</span> allPrimes = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">      allPrimes.push(counter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;form&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">"num"</span>&gt;Your number:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"number"</span></span><br><span class="line">          value=&#123;selectedNum&#125;</span><br><span class="line">          onChange=&#123;(event) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é˜²æ­¢å¤ªå¤§ï¼Œå°†æœ€å¤§å€¼è®¾å®šåœ¨10ä¸‡</span></span><br><span class="line">            <span class="keyword">let</span> num = <span class="built_in">Math</span>.min(<span class="number">100</span>_000, <span class="built_in">Number</span>(event.target.value));</span><br><span class="line"></span><br><span class="line">            setSelectedNum(num);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        There are &#123;allPrimes.length&#125; prime(s) between 1 and &#123;selectedNum&#125;:&#123;' '&#125;</span></span><br><span class="line"><span class="regexp">        &lt;span className="prime-list"&gt;&#123;allPrimes.join(', ')&#125;&lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ç»™å®šæ•°å­—æ˜¯å¦æ˜¯ç´ æ•°çš„ Helper å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sqrt(n));</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt;= max; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % counter === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªå«åš <code>selectedNum</code> çš„æ•°å­—ã€‚ä½¿ç”¨ <code>for</code> å¾ªç¯ï¼Œæ‰‹åŠ¨è®¡ç®— 0 åˆ° <code>selectedNum</code> ä¹‹é—´çš„æ‰€æœ‰ç´ æ•°ã€‚å‘ˆç°ä¸€ä¸ªå—æ§åˆ¶çš„æ•°å­—è¾“å…¥ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ›´æ”¹ <code>selectedNum</code> ã€‚å‘ç”¨æˆ·æ˜¾ç¤ºè®¡ç®—çš„æ‰€æœ‰è´¨æ•°ã€‚</p><p>è¿™æ®µä»£ç éœ€è¦å¤§é‡çš„è®¡ç®—ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©ä¸€ä¸ªè¾ƒå¤§çš„ <code>selectedNum</code>ï¼Œå°†éœ€è¦éå†æˆåƒä¸Šä¸‡ä¸ªæ•°å­—ï¼Œæ£€æŸ¥æ˜¯å¦æ¯ä¸ªæ•°å­—éƒ½æ˜¯ç´ æ•°ã€‚è€Œä¸”ï¼Œè™½ç„¶æœ‰æ¯”æˆ‘ä¸Šé¢ä½¿ç”¨çš„æ›´æœ‰æ•ˆçš„è´¨æ•°æ£€æŸ¥ç®—æ³•ï¼Œä½†å®ƒæ€»æ˜¯éœ€è¦å¤§é‡çš„è®¡ç®—ã€‚</p><p>æœ‰æ—¶ç¡®å®éœ€è¦æ‰§è¡Œè¿™ä¸ªè®¡ç®—ï¼Œæ¯”å¦‚å½“ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ–°çš„ <code>selectedNum</code> æ—¶ã€‚ä½†æ˜¯å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå¦‚æœåœ¨ä¸éœ€è¦åšçš„æ—¶å€™æ— å¿åœ°åšè¿™é¡¹å·¥ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œè®©å‡è®¾çš„ä¾‹å­è¿˜åŒ…å«ä¸€ä¸ªæ•°å­—æ—¶é’Ÿ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">'date-fns/format'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [selectedNum, setSelectedNum] = React.useState(<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// time æ˜¯ä¸€ä¸ªæ¯ç§’æ”¹å˜ä¸€æ¬¡çš„çŠ¶æ€å˜é‡ï¼Œå› æ­¤å®ƒæ€»æ˜¯ä¸å½“å‰æ—¶é—´åŒæ­¥ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> time = useTime();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¡ç®—æ‰€æœ‰è´¨æ•°ï¼ˆä¸å‰é¢çš„ç¤ºä¾‹ç›¸åŒï¼‰</span></span><br><span class="line">  <span class="keyword">const</span> allPrimes = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">      allPrimes.push(counter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p className=<span class="string">"clock"</span>&gt;</span><br><span class="line">        &#123;format(time, <span class="string">'hh:mm:ss a'</span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;form&gt;</span></span><br><span class="line"><span class="regexp">        &lt;label htmlFor="num"&gt;Your number:&lt;/</span>label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"number"</span></span><br><span class="line">          value=&#123;selectedNum&#125;</span><br><span class="line">          onChange=&#123;(event) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é˜²æ­¢å¤ªå¤§ï¼Œå°†æœ€å¤§å€¼è®¾å®šåœ¨10ä¸‡</span></span><br><span class="line">            <span class="keyword">let</span> num = <span class="built_in">Math</span>.min(<span class="number">100</span>_000, <span class="built_in">Number</span>(event.target.value));</span><br><span class="line">            setSelectedNum(num);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        There are &#123;allPrimes.length&#125; prime(s) between 1 and &#123;selectedNum&#125;:</span></span><br><span class="line"><span class="regexp">        &#123;' '&#125;</span></span><br><span class="line"><span class="regexp">        &lt;span className="prime-list"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;allPrimes.join(', ')&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [time, setTime] = React.useState(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  </span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> intervalId = <span class="built_in">window</span>.setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setTime(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.clearInterval(intervalId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sqrt(n));</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt;= max; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % counter === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><p>çš„åº”ç”¨ç¨‹åºç°åœ¨æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œ<code>selectedNum</code> å’Œ <code>time</code>ã€‚æ—¶é—´å˜é‡æ¯ç§’æ›´æ–°ä¸€æ¬¡ï¼Œä»¥åæ˜ å½“å‰æ—¶é—´ï¼Œè¯¥å€¼ç”¨äºå‘ˆç°å³ä¸Šè§’çš„æ•°å­—æ—¶é’Ÿã€‚</p><p>é—®é¢˜åœ¨äºï¼š<strong>æ¯å½“è¿™äº›çŠ¶æ€å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šé‡æ–°è¿è¡Œé‚£äº›æ˜‚è´µçš„è´¨æ•°è®¡ç®—ã€‚å› ä¸ºæ—¶é—´æ¯ç§’æ”¹å˜ä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€ä¸æ–­åœ°é‡æ–°ç”Ÿæˆè´¨æ•°åˆ—è¡¨ï¼Œå³ä½¿ç”¨æˆ·é€‰æ‹©çš„æ•°å­—æ²¡æœ‰æ”¹å˜ï¼ï¼ï¼</strong></p><p>åœ¨ JavaScript ä¸­ï¼Œåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé€šè¿‡ä¸€éåˆä¸€éåœ°è¿è¡Œè¿™æ®µä»£ç è®©å®ƒéå¸¸ç¹å¿™ï¼Œæ¯ä¸€ç§’ã€‚è¿™æ„å‘³ç€å½“ç”¨æˆ·å°è¯•åšå…¶ä»–äº‹æƒ…æ—¶ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ„Ÿåˆ°è¿Ÿç¼“ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šã€‚</p><p>ä½†å¦‚æœå¯ä»¥â€œè·³è¿‡â€è¿™äº›è®¡ç®—å‘¢ï¼Ÿå¦‚æœå·²ç»æœ‰äº†ä¸€ä¸ªç»™å®šæ•°å­—çš„è´¨æ•°åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆä¸é‡ç”¨è¿™ä¸ªå€¼è€Œä¸æ˜¯æ¯æ¬¡éƒ½ä»å¤´è®¡ç®—å‘¢ï¼Ÿè¿™æ­£æ˜¯ <code>useMemo</code> å…è®¸åšçš„ã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allPrimes = React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">      result.push(counter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;, [selectedNum]);</span><br></pre></td></tr></table></figure><p><code>useMemo</code> æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li>è¦æ‰§è¡Œçš„å·¥ä½œå—ï¼Œå°è£…åœ¨å‡½æ•°ä¸­</li><li>ä¾èµ–é¡¹åˆ—è¡¨</li></ol><p>åœ¨æŒ‚è½½æœŸé—´ï¼Œå½“è¿™ä¸ªç»„ä»¶ç¬¬ä¸€æ¬¡å‘ˆç°æ—¶ï¼ŒReact å°†è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è¿è¡Œæ‰€æœ‰çš„é€»è¾‘ï¼Œè®¡ç®—æ‰€æœ‰çš„è´¨æ•°ã€‚æ— è®ºä»è¿™ä¸ªå‡½æ•°è¿”å›ä»€ä¹ˆï¼Œéƒ½è¢«èµ‹å€¼ç»™ <code>allPrimes</code> å˜é‡ã€‚</p><p>ç„¶è€Œï¼Œå¯¹äºæ¯ä¸€ä¸ªåç»­æ¸²æŸ“ï¼ŒReact éƒ½è¦åšå‡ºé€‰æ‹©ã€‚</p><ol><li>å†æ¬¡è°ƒç”¨å‡½æ•°ï¼Œé‡æ–°è®¡ç®—å€¼</li><li>é‡ç”¨å®ƒä¸Šæ¬¡æ‰§è¡Œæ­¤å·¥ä½œæ—¶å·²ç»æ‹¥æœ‰çš„æ•°æ®ã€‚</li></ol><p>ä¸ºäº†åšå‡ºé€‰æ‹©ï¼ŒReact æŸ¥çœ‹æä¾›çš„ä¾èµ–é¡¹åˆ—è¡¨ã€‚å¯¹äºä¹‹å‰çš„æ¸²æŸ“æœ‰ä»»ä½•æ”¹å˜å—ï¼Ÿå¦‚æœæ˜¯ï¼ŒReact å°†é‡æ–°è¿è¡Œæä¾›çš„å‡½æ•°ï¼Œä»¥è®¡ç®—ä¸€ä¸ªæ–°çš„å€¼ã€‚å¦åˆ™ï¼Œå®ƒå°†è·³è¿‡æ‰€æœ‰è¿™äº›å·¥ä½œå¹¶é‡ç”¨ä¹‹å‰è®¡ç®—çš„å€¼ã€‚</p><p><code>useMemo</code> æœ¬è´¨ä¸Šç±»ä¼¼äºç¼“å­˜ï¼Œä¾èµ–é¡¹æ˜¯ç¼“å­˜å¤±æ•ˆç­–ç•¥ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯åœ¨è¯´â€œåªæœ‰å½“ <code>selectedNum</code> å‘ç”Ÿå˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—è´¨æ•°åˆ—è¡¨â€ã€‚å½“ç»„ä»¶ç”±äºå…¶ä»–åŸå› é‡æ–°å‘ˆç°æ—¶ï¼ˆä¾‹å¦‚ã€‚å½“æ—¶é—´çŠ¶æ€å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼‰ï¼Œ<code>useMemo</code> å¿½ç•¥å‡½æ•°å¹¶ä¼ é€’ç¼“å­˜çš„å€¼ã€‚</p><p>è¿™é€šå¸¸è¢«ç§°ä¸ºè®°å¿†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªé’©å­è¢«ç§°ä¸º <code>useMemo</code>ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„å®æ—¶ç‰ˆæœ¬ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">'date-fns/format'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [selectedNum, setSelectedNum] = React.useState(<span class="number">100</span>);</span><br><span class="line">  <span class="keyword">const</span> time = useTime();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> allPrimes = React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">        result.push(counter);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;, [selectedNum]);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p className=<span class="string">"clock"</span>&gt;</span><br><span class="line">        &#123;format(time, <span class="string">'hh:mm:ss a'</span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;form&gt;</span></span><br><span class="line"><span class="regexp">        &lt;label htmlFor="num"&gt;Your number:&lt;/</span>label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"number"</span></span><br><span class="line">          value=&#123;selectedNum&#125;</span><br><span class="line">          onChange=&#123;(event) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é˜²æ­¢å¤ªå¤§ï¼Œå°†æœ€å¤§å€¼è®¾å®šåœ¨10ä¸‡</span></span><br><span class="line">            <span class="keyword">let</span> num = <span class="built_in">Math</span>.min(<span class="number">100</span>_000, <span class="built_in">Number</span>(event.target.value));</span><br><span class="line">            </span><br><span class="line">            setSelectedNum(num);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        There are &#123;allPrimes.length&#125; prime(s) between 1 and &#123;selectedNum&#125;:</span></span><br><span class="line"><span class="regexp">        &#123;' '&#125;</span></span><br><span class="line"><span class="regexp">        &lt;span className="prime-list"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;allPrimes.join(', ')&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [time, setTime] = React.useState(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"></span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> intervalId = <span class="built_in">window</span>.setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setTime(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.clearInterval(intervalId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sqrt(n));</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt;= max; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % counter === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œ<code>useMemo</code> é’©å­ç¡®å®å¯ä»¥å¸®åŠ©é¿å…è¿™é‡Œä¸å¿…è¦çš„è®¡ç®—ã€‚ä½†å®ƒçœŸçš„æ˜¯è¿™é‡Œçš„æœ€ä½³è§£å†³æ–¹æ¡ˆå—ï¼Ÿé€šå¸¸ï¼Œå¯ä»¥é€šè¿‡é‡ç»„åº”ç”¨ç¨‹åºä¸­çš„å†…å®¹æ¥é¿å…å¯¹ <code>useMemo</code> çš„éœ€æ±‚ã€‚å¯ä»¥è¿™æ ·åšï¼š</p><ol><li><code>PrimeCalculator.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimeCalculator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [selectedNum, setSelectedNum] = React.useState(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> allPrimes = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">      allPrimes.push(counter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;form&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">"num"</span>&gt;Your number:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"number"</span></span><br><span class="line">          value=&#123;selectedNum&#125;</span><br><span class="line">          onChange=&#123;(event) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é˜²æ­¢å¤ªå¤§ï¼Œå°†æœ€å¤§å€¼è®¾å®šåœ¨10ä¸‡</span></span><br><span class="line">            <span class="keyword">let</span> num = <span class="built_in">Math</span>.min(<span class="number">100</span>_000, <span class="built_in">Number</span>(event.target.value));</span><br><span class="line">            </span><br><span class="line">            setSelectedNum(num);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        There are &#123;allPrimes.length&#125; prime(s) between 1 and &#123;selectedNum&#125;:</span></span><br><span class="line"><span class="regexp">        &#123;' '&#125;</span></span><br><span class="line"><span class="regexp">        &lt;span className="prime-list"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;allPrimes.join(', ')&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sqrt(n));</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt;= max; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % counter === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> PrimeCalculator;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>Clock.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">'date-fns/format'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Clock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time = useTime();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;p className=<span class="string">"clock"</span>&gt;</span><br><span class="line">      &#123;format(time, <span class="string">'hh:mm:ss a'</span>)&#125;</span><br><span class="line">    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useTime() &#123;</span></span><br><span class="line"><span class="regexp">  const [time, setTime] = React.useState(new Date());</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  React.useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const intervalId = window.setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      setTime(new Date());</span></span><br><span class="line"><span class="regexp">    &#125;, 1000);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">    return () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      window.clearInterval(intervalId);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, []);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  return time;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Clock;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>App.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Clock <span class="keyword">from</span> <span class="string">'./Clock'</span>;</span><br><span class="line"><span class="keyword">import</span> PrimeCalculator <span class="keyword">from</span> <span class="string">'./PrimeCalculator'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Clock /&gt;</span><br><span class="line">      &lt;PrimeCalculator /&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p>æˆ‘æå–äº†ä¸¤ä¸ªæ–°ç»„ä»¶ï¼Œ<code>Clock</code> å’Œ <code>PrimeCalculator</code>ã€‚é€šè¿‡ä» <code>App</code> åˆ†æ”¯ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶å„è‡ªç®¡ç†è‡ªå·±çš„çŠ¶æ€ã€‚ä¸€ä¸ªç»„ä»¶ä¸­çš„é‡æ–°æ¸²æŸ“ä¸ä¼šå½±å“å¦ä¸€ä¸ªç»„ä»¶ã€‚</p><p>æˆ–è®¸ä½ å¬åˆ°å¾ˆå¤šå…³äºæå‡çŠ¶æ€çš„è¯´æ³•ï¼Œä½†æœ‰æ—¶ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å°†çŠ¶æ€å‘ä¸‹æ¨ã€‚æ¯ä¸ªç»„ä»¶åº”è¯¥æœ‰ä¸€ä¸ªå•ç‹¬çš„èŒè´£ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>App</code> æ­£åœ¨åšä¸¤ä»¶å®Œå…¨ä¸ç›¸å…³çš„äº‹æƒ…ã€‚</p><p>ç°åœ¨ï¼Œè¿™å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªé€‰æ‹©ã€‚åœ¨ä¸€ä¸ªå¤§å‹çš„ç°å®åº”ç”¨ä¸­ï¼Œæœ‰è®¸å¤šçŠ¶æ€éœ€è¦å‘ä¸Šæå‡ï¼Œè€Œä¸èƒ½å‘ä¸‹æ¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘è¿˜æœ‰å¦ä¸€ä¸ªå¦™è®¡ã€‚è®©çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾éœ€è¦å°† <code>time</code> å˜é‡æå‡åˆ° <code>PrimeCalculator</code> ä¹‹ä¸Šï¼š</p><ol><li><code>PrimeCalculator.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimeCalculator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [selectedNum, setSelectedNum] = React.useState(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> allPrimes = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt; selectedNum; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(counter)) &#123;</span><br><span class="line">      allPrimes.push(counter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;form&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">"num"</span>&gt;Your number:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"number"</span></span><br><span class="line">          value=&#123;selectedNum&#125;</span><br><span class="line">          onChange=&#123;(event) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é˜²æ­¢å¤ªå¤§ï¼Œå°†æœ€å¤§å€¼è®¾å®šåœ¨10ä¸‡</span></span><br><span class="line">            <span class="keyword">let</span> num = <span class="built_in">Math</span>.min(<span class="number">100</span>_000, <span class="built_in">Number</span>(event.target.value));</span><br><span class="line">            </span><br><span class="line">            setSelectedNum(num);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        There are &#123;allPrimes.length&#125; prime(s) between 1 and &#123;selectedNum&#125;:</span></span><br><span class="line"><span class="regexp">        &#123;' '&#125;</span></span><br><span class="line"><span class="regexp">        &lt;span className="prime-list"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;allPrimes.join(', ')&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sqrt(n));</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> counter = <span class="number">2</span>; counter &lt;= max; counter++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % counter === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> PrimeCalculator;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>Clock.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">'date-fns/format'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Clock</span>(<span class="params">&#123; time &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;p className=<span class="string">"clock"</span>&gt;</span><br><span class="line">      &#123;format(time, <span class="string">'hh:mm:ss a'</span>)&#125;</span><br><span class="line">    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Clock;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>App.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHours &#125; <span class="keyword">from</span> <span class="string">'date-fns'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Clock <span class="keyword">from</span> <span class="string">'./Clock'</span>;</span><br><span class="line"><span class="keyword">import</span> PrimeCalculator <span class="keyword">from</span> <span class="string">'./PrimeCalculator'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†çš„PrimeCalculatorè½¬æ¢ä¸ºä¸€ä¸ªçº¯ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> PurePrimeCalculator = React.memo(PrimeCalculator);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time = useTime();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®ä¸€å¤©ä¸­çš„æ—¶é—´é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„èƒŒæ™¯è‰²</span></span><br><span class="line">  <span class="keyword">const</span> backgroundColor = getBackgroundColorFromTime(time);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123; backgroundColor &#125;&#125;&gt;</span><br><span class="line">      &lt;Clock time=&#123;time&#125; /&gt;</span><br><span class="line">      &lt;PurePrimeCalculator /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const getBackgroundColorFromTime = (time) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const hours = getHours(time);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  if (hours &lt; 12) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ æ—©æ™¨ç”¨çš„æ·¡é»„è‰²</span></span><br><span class="line"><span class="regexp">    return 'hsl(50deg 100% 90%)';</span></span><br><span class="line"><span class="regexp">  &#125; else if (hours &lt; 18) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ ä¸‹åˆæš—æ·¡çš„è“è‰²</span></span><br><span class="line"><span class="regexp">    return 'hsl(220deg 60% 92%)'</span></span><br><span class="line"><span class="regexp">  &#125; else &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ å¤œæ™šçš„æ·±è“è‰²</span></span><br><span class="line"><span class="regexp">    return 'hsl(220deg 100% 80%)';</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useTime() &#123;</span></span><br><span class="line"><span class="regexp">  const [time, setTime] = React.useState(new Date());</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  React.useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const intervalId = window.setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      setTime(new Date());</span></span><br><span class="line"><span class="regexp">    &#125;, 1000);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">    return () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      window.clearInterval(intervalId);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, []);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  return time;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p><code>React.memo</code> åŒ…åœ¨ç»„ä»¶å‘¨å›´ï¼Œä¿æŠ¤å®ƒå…å—ä¸ç›¸å…³çš„æ›´æ–°ã€‚<code>PurePrimeCalculator</code> åªæœ‰åœ¨æ¥æ”¶åˆ°æ–°æ•°æ®æˆ–å†…éƒ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé‡æ–°å‘ˆç°ã€‚è¿™å°±æ˜¯æ‰€è°“çš„çº¯ç»„ä»¶ã€‚æœ¬è´¨ä¸Šï¼Œå‘Šè¯‰ React è¿™ä¸ªç»„ä»¶å°†æ€»æ˜¯åœ¨ç›¸åŒçš„è¾“å…¥æ¡ä»¶ä¸‹äº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼Œå¯ä»¥è·³è¿‡æ²¡æœ‰ä»»ä½•æ”¹å˜çš„é‡æ–°å‘ˆç°ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘åº”ç”¨äº† <code>React.memo</code> åˆ°å¯¼å…¥çš„ <code>PrimeCalculator</code> ç»„ä»¶ã€‚äº‹å®ä¸Š,æˆ‘é€‰æ‹©äº†è¿™æ ·çš„ç»“æ„ï¼Œä»¥ä¾¿æ‰€æœ‰å†…å®¹éƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å¯è§ï¼Œä»¥ä¾¿æ›´å®¹æ˜“ç†è§£ã€‚åœ¨å®è·µä¸­ï¼Œä½¿ç”¨ <code>React.memo</code> ç»„ä»¶å¯¼å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PrimeCalculator.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimeCalculator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* è¿™é‡Œçš„ç»„ä»¶å†…å®¹ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(PrimeCalculator);</span><br></pre></td></tr></table></figure><p>çš„ <code>PrimeCalculator</code> ç»„ä»¶ç°åœ¨å°†å§‹ç»ˆæ˜¯çº¯çš„ï¼Œå½“è¦ä½¿ç”¨å®ƒæ—¶ï¼Œä¸éœ€è¦å¯¹å®ƒè¿›è¡Œä¿®è¡¥ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªè§†è§’è½¬æ¢ï¼šä¹‹å‰ï¼Œåœ¨è®°å¿†ä¸€ä¸ªç‰¹å®šè®¡ç®—çš„ç»“æœï¼Œè®¡ç®—è´¨æ•°ã€‚ç„¶è€Œï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘è®°ä½äº†æ•´ä¸ªç»„ä»¶ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œåªæœ‰å½“ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ–°çš„ <code>selectedNum</code> æ—¶ï¼Œæ˜‚è´µçš„è®¡ç®—æ‰ä¼šé‡æ–°è¿è¡Œã€‚ä½†ä¼˜åŒ–çš„æ˜¯çˆ¶ç»„ä»¶ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„æ…¢ä»£ç è¡Œã€‚</p><p>æˆ‘å¹¶ä¸æ˜¯è¯´ä¸€ç§æ–¹æ³•æ¯”å¦ä¸€ç§æ›´å¥½ï¼›æ¯ç§å·¥å…·åœ¨å·¥å…·ç®±ä¸­éƒ½æœ‰è‡ªå·±çš„ä½ç½®ã€‚ä½†åœ¨è¿™ä¸ªç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘æ›´å–œæ¬¢è¿™ç§æ–¹æ³•ã€‚ç°åœ¨ï¼Œå¦‚æœæ‚¨æ›¾ç»å°è¯•åœ¨ç°å®ä¸–ç•Œçš„è®¾ç½®ä¸­ä½¿ç”¨çº¯ç»„ä»¶ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›ç‰¹æ®Šçš„ä¸œè¥¿ï¼šçº¯ç»„ä»¶ç»å¸¸é‡æ–°æ¸²æŸ“ç›¸å½“å¤šï¼Œå³ä½¿çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼è¿™å¾ˆå¥½åœ°å°†å¼•å…¥äº† <code>useMemo</code> è§£å†³çš„ç¬¬äºŒä¸ªé—®é¢˜ã€‚</p><h2 id="3-ç¤ºä¾‹2ï¼šä¿ç•™å¼•ç”¨"><a href="#3-ç¤ºä¾‹2ï¼šä¿ç•™å¼•ç”¨" class="headerlink" title="3. ç¤ºä¾‹2ï¼šä¿ç•™å¼•ç”¨"></a>3. ç¤ºä¾‹2ï¼šä¿ç•™å¼•ç”¨</h2><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª <code>Boxes</code> ç»„ä»¶ã€‚å®ƒå±•ç¤ºäº†ä¸€ç»„å½©è‰²çš„ç›’å­ï¼Œç”¨äºæŸç§è£…é¥°ç›®çš„ã€‚æˆ‘è¿˜æœ‰ä¸€ä¸ªä¸ç›¸å…³çš„çŠ¶æ€ï¼šç”¨æˆ·åã€‚</p><ol><li><code>Boxes.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Boxes</span>(<span class="params">&#123; boxes &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"boxes-wrapper"</span>&gt;</span><br><span class="line">      &#123;boxes.map(<span class="function">(<span class="params">boxStyles, index</span>) =&gt;</span> (</span><br><span class="line">        &lt;div</span><br><span class="line">          key=&#123;index&#125;</span><br><span class="line">          className=<span class="string">"box"</span></span><br><span class="line">          style=&#123;boxStyles&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(Boxes);</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>App.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Boxes <span class="keyword">from</span> <span class="string">'./Boxes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = React.useState(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">const</span> [boxWidth, setBoxWidth] = React.useState(<span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> id = React.useId();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å°è¯•æ”¹å˜è¿™äº›å€¼</span></span><br><span class="line">  <span class="keyword">const</span> boxes = [</span><br><span class="line">    &#123; <span class="attr">flex</span>: boxWidth, <span class="attr">background</span>: <span class="string">'hsl(345deg 100% 50%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">3</span>, <span class="attr">background</span>: <span class="string">'hsl(260deg 100% 40%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">background</span>: <span class="string">'hsl(50deg 100% 60%)'</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Boxes boxes=&#123;boxes&#125; /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;section&gt;</span><br><span class="line">        &lt;label htmlFor=&#123;<span class="string">`<span class="subst">$&#123;id&#125;</span>-name`</span>&#125;&gt;</span><br><span class="line">          Name:</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          id=&#123;`$&#123;id&#125;-name`&#125;</span></span><br><span class="line"><span class="regexp">          type="text"</span></span><br><span class="line"><span class="regexp">          value=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">          onChange=&#123;(event) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setName(event.target.value);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &lt;label htmlFor=&#123;<span class="string">`<span class="subst">$&#123;id&#125;</span>-box-width`</span>&#125;&gt;</span><br><span class="line">          First box width:</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          id=&#123;`$&#123;id&#125;-box-width`&#125;</span></span><br><span class="line"><span class="regexp">          type="range"</span></span><br><span class="line"><span class="regexp">          min=&#123;1&#125;</span></span><br><span class="line"><span class="regexp">          max=&#123;5&#125;</span></span><br><span class="line"><span class="regexp">          step=&#123;0.01&#125;</span></span><br><span class="line"><span class="regexp">          value=&#123;boxWidth&#125;</span></span><br><span class="line"><span class="regexp">          onChange=&#123;(event) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setBoxWidth(Number(event.target.value));</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><p>ç”±äºåœ¨ <code>boxes.js</code> ä¸­ä½¿ç”¨äº†<code>React.memo()</code> å°è£…é»˜è®¤å¯¼å‡ºï¼Œ<code>Boxes</code> æ˜¯ä¸€ä¸ªçº¯ç»„ä»¶ã€‚è¿™æ„å‘³ç€å®ƒåº”è¯¥åªåœ¨å®ƒçš„<code>props</code>æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“ã€‚ç„¶è€Œï¼Œæ¯å½“ç”¨æˆ·æ›´æ”¹å…¶åç§°æ—¶ï¼Œ<code>Boxes</code> ä¹Ÿä¼šé‡æ–°å‘ˆç°ã€‚</p><p>ä¸ºä»€ä¹ˆçš„ <code>React.memo()</code> æ²¡æœ‰ä¿æŠ¤ï¼Ÿç›’å­ç»„ä»¶åªæœ‰1ä¸ª<code>prop</code>ï¼Œç›’å­ï¼Œå®ƒçœ‹èµ·æ¥å¥½åƒç»™å®ƒåœ¨æ¯æ¬¡æ¸²æŸ“å®Œå…¨ç›¸åŒçš„æ•°æ®ã€‚æ€»æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼šä¸€ä¸ªçº¢ç›’å­ï¼Œä¸€ä¸ªç´«è‰²çš„å®½ç›’å­ï¼Œä¸€ä¸ªé»„è‰²çš„ç›’å­ã€‚ç¡®å®æœ‰ä¸€ä¸ªå½±å“<code>boxes</code> æ•°ç»„çš„ <code>boxWidth</code> çŠ¶æ€å˜é‡ï¼Œä½†æ²¡æœ‰æ›´æ”¹å®ƒï¼</p><p>é—®é¢˜åœ¨äºï¼šæ¯æ¬¡ React é‡æ–°æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚å®ƒä»¬åœ¨å€¼ä¸Šæ˜¯ç›¸ç­‰çš„ï¼Œä½†åœ¨å‚ç…§ç‰©ä¸Šæ˜¯ä¸åŒçš„ã€‚æˆ‘æƒ³å¦‚æœå…ˆä¸è°ˆ Reactï¼Œåªè°ˆæ™®é€šçš„ JavaScriptï¼Œä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è®©æ¥çœ‹ä¸€ä¸ªç±»ä¼¼çš„æƒ…å†µï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNumbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> firstResult = getNumbers();</span><br><span class="line"><span class="keyword">const</span> secondResult = getNumbers();</span><br><span class="line"><span class="built_in">console</span>.log(firstResult === secondResult);</span><br></pre></td></tr></table></figure><p>ä½ æ€ä¹ˆçœ‹ï¼Ÿ<code>firstResult</code> æ˜¯å¦ç­‰äº <code>secondResult</code>ï¼Ÿä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œçš„ç¡®å¦‚æ­¤ã€‚ä¸¤ä¸ªå˜é‡éƒ½å…·æœ‰ç›¸åŒçš„ç»“æ„<code>[1,2,3]</code>ã€‚ä½†è¿™ä¸æ˜¯ <code>===</code> è¿ç®—ç¬¦å®é™…æ£€æŸ¥çš„å†…å®¹ã€‚ç›¸åï¼Œ<code>===</code> æ£€æŸ¥ä¸¤ä¸ªè¡¨è¾¾å¼æ˜¯å¦ç›¸åŒã€‚å·²ç»åˆ›å»ºäº†ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ã€‚å®ƒä»¬å¯èƒ½åŒ…å«ç›¸åŒçš„å†…å®¹ï¼Œä½†å®ƒä»¬ä¸æ˜¯åŒä¸€ä¸ªæ•°ç»„ã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>getNumbers</code> å‡½æ•°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ï¼Œå®ƒæ˜¯ä¿å­˜åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„ä¸€ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚å¦‚æœå¤šæ¬¡è°ƒç”¨å®ƒï¼Œå°†åœ¨å†…å­˜ä¸­å­˜å‚¨è¯¥æ•°ç»„çš„å¤šä¸ªå‰¯æœ¬ã€‚æ³¨æ„ï¼Œç®€å•çš„æ•°æ®ç±»å‹â€”â€”æ¯”å¦‚<strong>å­—ç¬¦ä¸²</strong>ã€<strong>æ•°å­—</strong>å’Œ<strong>å¸ƒå°”å€¼</strong>â€”â€”å¯ä»¥æŒ‰å€¼è¿›è¡Œæ¯”è¾ƒã€‚ä½†æ˜¯å½“æ¶‰åŠåˆ°<strong>æ•°ç»„</strong>å’Œ<strong>å¯¹è±¡</strong>æ—¶ï¼Œå®ƒä»¬åªèƒ½é€šè¿‡<strong>å¼•ç”¨</strong>è¿›è¡Œæ¯”è¾ƒã€‚</p><p>è®©å›åˆ° Reactï¼šçš„ <code>Boxes</code> Reactç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ã€‚å½“æ¸²æŸ“å®ƒæ—¶ï¼Œè°ƒç”¨é‚£ä¸ªå‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯æ¬¡æ¸²æŸ“è¿™ä¸ªç»„ä»¶æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°â€¦</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æœ€ååˆ›é€ äº†ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„</span></span><br><span class="line">  <span class="keyword">const</span> boxes = [</span><br><span class="line">    &#123; <span class="attr">flex</span>: boxWidth, <span class="attr">background</span>: <span class="string">'hsl(345deg 100% 50%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">3</span>, <span class="attr">background</span>: <span class="string">'hsl(260deg 100% 40%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">background</span>: <span class="string">'hsl(50deg 100% 60%)'</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// .ç„¶åå°†å…¶ä½œä¸º prop ä¼ é€’ç»™è¯¥ç»„ä»¶!</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Boxes boxes=&#123;boxes&#125; /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“åç§°çŠ¶æ€æ”¹å˜æ—¶ï¼Œçš„ <code>App</code> ç»„ä»¶å°†é‡æ–°å‘ˆç°ï¼Œè¿™å°†é‡æ–°è¿è¡Œæ‰€æœ‰çš„ä»£ç ã€‚æ„é€ ä¸€ä¸ªå…¨æ–°çš„ <code>boxes</code> æ•°ç»„ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™çš„ <code>Boxes</code> ç»„ä»¶ã€‚ä»è€Œå¯¼è‡´ç›’å­é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºç»™äº†å®ƒä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚ç›’å­æ•°ç»„çš„ç»“æ„åœ¨æ¸²æŸ“ä¹‹é—´æ²¡æœ‰æ”¹å˜ï¼Œä½†è¿™æ— å…³ç´§è¦ã€‚React æ‰€çŸ¥é“çš„æ˜¯ï¼Œç®±å­ <code>prop</code> å·²ç»æ”¶åˆ°äº†ä¸€ä¸ªæ–°åˆ›å»ºçš„ï¼Œä»æœªè§è¿‡çš„æ•°ç»„ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>useMemo</code> hookï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> boxes = React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    &#123; <span class="attr">flex</span>: boxWidth, <span class="attr">background</span>: <span class="string">'hsl(345deg 100% 50%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">3</span>, <span class="attr">background</span>: <span class="string">'hsl(260deg 100% 40%)'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">background</span>: <span class="string">'hsl(50deg 100% 60%)'</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;, [boxWidth]);</span><br></pre></td></tr></table></figure><p>ä¸ä¹‹å‰çœ‹åˆ°çš„è´¨æ•°ä¾‹å­ä¸åŒï¼Œè¿™é‡Œä¸æ‹…å¿ƒè®¡ç®—æˆæœ¬å¾ˆé«˜çš„è®¡ç®—ã€‚çš„å”¯ä¸€ç›®æ ‡æ˜¯<strong>ä¿ç•™å¯¹ç‰¹å®šæ•°ç»„çš„å¼•ç”¨</strong>ã€‚å°† <code>boxWidth</code> åˆ—ä¸ºä¸€ä¸ªä¾èµ–é¡¹ï¼Œå› ä¸ºç¡®å®å¸Œæœ›åœ¨ç”¨æˆ·è°ƒæ•´çº¢è‰²æ¡†çš„å®½åº¦æ—¶é‡æ–°å‘ˆç° <code>Boxes</code> ç»„ä»¶ã€‚ç„¶è€Œï¼Œåœ¨ <code>useMemo</code> ä¸­ï¼Œé‡ç”¨äº†ä¹‹å‰åˆ›å»ºçš„ <code>boxes</code> æ•°ç»„ã€‚</p><p>é€šè¿‡åœ¨å¤šä¸ªæ¸²æŸ“ä¸­ä¿ç•™ç›¸åŒçš„å¼•ç”¨ï¼Œå…è®¸çº¯ç»„ä»¶æŒ‰å¸Œæœ›çš„æ–¹å¼å·¥ä½œï¼Œå¿½ç•¥ä¸å½±å“ UI çš„æ¸²æŸ“ã€‚</p><h2 id="4-useCallback"><a href="#4-useCallback" class="headerlink" title="4. useCallback"></a>4. useCallback</h2><p>å‰é¢äº†è§£äº† <code>useMemo</code>ã€‚é‚£ <code>useCallback</code> å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç‰ˆæœ¬ï¼š<strong>è¿™æ˜¯å®Œå…¨ç›¸åŒçš„äº‹æƒ…ï¼Œä½†ç”¨äºå‡½æ•°è€Œä¸æ˜¯æ•°ç»„/å¯¹è±¡</strong>ã€‚ä¸æ•°ç»„å’Œå¯¹è±¡ç±»ä¼¼ï¼Œå‡½æ•°æ˜¯æ ¹æ®å¼•ç”¨æ¯”è¾ƒçš„ï¼Œè€Œä¸æ˜¯æ ¹æ®å€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> functionOne = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> functionTwo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(functionOne === functionTwo); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡æ–°ç”Ÿæˆï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ªç›¸åŒä½†å”¯ä¸€çš„å‡½æ•°ã€‚è®©çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><ol><li><code>MegaBoost.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MegaBoost</span>(<span class="params">&#123; handleClick &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Render MegaBoost'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button</span><br><span class="line">      className=<span class="string">"mega-boost-button"</span></span><br><span class="line">      onClick=&#123;handleClick&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      MEGA BOOST!</span><br><span class="line">    &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(MegaBoost);</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>App.js</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MegaBoost <span class="keyword">from</span> <span class="string">'./MegaBoost'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleMegaBoost</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setCount(<span class="function">(<span class="params">currentValue</span>) =&gt;</span> currentValue + <span class="number">1234</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;count&#125;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>)</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        Click me!</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;MegaBoost handleClick=&#123;handleMegaBoost&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ —å­æè¿°äº†ä¸€ä¸ªå…¸å‹çš„è®¡æ•°å™¨åº”ç”¨ç¨‹åºï¼Œä½†æœ‰ä¸€ä¸ªç‰¹æ®Šçš„â€œMega Boostâ€æŒ‰é’®ã€‚è¿™ä¸ªæŒ‰é’®å¤§å¤§å¢åŠ äº†è®¡æ•°ï¼Œä»¥é˜²ä½ å¾ˆåŒ†å¿™ï¼Œä¸æƒ³å¤šæ¬¡ç‚¹å‡»æ ‡å‡†æŒ‰é’®ã€‚</p><p>å¤šäºäº† <code>React.memo</code>, <code>MegaBoost</code> ç»„ä»¶æ˜¯ä¸€ä¸ªçº¯ç»„ä»¶ã€‚å®ƒä¸ä¾èµ–äºè®¡æ•°ï¼Œä½†æ¯å½“è®¡æ•°æ”¹å˜æ—¶å®ƒå°±ä¼šé‡æ–°å‘ˆç°ï¼å°±åƒçœ‹åˆ°çš„ç›’å­æ•°ç»„ï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯åœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„å‡½æ•°ã€‚å¦‚æœæ¸²æŸ“ 3 æ¬¡ï¼Œå°†åˆ›å»º 3 ä¸ªå•ç‹¬çš„ <code>handleMegaBoost</code> å‡½æ•°ï¼Œçªç ´ <code>React.memo</code>çš„ä¿æŠ¤ã€‚åˆ©ç”¨å¯¹ <code>useMemo</code> çš„äº†è§£ï¼Œå¯ä»¥åƒè¿™æ ·è§£å†³é—®é¢˜ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleMegaBoost = React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setCount(<span class="function">(<span class="params">currentValue</span>) =&gt;</span> currentValue + <span class="number">1234</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ç„¶åå°†æ­¤å‡½æ•°å­˜å‚¨åœ¨ <code>handleMegaBoost</code> å˜é‡ä¸­ã€‚è¿™å¾ˆæœ‰æ•ˆï¼Œä½†è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleMegaBoost = React.useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  setCount(<span class="function">(<span class="params">currentValue</span>) =&gt;</span> currentValue + <span class="number">1234</span>);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><code>useCallback</code> çš„ä½œç”¨ä¸ <code>useMemo</code> ç›¸åŒï¼Œä½†å®ƒæ˜¯ä¸“é—¨ä¸ºå‡½æ•°æ„å»ºçš„ã€‚ç›´æ¥ç»™å®ƒä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè®°ä½é‚£ä¸ªå‡½æ•°ï¼Œåœ¨æ¸²æŸ“ä¹‹é—´è¿›è¡Œçº¿ç¨‹å¤„ç†ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸¤ä¸ªè¡¨è¾¾æœ‰ç›¸åŒçš„æ•ˆæœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">React.useCallback(<span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span>(<span class="params"></span>)</span>&#123;&#125;, []);</span><br><span class="line"><span class="comment">// åœ¨åŠŸèƒ½ä¸Šç­‰ä»·äº</span></span><br><span class="line">React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span>(<span class="params"></span>)</span>&#123;&#125;, []);</span><br></pre></td></tr></table></figure><p><code>useCallback</code> æ˜¯è¯­æ³•ç³–ã€‚å®ƒçš„å­˜åœ¨çº¯ç²¹æ˜¯ä¸ºäº†è®©åœ¨è®°å¿†å›è°ƒå‡½æ•°æ—¶æ›´åŠ æ–¹ä¾¿ã€‚</p><h2 id="5-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº›-hook"><a href="#5-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº›-hook" class="headerlink" title="5. ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº› hook"></a>5. ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº› hook</h2><p>å¥½äº†ï¼Œå·²ç»çœ‹åˆ°äº† <code>useMemo</code> å’Œ <code>useCallback</code> å¦‚ä½•å…è®¸è·¨å¤šä¸ªæ¸²æŸ“çº¿ç¨‹å¼•ç”¨é‡ç”¨å¤æ‚çš„è®¡ç®—æˆ–é¿å…ç ´åçº¯ç»„ä»¶ã€‚é—®é¢˜æ˜¯ï¼šåº”è¯¥å¤šç»å¸¸ä½¿ç”¨å®ƒï¼Ÿ</p><p>åœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼Œå°†æ¯ä¸ªå¯¹è±¡/æ•°ç»„/å‡½æ•°åŒ…è£…åœ¨è¿™äº›é’©å­ä¸­æ˜¯æµªè´¹æ—¶é—´ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¥½å¤„æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ï¼›React æ˜¯é«˜åº¦ä¼˜åŒ–çš„ï¼Œé‡æ–°æ¸²æŸ“é€šå¸¸ä¸åƒé€šå¸¸è®¤ä¸ºçš„é‚£æ ·ç¼“æ…¢æˆ–æ˜‚è´µï¼</p><p>ä½¿ç”¨è¿™äº›é’©å­çš„æœ€ä½³æ–¹å¼æ˜¯å“åº”é—®é¢˜ã€‚å¦‚æœä½ æ³¨æ„åˆ°ä½ çš„åº”ç”¨ç¨‹åºå˜å¾—æœ‰ç‚¹è¿Ÿç¼“ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>React Profiler</code> æ¥æŸ¥æ‰¾ç¼“æ…¢çš„æ¸²æŸ“ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡é‡æ„åº”ç”¨ç¨‹åºæ¥æé«˜æ€§èƒ½ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œ<code>useMemo</code> å’Œ<code>useCallback</code> å¯ä»¥å¸®åŠ©åŠ å¿«é€Ÿåº¦ã€‚</p><h3 id="5-1-ç”¨äºè‡ªå®šä¹‰-hook-å†…éƒ¨"><a href="#5-1-ç”¨äºè‡ªå®šä¹‰-hook-å†…éƒ¨" class="headerlink" title="5.1 ç”¨äºè‡ªå®šä¹‰ hook å†…éƒ¨"></a>5.1 ç”¨äºè‡ªå®šä¹‰ hook å†…éƒ¨</h3><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªè‡ªå®šä¹‰ hook <code>useToggle</code>ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å‡ ä¹å’Œ <code>useState</code> å®Œå…¨ä¸€æ ·ï¼Œä½†åªèƒ½åœ¨ <code>true</code> å’Œ <code>false</code> ä¹‹é—´åˆ‡æ¢çŠ¶æ€å˜é‡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [isDarkMode, toggleDarkMode] = useToggle(<span class="literal">false</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button onClick=&#123;toggleDarkMode&#125;&gt;</span><br><span class="line">      Toggle color theme</span><br><span class="line">    &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å¦‚ä½•å®šä¹‰è¿™ä¸ªè‡ªå®šä¹‰ hook çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useToggle</span>(<span class="params">initialValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = React.useState(initialValue);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> toggle = React.useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setValue(<span class="function"><span class="params">v</span> =&gt;</span> !v);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> [value, toggle];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>toggle</code> å‡½æ•°æ˜¯ç”¨ <code>useCallback</code> è®°å¿†çš„ã€‚å½“æˆ‘æ„å»ºè¿™æ ·çš„è‡ªå®šä¹‰å¯é‡ç”¨é’©å­æ—¶ï¼Œæˆ‘å¸Œæœ›ä½¿å®ƒä»¬å°½å¯èƒ½é«˜æ•ˆï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“å°†æ¥ä¼šåœ¨å“ªé‡Œä½¿ç”¨å®ƒä»¬ã€‚åœ¨95%çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ˜¯å¤šä½™çš„ï¼Œä½†å¦‚æœæˆ‘ä½¿ç”¨è¿™ä¸ªé’©å­30æˆ–40æ¬¡ï¼Œè¿™å¾ˆæœ‰å¯èƒ½æœ‰åŠ©äºæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><h3 id="5-2-åœ¨-context-æä¾›è€…"><a href="#5-2-åœ¨-context-æä¾›è€…" class="headerlink" title="5.2 åœ¨ context æä¾›è€…"></a>5.2 åœ¨ context æä¾›è€…</h3><p>å½“åœ¨å…·æœ‰ <code>context</code> çš„åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®æ—¶ï¼Œé€šå¸¸ä¼šä¼ é€’ä¸€ä¸ªå¤§å¯¹è±¡ä½œä¸º <code>value</code> å±æ€§ã€‚è®°ä½è¿™ä¸ªå¯¹è±¡é€šå¸¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AuthContext = React.createContext(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AuthProvider</span>(<span class="params">&#123; user, status, forgotPwLink, children &#125;</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> memoizedValue = React.useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user,</span><br><span class="line">      status,</span><br><span class="line">      forgotPwLink,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [user, status, forgotPwLink]);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;AuthContext.Provider value=&#123;memoizedValue&#125;&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/AuthContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¿™æ˜¯æœ‰ç›Šçš„ï¼Ÿå¯èƒ½æœ‰å‡ åä¸ªçº¯ç»„ä»¶ä½¿ç”¨è¿™ä¸ªä¸Šä¸‹æ–‡ã€‚å¦‚æœæ²¡æœ‰ <code>useMemo</code>ï¼Œå¦‚æœ <code>AuthProvider</code> çš„çˆ¶ç»„ä»¶ç¢°å·§é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆæ‰€æœ‰è¿™äº›ç»„ä»¶éƒ½å°†è¢«è¿«é‡æ–°æ¸²æŸ“ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä» &lt;code&gt;useMemo&lt;/code&gt; å¼€å§‹ã€‚&lt;code&gt;useMemo&lt;/code&gt; çš„åŸºæœ¬æ€æƒ³æ˜¯å®ƒå…è®¸åœ¨æ¸²æŸ“ä¹‹é—´â€œè®°ä½â€è®¡ç®—å€¼ã€‚è¿™ä¸ªå®šä¹‰éœ€è¦ä¸€äº›è§£é‡Šï¼Œå…ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;React åšçš„ä¸»è¦äº‹æƒ…æ˜¯ä¿æŒUIä¸åº”ç”¨ç¨‹åºçŠ¶æ€åŒæ­¥ã€‚å®ƒç”¨æ¥åšè¿™ä»¶äº‹çš„å·¥å…·å«åšâ€œ
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Vueçš„å“åº”å¼åŸç†</title>
    <link href="https://summxu.github.io/2021/Vue%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
    <id>https://summxu.github.io/2021/Vueçš„å“åº”å¼åŸç†/</id>
    <published>2021-05-07T01:07:32.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vue2ä½¿ç”¨Object-definePropertyå®ç°å“åº”å¼"><a href="#vue2ä½¿ç”¨Object-definePropertyå®ç°å“åº”å¼" class="headerlink" title="vue2ä½¿ç”¨Object.definePropertyå®ç°å“åº”å¼"></a>vue2ä½¿ç”¨Object.definePropertyå®ç°å“åº”å¼</h2><ul><li>éå†å±æ€§ï¼Œå¯¹æ¯ä¸€ä¸ªå±æ€§çš„å€¼ç”¨Object.definePropertyè¿›è¡Œgetterå’Œsetterçš„æ”¹é€ ï¼›</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">data, key</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'get data:'</span>, key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// set</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">data, key, value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'set data:'</span>, key,<span class="string">'-'</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!data || <span class="keyword">typeof</span> data !== <span class="string">'object'</span>) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> data)&#123;</span><br><span class="line">    <span class="keyword">let</span> value = data[key]</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(data, key, &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>()&#123;</span><br><span class="line">        track(data, key)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(newVal)&#123;</span><br><span class="line">        trigger(data, key, newVal)</span><br><span class="line">        value = newVal</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> value === <span class="string">'object'</span>)&#123;</span><br><span class="line">      observe(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'win'</span>,</span><br><span class="line">  family: [<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">observe(obj)</span><br><span class="line"></span><br><span class="line">obj.name = <span class="string">'ten'</span></span><br><span class="line">obj.family[<span class="number">3</span>] = <span class="number">6</span> <span class="comment">//ä¸æ˜¯å“åº”å¼ï¼Œæ²¡æœ‰è¢«Object.definePropertyåŒ…è£…ä¸€ä¸‹</span></span><br><span class="line">obj.age = <span class="number">18</span> <span class="comment">//ä¸æ˜¯å“åº”å¼ï¼Œæ²¡æœ‰è¢«Object.definePropertyåŒ…è£…ä¸€ä¸‹</span></span><br><span class="line"><span class="built_in">console</span>.log(obj, <span class="string">'obj'</span>)</span><br></pre></td></tr></table></figure><p>Vue3ç›¸å¯¹äºVue2å“åº”å¼åŸç†ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œç”±åŸå…ˆçš„ <code>Object.defineproperty</code> æ”¹æˆäº†ä½¿ç”¨ <code>Proxy</code> æ›¿ä»£ã€‚<code>Proxy</code> ç›¸å¯¹äº <code>Object.defineproperty</code> æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŒ–ç‚¹ï¼š</p><ul><li>å¯¹è±¡æ–°å¢å±æ€§ä¸å†éœ€è¦æ‰‹åŠ¨ <code>$set</code> æ·»åŠ å“åº”å¼ï¼Œ<code>Proxy</code> é»˜è®¤ä¼šç›‘å¬åŠ¨æ€æ·»åŠ å±æ€§å’Œå±æ€§çš„åˆ é™¤ç­‰æ“ä½œã€‚</li><li>æ¶ˆé™¤æ— æ³•ç›‘å¬æ•°ç»„ç´¢å¼•ï¼Œlength å±æ€§ç­‰ç­‰ï¼Œä¸å†éœ€è¦åœ¨æ•°ç»„åŸå‹å¯¹è±¡ä¸Šé‡å†™æ•°ç»„çš„æ–¹æ³•ã€‚</li><li><code>Object.defineproperty</code> æ˜¯åŠ«æŒæ‰€æœ‰å¯¹è±¡å±æ€§çš„ <code>get</code>/<code>set</code> æ–¹æ³•,éœ€è¦éå†é€’å½’å»å®ç°ï¼Œ<code>Proxy</code> æ˜¯ä»£ç†æ•´ä¸ªå¯¹è±¡ã€‚</li><li>Vue2 åªèƒ½æ‹¦æˆªå¯¹è±¡å±æ€§çš„ <code>get</code> å’Œ <code>set</code> æ“ä½œ,è€Œ <code>Proxy</code> æ‹¥æœ‰ <code>13</code> ç§æ‹¦æˆªæ–¹æ³•ã€‚</li></ul><h2 id="Vue3ä¸­çš„å“åº”å¼åŸç†"><a href="#Vue3ä¸­çš„å“åº”å¼åŸç†" class="headerlink" title="Vue3ä¸­çš„å“åº”å¼åŸç†"></a>Vue3ä¸­çš„å“åº”å¼åŸç†</h2><p>å®ç°åŸç†ï¼š</p><p>é€šè¿‡Proxyï¼ˆä»£ç†ï¼‰ï¼š æ‹¦æˆªå¯¹è±¡ä¸­ä»»æ„å±æ€§çš„å˜åŒ–ï¼ŒåŒ…æ‹¬ï¼šå±æ€§å€¼çš„è¯»å†™ï¼Œå±æ€§çš„å¢åŠ ï¼Œå±æ€§çš„åˆ é™¤ç­‰ã€‚</p><p>é€šè¿‡Reffectï¼ˆåå°„ï¼‰ï¼š å¯¹æºå¯¹è±¡çš„å±æ€§è¿›è¡Œæ“ä½œ</p><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><ul><li>Proxyå¯¹è±¡å¯¹äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆåœ¨å¯¹è±¡å‰é¢è®¾äº†ä¸€å±‚æ‹¦æˆªï¼Œ<strong>å¯ä»¥å®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œä¸€äº›è‡ªå®šä¹‰æ“ä½œï¼ˆæ¯”å¦‚ä¸€äº›èµ‹å€¼ã€å±æ€§æŸ¥æ‰¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ï¼›</strong></li><li>ç”¨æ³•ï¼š<code>var proxy = new Proxy(target, handler);</code><br><strong>targetï¼š</strong>ç›®æ ‡å‡½æ•°ï¼ˆå³è¿›è¡Œæ”¹é€ çš„å‡½æ•°ï¼‰ï¼›<br><strong>handlerï¼š</strong>ä¸€äº›è‡ªå®šä¹‰æ“ä½œï¼ˆæ¯”å¦‚vueä¸­getterå’Œsetterçš„æ“ä½œï¼‰ï¼›</li></ul><h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><ul><li>Reflectæ˜¯es6ä¸ºæ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–°APIï¼Œè®¾è®¡å®ƒçš„ç›®çš„æœ‰ï¼š<br>â‘  æŠŠObjectå¯¹è±¡ä¸Šä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•æ”¾åˆ°Reflectå¯¹è±¡èº«ä¸Šï¼Œæ¯”å¦‚Object.definePropertyï¼›<br>â‘¡ ä¿®æ”¹äº†æŸäº›objectæ–¹æ³•è¿”å›çš„ç»“æœï¼›<br>â‘¢ è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºï¼›<br>â‘£ Reflectå¯¹è±¡ä¸Šçš„æ–¹æ³•å’ŒProxyå¯¹è±¡ä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·å°±å¯ä»¥è®©Proxyå¯¹è±¡æ–¹ä¾¿åœ°è°ƒç”¨å¯¹åº”çš„Reflectæ–¹æ³•ï¼›</li><li><code>Reflect.get(target, propertyKey, receiver)</code>ï¼š<strong>ç­‰ä»·äº<code>target[propertyKey]</code>ï¼Œ</strong>Reflect.getæ–¹æ³•æŸ¥æ‰¾å¹¶è¿”å›targetå¯¹è±¡çš„propertyKeyå±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™è¿”å›undefinedã€‚</li><li><code>Reflect.set(target, propertyKey, value, receiver)</code>ï¼š<strong>ç­‰ä»·äº<code>target[propertyKey] = value</code>ï¼Œ</strong>Reflect.setæ–¹æ³•è®¾ç½®targetå¯¹è±¡çš„propertyKeyå±æ€§ç­‰äºvalueã€‚</li></ul><h3 id="Proxyå’ŒReflectçš„ä½¿ç”¨"><a href="#Proxyå’ŒReflectçš„ä½¿ç”¨" class="headerlink" title="Proxyå’ŒReflectçš„ä½¿ç”¨"></a>Proxyå’ŒReflectçš„ä½¿ç”¨</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'win'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params">target, key</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'get--'</span>, key)</span><br><span class="line">    <span class="keyword">return</span> Reflect.get(...arguments)  </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">target, key, value</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'set--'</span>, key, <span class="string">'='</span>, value)</span><br><span class="line">    <span class="keyword">return</span> Reflect.set(...arguments)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">new</span> Proxy(obj, handler)</span><br><span class="line">data.name = <span class="string">'ten'</span></span><br><span class="line"><span class="built_in">console</span>.log(data.name,<span class="string">'data.name22'</span>)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Proxyå’ŒReflectå®Œæˆå“åº”å¼"><a href="#ä½¿ç”¨Proxyå’ŒReflectå®Œæˆå“åº”å¼" class="headerlink" title="ä½¿ç”¨Proxyå’ŒReflectå®Œæˆå“åº”å¼"></a>ä½¿ç”¨Proxyå’ŒReflectå®Œæˆå“åº”å¼</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'get--'</span>, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key, value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'set--'</span>, key, <span class="string">'='</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="keyword">get</span>(target, key, receiver)&#123;</span><br><span class="line">      track(target, key)</span><br><span class="line">      <span class="keyword">const</span> value = Reflect.get(...arguments)</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> value === <span class="string">'object'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> reactive(value)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>(target, key, val, receiver)&#123;</span><br><span class="line">      trigger(target, key, val)</span><br><span class="line">      <span class="keyword">return</span> Reflect.set(...arguments)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Proxy(obj, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'win'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = reactive(obj)</span><br><span class="line"></span><br><span class="line">data.list = [<span class="number">5</span>] <span class="comment">//å“åº”å¼  è¿™ä¸¤å¥è¯æ˜¯æ‰§è¡ŒReflect.set()</span></span><br><span class="line">data.age = <span class="number">18</span> <span class="comment">//å“åº”å¼</span></span><br><span class="line"><span class="built_in">console</span>.log(data, <span class="string">'data111'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vue2ä½¿ç”¨Object-definePropertyå®ç°å“åº”å¼&quot;&gt;&lt;a href=&quot;#vue2ä½¿ç”¨Object-definePropertyå®ç°å“åº”å¼&quot; class=&quot;headerlink&quot; title=&quot;vue2ä½¿ç”¨Object.definePropertyå®
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ReactNativeè¸©å‘è®°</title>
    <link href="https://summxu.github.io/2020/ReactNative%E8%B8%A9%E5%9D%91%E8%AE%B0/"/>
    <id>https://summxu.github.io/2020/ReactNativeè¸©å‘è®°/</id>
    <published>2020-07-21T04:16:24.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘-è¿™é‡Œè®°å½•ä¸€ä¸‹"><a href="#æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘-è¿™é‡Œè®°å½•ä¸€ä¸‹" class="headerlink" title="æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘,è¿™é‡Œè®°å½•ä¸€ä¸‹"></a>æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘,è¿™é‡Œè®°å½•ä¸€ä¸‹</h2><h2 id="æ ·å¼"><a href="#æ ·å¼" class="headerlink" title="æ ·å¼"></a>æ ·å¼</h2><p>react-native è™½ç„¶æ”¯æŒflexå¸ƒå±€ï¼Œä½†æ˜¯æ‰€æœ‰çš„æ ·å¼å‡æ˜¯cssæ ·å¼çš„ä¸€ä¸ªå¾ˆå°çš„é›†åˆï¼Œå°¤å…¶æ˜¯åœ¨å®‰å“æœºä¸‹é—®é¢˜å°¤ä¸ºå‡¸æ˜¾ï¼š</p><ol><li><p>Viewå†…éƒ¨çš„å…ƒç´ åƒä¸‡ä¸è¦è¶…å‡ºçˆ¶çº§çš„èŒƒå›´ï¼Œisoä¸Šé—®é¢˜å€’æ˜¯ä¸å¤§ï¼Œå®‰å“ä¸Šå°±ä»€ä¹ˆè¶…å‡ºçš„éƒ½çœ‹ä¸åˆ°äº†</p></li><li><p>lineHeight å¯ä»¥ç”¨ï¼Œä¸è¿‡åƒä¸‡ä¸è¦å†™æˆå°æ•°ï¼Œå¦åˆ™å®‰å“ä¸Šä¼šç›´æ¥å´©æºƒ</p></li><li><p>rnçš„æ ·å¼ä¸å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å†™styleï¼ŒçœŸçš„æ˜¯ä½“åŠ›æ´»</p></li><li><p>å¦‚æœTextçš„çˆ¶çº§å…ƒç´ è®¾ç½®äº†èƒŒæ™¯é¢œè‰²ï¼Œé‚£ä¹ˆiosä¸‹Textçš„èƒŒæ™¯é¢œè‰²ä¹Ÿæ˜¯çˆ¶çº§çš„èƒŒæ™¯é¢œè‰²ï¼Œè¦ä¹ˆè‡ªå·±å†™ä¸ªTexté‡ç½®ä¸‹æ ·å¼ï¼Œè¦ä¹ˆå°±é‡åˆ°äº†å†æ”¹</p></li><li><p>react-nativeçš„å­—å·æ˜¯æ²¡æœ‰è®¾ç½®å•ä½çš„ï¼Œæ‰€ä»¥ä¼šéšç€ç³»ç»Ÿè®¾ç½®çš„å­—ä½“å¤§å°è€Œå˜åŒ–ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™æ˜¯ä¸æ˜¯å‘ï¼Œä¸è¿‡è²Œä¼¼æœ‰çš„appä¹Ÿæ²¡æœ‰ç®¡è¿™ä¸ªï¼Œå¦‚æœç¡¬è¦å»è®¾ç½®Textçš„æ–‡å­—ä¸éšç³»ç»Ÿæ”¹å˜ï¼Œå®‰å“æ˜¯å¯ä»¥ç»Ÿä¸€è®¾ç½®çš„ï¼Œiosä¸ŠTextè®¾ç½®allowFontScaling ={false}å°±å¯ä»¥è§£å†³</p></li></ol><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p>react-native åœ¨å‘ç”Ÿjså¼‚å¸¸çš„æ—¶å€™ï¼Œdebugçš„æ—¶å€™ä¼šç›´æ¥çº¢å±å¹•ï¼Œä½†æ˜¯å†releaseçš„æ—¶å€™ç›´æ¥ä¼šå´©æºƒé€€å‡ºï¼Œè§£å†³åŠæ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ErrorUtils <span class="keyword">from</span> <span class="string">"ErrorUtils"</span> &lt;br&gt;<span class="comment">//è¿™é‡Œåº”è¯¥åšä¸ªåˆ¤æ–­ï¼Œå¦‚æœä¸æ˜¯debugçš„æ‰åšè¿™æ ·çš„å¼‚å¸¸å…¨å±€å¤„ç†</span></span><br><span class="line">ErrorUtils.setGlobalHandler(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;&lt;br&gt;ã€€ã€€<span class="comment">//å‘ç”Ÿå¼‚å¸¸çš„å¤„ç†æ–¹æ³•,å½“ç„¶å¦‚æœæ˜¯æ‰“åŒ…å¥½çš„è¯å¯èƒ½ä½ æ‰¾éƒ½æ‰¾ä¸åˆ°æ˜¯å“ªæ®µä»£ç å‡ºé—®é¢˜äº†</span></span><br><span class="line">ã€€ã€€Alert.alert(<span class="string">"å¼‚å¸¸"</span>,<span class="built_in">JSON</span>.stringify(e))</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><p>react-nativeè™½ç„¶è‡ªå¸¦æœ‰fetchï¼Œä¸è¿‡åœ¨ä½¿ç”¨çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœéœ€è¦è·å–httpçš„headerå¤´çš„æ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œå¯èƒ½å¾—åˆ°çš„æ˜¯ä¸€äº›åƒå¥‡ç™¾æ€ªçš„æ ·å¼ï¼Œè¿™å¹¶ä¸æ˜¯react-nativeçš„é”™ï¼Œè€Œæ˜¯ç¬¬ä¸‰æ–¹çš„ whatwg-fetch ç•™ä¸‹çš„å‘ï¼Œå½“ç„¶ä¹Ÿæœ‰äººå†githubä¸Šè·Ÿreact-nativeåæ˜ è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡å¾—åˆ°çš„è§£å†³æ–¹æ¡ˆéƒ½å¾ˆå‘ï¼Œå”¯æœ‰ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯æ‹·è´è‡ªå·±ä¿®æ”¹ï¼Œä¿®æ”¹å¦‚ä¸‹:</p><ol><li><p>æ³¨é‡Šè¯¥æ³¨é‡Šçš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">self</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">ã€€ã€€ <span class="comment">//æ³¨é‡Šè¿™é‡Œï¼Œä¸ç„¶æ€»æ˜¯ç”¨çš„æ˜¯å…¨å±€çš„fetch</span></span><br><span class="line">    <span class="comment">// if (self.fetch) &#123;</span></span><br><span class="line">    <span class="comment">//     return</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹è¯¥ä¿®æ”¹çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseHeaders</span>(<span class="params">rawHeaders</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> headers = <span class="keyword">new</span> Headers()&lt;br&gt;ã€€ã€€ã€€ã€€ã€€<span class="comment">//æŠŠ\t\næ”¹æˆ\tï¼Œå› ä¸ºä¸€èˆ¬headeréƒ½æ˜¯ç”¨\næ¥åˆ†å‰²çš„</span></span><br><span class="line">    rawHeaders.split(<span class="string">'\n'</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">line</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//rawHeaders.split('\t\n').forEach(function(line) &#123;</span></span><br><span class="line">            <span class="keyword">var</span> parts = line.split(<span class="string">':'</span>)</span><br><span class="line">            <span class="keyword">var</span> key = parts.shift().trim()</span><br><span class="line">            <span class="keyword">if</span> (key) &#123;</span><br><span class="line">                <span class="keyword">var</span> value = parts.join(<span class="string">':'</span>).trim()</span><br><span class="line">                headers.append(key, value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> headers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥importä½ æ”¹å¥½çš„æ–‡ä»¶ï¼Œfetchå°±å¯ä»¥ç”¨äº†</p></li></ol><h2 id="Modal"><a href="#Modal" class="headerlink" title="Modal"></a>Modal</h2><p>Modeæ§ä»¶åœ¨ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„äº†ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯rnæä¾›çš„ï¼Œå¹¶ä¸”ä¹Ÿå†™çš„å¾ˆæ¸…æ¥šæ˜¯æœ€é«˜å±‚çº§çš„ä¸€ä¸ªå¼¹å‡ºå±‚ï¼Œæ‰€ä»¥ä½ æƒ³è¦åˆæ‰“å¼€Modelåˆè¦è·³è½¬åŸºæœ¬æ˜¯æ— æœ›çš„äº†ï¼Œæ‰€ä»¥å»ºè®®ä¸è¦ä½¿ç”¨è¿™ä¸ªï¼Œæœ€å¥½æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ§ä»¶ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ react-native-modalbox + é«˜é˜¶æ§ä»¶ å®ç°çš„å…¨é®ç›–çš„å¼¹å‡ºå±‚</p><h2 id="ç‚¹å‡»å±å¹•å…¶ä»–ä½ç½®å…³é—­çš„èœå•"><a href="#ç‚¹å‡»å±å¹•å…¶ä»–ä½ç½®å…³é—­çš„èœå•" class="headerlink" title="ç‚¹å‡»å±å¹•å…¶ä»–ä½ç½®å…³é—­çš„èœå•"></a>ç‚¹å‡»å±å¹•å…¶ä»–ä½ç½®å…³é—­çš„èœå•</h2><p>è¿™ç±»èœå•æœ‰ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯ç‚¹å‡»å±å¹•å…¶ä»–åœ°æ–¹ç„¶åèœå•å°±å…³é—­ï¼Œæˆ‘ä»¬çš„è§£å†³åŠæ³•å°±æ˜¯ç”¨è‡ªå·±å†™çš„ react-native-modalbox + é«˜é˜¶æ§ä»¶ ä¹Ÿå°±æ˜¯è¯´æ”¾åœ¨ä¸€ä¸ªå¼¹å‡ºå±‚é‡Œé¢ï¼Œå½“ç„¶å¯ä»¥è¯•è¯•æŠŠå½“å‰é¡µé¢å¥—è¿›ä¸€ä¸ªå¤§çš„ TouchableWithoutFeedback é‡Œé¢</p><h2 id="æ¥å£è¯·æ±‚"><a href="#æ¥å£è¯·æ±‚" class="headerlink" title="æ¥å£è¯·æ±‚"></a>æ¥å£è¯·æ±‚</h2><p>éç‰¹æ®Šæƒ…å†µä¸‹éƒ½åº”è¯¥è¿™æ ·åš</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;InteractionManager&#125; <span class="keyword">from</span> <span class="string">"react-native"</span></span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">  InteractionManager.runAfterInteractions(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fetch(<span class="string">"xxx.xxx.xxx"</span>,&#123;&#125;)</span><br><span class="line">    &#125;);     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é”®ç›˜"><a href="#é”®ç›˜" class="headerlink" title="é”®ç›˜"></a>é”®ç›˜</h2><p>å®˜æ–¹æä¾›çš„è‡ªå®šä¹‰éšè—é”®ç›˜çš„æ–¹æ³•æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Keyboard &#125; <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line">Keyboard.dismiss()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åå‘ç°æ ¹æœ¬ä¸èƒ½ï¼Œè€Œä¸”è¿˜æŠ¥é”™ï¼Œæ¥¼ä¸»çš„react-nativeç‰ˆæœ¬æ˜¯0.35.0</p><p>çœ‹äº†å®˜æ–¹çš„issueæ‰çŸ¥é“è¿™ä¸ªä¸è¡Œï¼Œæ¨èä¸‹é¢æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dismissKeyboard <span class="keyword">from</span> <span class="string">'dismissKeyboard'</span>dismissKeyboard()</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥éšè—äº†ï¼Œå¤ªå‘äº†</p><p>è¿˜æœ‰ä¸ªå¾ˆå‘çš„åœ°æ–¹ï¼Œå®˜æ–¹æä¾›çš„ç§»é™¤é”®ç›˜äº‹ä»¶çš„æ–¹æ³•ä¸å¯ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount () &#123;ã€€ã€€Keyboard.addListener(<span class="string">'keyboardDidShow'</span>, <span class="keyword">this</span>.keyboardDidShow.bind(<span class="keyword">this</span>))ã€€ã€€Keyboard.addListener(<span class="string">'keyboardDidHide'</span>, <span class="keyword">this</span>.keyboardDidHide.bind(<span class="keyword">this</span>))&#125;componentWillUnmount () &#123;</span><br><span class="line">    Keyboard.removeAllListeners(<span class="string">'keyboardDidShow'</span>)</span><br><span class="line">    Keyboard.removeAllListeners(<span class="string">'keyboardDidHide'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ–¹å¼ç‰¹ä¹ˆçš„å¦‚æœæ“ä½œå¿«äº†ï¼Œæˆ–è€…æœ‰æ—¶å€™è«åå…¶å¦™çš„å°±ä¼šå‡ºé”™,ä¸‹é¢çš„æ‰æ˜¯æ­£ç¡®çš„æ‰“å¼€æ–¹å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount () &#123;</span><br><span class="line">ã€€ã€€<span class="keyword">this</span>.keyboardDidShowListener = Keyboard.addListener(<span class="string">'keyboardDidShow'</span>, <span class="keyword">this</span>.keyboardDidShow.bind(<span class="keyword">this</span>))</span><br><span class="line">ã€€ã€€<span class="keyword">this</span>.keyboardDidHideListener = Keyboard.addListener(<span class="string">'keyboardDidHide'</span>, <span class="keyword">this</span>.keyboardDidHide.bind(<span class="keyword">this</span>))</span><br><span class="line">&#125;</span><br><span class="line">componentWillUnmount () &#123;</span><br><span class="line">    <span class="keyword">this</span>.keyboardDidShowListener.remove()</span><br><span class="line">    <span class="keyword">this</span>.keyboardDidHideListener.remove()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><p>httpsè¿™ä¸ªé—®é¢˜ä¸Šiosè¿˜å¥½ï¼Œå®‰å“é—®é¢˜å°±æ¥äº†ï¼Œå‰æœŸæˆ‘ä»¬å‡†å¤‡å°†ajaxè¯·æ±‚çš„åº“ä¸¢ç»™åŸç”Ÿå®‰å“å’Œiosæ¥åšæˆ‘ä»¬ç›´æ¥è°ƒç”¨å°±æ˜¯äº†ï¼Œä½†æ˜¯åæ¥å‘ç°é—®é¢˜è¿™æ ·é‚£æ ·çš„é—®é¢˜å¤ªå¤šäº†ï¼Œ</p><p>æ‰€ä»¥åœ¨çƒ­æ›´æ–°æœåŠ¡å™¨å¯åŠ¨æˆ–è€…æ‰“åŒ…çš„æ—¶å€™å°±æŠŠæºä»£ç å…ˆæ”¹äº†åœ¨è¿›è¡Œæ‰“åŒ…æˆ–è€…å¯åŠ¨æœåŠ¡å™¨</p><p>æ–‡ä»¶ä½ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_modules/react-native/ReactAndroid/src/main/java/com/facebook/react/modules/network/OkHttpClientProvider.java</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶çš„æœ€åä¸€ä¸ªæ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private <span class="keyword">static</span> OkHttpClient createClient() &#123;</span><br><span class="line">  <span class="comment">// No timeouts by default</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">  .sslSocketFactory(sslContext.getSocketFactory())</span><br><span class="line">  .hostnameVerifier(<span class="keyword">new</span> HostnameVerifier() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public boolean verify(<span class="built_in">String</span> hostname, SSLSession session) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//å¿½ç•¥æ‰€æœ‰çš„è®¤è¯ï¼Œç›´æ¥è¿”å›äº†true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    .connectTimeout(<span class="number">0</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">    .readTimeout(<span class="number">0</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">    .writeTimeout(<span class="number">0</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">    .cookieJar(<span class="keyword">new</span> ReactCookieJarContainer())</span><br><span class="line">    .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æºä»£ç çš„æ–¹å¼æœ‰ç‚¹ç•¥å‘ï¼Œä¸è¿‡å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œè¿˜èŠ‚çº¦æ—¶é—´ï¼ï¼ï¼</p><h2 id="BackAndroid"><a href="#BackAndroid" class="headerlink" title="BackAndroid"></a>BackAndroid</h2><p>å®‰å“æœºæœ‰ç‹¬ç‰¹çš„ç‚¹å‡»æŒ‰é”®è¿”å›ï¼Œæ‰€ä»¥åœ¨æœ€å¤–å±‚ä¼šæ³¨å†Œä¸€ä¸ªç›‘å¬æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">bindHardwareBackPress()&#123;</span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">'android'</span>) &#123;</span><br><span class="line">        BackAndroid.addEventListener(<span class="string">'hardwareBackPress'</span>, <span class="keyword">this</span>._onHomeBackPress);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">onHomeBackPress()&#123;</span><br><span class="line">    <span class="keyword">let</span> routeList = <span class="keyword">this</span>.getRouteList();</span><br><span class="line">    <span class="keyword">if</span> (routeList.length !== <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.navigator.pop();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">this</span>.handleHomeBackPress();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">handleHomeBackPress()&#123;</span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">"android"</span>) &#123;</span><br><span class="line">        ToastAndroid.show(<span class="string">"å†æŒ‰ä¸€æ¬¡é€€å‡ºåº”ç”¨"</span>, ToastAndroid.SHORT);</span><br><span class="line">        BackAndroid.removeEventListener(<span class="string">"hardwareBackPress"</span>, <span class="keyword">this</span>._onHomeBackPress);</span><br><span class="line">        BackAndroid.addEventListener(<span class="string">"hardwareBackPress"</span>, <span class="keyword">this</span>._onExitApp);</span><br><span class="line">        <span class="keyword">this</span>.timer = TimerMixin.setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            TimerMixin.clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">            BackAndroid.removeEventListener(<span class="string">"hardwareBackPress"</span>, <span class="keyword">this</span>._onExitApp);</span><br><span class="line">            BackAndroid.addEventListener(<span class="string">"hardwareBackPress"</span>, <span class="keyword">this</span>._onHomeBackPress);</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">exitApp()&#123;</span><br><span class="line">    BackAndroid.exitApp();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯ç›‘å¬è¿”å›é”®ï¼Œå¦‚æœä¸æ˜¯åœ¨æœ€å¤–å±‚çš„è·¯ç”±å°±è¿”å›ä¸Šä¸€ä¸ª,å¦‚æœåœ¨æœ€å¤–å±‚å°±ç›´æ¥å…³é—­appï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¿™æ ·é‚£æ ·çš„éœ€æ±‚è¦å»å¯¹å®‰å“çš„è¿”å›é”®è¿›è¡Œæ“ä½œï¼Œå‘å°±æ¥äº†ï¼Œä½ ä»¥ä¸ºæä¾›çš„removeEventListeneræ–¹æ³•æ˜¯æ²¡é—®é¢˜çš„ï¼Ÿno ï¼ï¼ï¼ ä»–ä¼šç§»é™¤æ‰€æœ‰çš„ç›‘å¬ï¼Œè¿™æ˜¯ä¸æ˜¯å¾ˆå‘ï¼ï¼ï¼ï¼</p><p>æ‰€ä»¥ï¼š<strong>åœ¨éœ€è¦å¯¹å®‰å“è¿”å›é”®è¿›è¡Œç‰¹æ®Šå¤„ç†çš„æ—¶å€™è®°å¾—å…¶ä»–åœ°æ–¹åšäº†ç›‘å¬çš„å†é‡æ–°ç›‘å¬ä¸€æ¬¡ï¼ï¼ï¼ï¼</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘-è¿™é‡Œè®°å½•ä¸€ä¸‹&quot;&gt;&lt;a href=&quot;#æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘-è¿™é‡Œè®°å½•ä¸€ä¸‹&quot; class=&quot;headerlink&quot; title=&quot;æœ€è¿‘åœ¨ä½¿ç”¨react-nativeçš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘
      
    
    </summary>
    
    
    
      <category term="ReactNative" scheme="https://summxu.github.io/tags/ReactNative/"/>
    
  </entry>
  
  <entry>
    <title>HTTPç¼“å­˜-ETag</title>
    <link href="https://summxu.github.io/2019/http-cache-etag/"/>
    <id>https://summxu.github.io/2019/http-cache-etag/</id>
    <published>2019-08-10T12:44:11.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨å­¦ä¹ ç½‘ç«™æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„å†…å®¹ï¼Œå…³äºç½‘ç«™ä¼˜åŒ–ç‚¹ç‰¹åˆ«å¤šè€ŒHTTPç¼“å­˜ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œäºæ˜¯ä»Šå¤©å°±ç€é‡çœ‹ä¸‹HTTPç¼“å­˜ç›¸å…³çš„å†…å®¹åŠ æ·±ä¸‹å¯¹æ­¤ç›¸å…³çŸ¥è¯†çš„ç†è§£å’Œè®¤è¯†ã€‚è‡ªå·±åŠ¨æ‰‹é€šè¿‡ç®€å•çš„æœåŠ¡ï¼Œçœ‹çœ‹å…¶ä¸­çš„è¿‡ç¨‹ã€‚</p></blockquote><h2 id="ETagéªŒè¯ç¼“å­˜çš„å“åº”"><a href="#ETagéªŒè¯ç¼“å­˜çš„å“åº”" class="headerlink" title="ETagéªŒè¯ç¼“å­˜çš„å“åº”"></a>ETagéªŒè¯ç¼“å­˜çš„å“åº”</h2><p>åœ¨æœ¬åœ°é€šè¿‡ express å¯äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ä¸ªæœåŠ¡ï¼Œå…·ä½“å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(<span class="string">'hello http'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The server is running at http://127.0.0.1:3000/'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»”ç»†çœ‹å´å‘ç°ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢<strong><a href="http://127.0.0.1:3000/" target="_blank" rel="noopener">http://127.0.0.1:3000/</a></strong>æ—¶ï¼ŒStatusä¸º200è€Œå†æ¬¡åˆ·æ–°å‘ç°Statuså´æ˜¯304</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://upload-images.jianshu.io/upload_images/8532055-e14290fe5a1aaa4b.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://upload-images.jianshu.io/upload_images/8532055-f19b1eb12e8d8cc4.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt title>                </div>                <div class="image-caption"></div>            </figure><p>ä»”ç»†å¯¹æ¯”å‘ç°</p><ol><li>ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶å€™è¯·æ±‚å‚æ•°ä¸­å¹¶æ²¡æœ‰ If-None-Match å­—æ®µä½†æ˜¯å´æœ‰ä¸ªPragmaï¼›åŒæ—¶åœ¨è¯·æ±‚çš„Responseä¸­æœ‰ä¸€ä¸ª <strong>ETag: W/â€œa-QFZ79AprHeNlMfPMKXyEUV+lyOgâ€</strong>å­—æ®µã€‚</li><li>åˆ·æ–°é¡µé¢åå†æ¬¡è¯·æ±‚åœ¨è¯·æ±‚å¤´ä¸­å´æœ‰ä¸ª *<em>If-None-Match: W/â€œa-QFZ79AprHeNlMfPMKXyEUV+lyOgâ€ *</em>ï¼ŒIf-None-Match çš„å€¼å’Œç¬¬ä¸€æ¬¡è¯·æ±‚çš„ETagçš„å€¼ç›¸åŒã€‚</li></ol><p>ç»è¿‡æŸ¥è¯¢æ‰äº†è§£åŸç†æµè§ˆå™¨ä¼šæ ¹æ®HTTPè¯·æ±‚çš„ETagéªŒè¯è¯·æ±‚çš„èµ„æºæ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœå®ƒæœªå‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡å™¨å°†è¿”å›â€œ304 Not Modifiedâ€å“åº”ï¼Œå¹¶ä¸”èµ„æºä»æµè§ˆå™¨ç¼“å­˜ä¸­è¯»å–ï¼Œè¿™æ ·å°±ä¸å¿…å†æ¬¡ä¸‹è½½è¯·æ±‚ã€‚</p><p>ç”±æ­¤çœ‹æ¥æ•´ä¸ªçš„è¿‡ç¨‹å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><ol><li>å¦‚æœç¼“å­˜ä¸­æœ‰ETag ä»¤ç‰Œï¼Œå®¢æˆ·ç«¯è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨åœ¨â€œIf-None-Matchâ€ HTTP è¯·æ±‚æ ‡å¤´å†…æä¾› ETag ä»¤ç‰Œã€‚</li><li>æœåŠ¡å™¨æ ¹æ®å½“å‰èµ„æºæ ¸å¯¹ä»¤ç‰Œï¼ŒéªŒè¯æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå°†éªŒè¯ç»“æœé€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®ç»“æœçœ‹çœ‹æ˜¯å¦éœ€è¦ä»ç¼“å­˜ä¸­è¯»å–è¿˜æ˜¯å‘é€èµ„æºè¯·æ±‚ã€‚</li></ol><p>è¡¥å……ä¸€ä¸ªå¾ˆç›´ç™½çš„ <a href="https://github.com/jawil/blog/issues/14" target="_blank" rel="noopener">TCPåè®®çš„ä¸‰æ¬¡æ¡æ‰‹</a> çš„ç†è§£ã€‚</p><p>ä¸ºäº†éªŒè¯æŸ¥è¯çš„ç»“æœï¼Œæˆ‘åˆæ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ï¼Œå®¢æˆ·ç«¯æ˜ç¡®è¿”å›ä¸€ä¸ªETag, ä½†æ˜¯è¿™é‡Œæ¯æ¬¡è¯·æ±‚çš„çš„è¿”å›å€¼éƒ½ä¸ç›¸åŒï¼Œè¿™é‡Œç®€å•çš„ä½¿ç”¨äº†ä¸ª<strong>etag++</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(<span class="string">'hello http'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ETag</span></span><br><span class="line"><span class="keyword">let</span> etag = <span class="number">0</span>;</span><br><span class="line">app.get(<span class="string">'/test'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  etag++;</span><br><span class="line">  res.set(<span class="string">'ETag'</span>, etag);</span><br><span class="line">  res.send(<span class="string">'ETag'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The server is running at http://127.0.0.1:3000/'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://upload-images.jianshu.io/upload_images/8532055-71230f0ad656f455.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt title>                </div>                <div class="image-caption"></div>            </figure><p>æŸ¥çœ‹ä¸‹ /test åœ°å€çš„è¯·æ±‚ç»“æœï¼Œä¼šå‘ç°If-None-Match çš„å€¼å’Œ Responseä¸­çš„ ETagå€¼æ¯æ¬¡éƒ½ä¸ç›¸åŒï¼Œå¹¶ä¸”æ˜¯ æµè§ˆå™¨ä¼šå°†æ¯æ¬¡çš„ ETag å€¼éƒ½ç¼“å­˜èµ·æ¥åœ¨ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™å‘é€ç»™æœåŠ¡å™¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯æ¬¡æœåŠ¡å™¨æ¯æ¬¡æ ¡éªŒçš„å€¼éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œæ‰€ä»¥è¿™ç§å°±æ²¡æœ‰åšç¼“å­˜ï¼Œå› æ­¤æ¯æ¬¡è¯·æ±‚ /test åœ°å€éƒ½æ˜¯ 200 çš„çŠ¶æ€ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ ç½‘ç«™æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„å†…å®¹ï¼Œå…³äºç½‘ç«™ä¼˜åŒ–ç‚¹ç‰¹åˆ«å¤šè€ŒHTTPç¼“å­˜ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œäºæ˜¯ä»Šå¤©å°±ç€é‡çœ‹ä¸‹HTTPç¼“å­˜ç›¸å…³çš„å†…å®¹åŠ æ·±ä¸‹å¯¹æ­¤ç›¸å…³çŸ¥è¯†çš„ç†è§£å’Œè®¤è¯†ã€‚è‡ªå·±åŠ¨æ‰‹é€šè¿‡ç®€å•çš„æœåŠ¡ï¼Œçœ‹çœ‹å…¶ä¸­çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 
      
    
    </summary>
    
    
    
      <category term="ç½‘ç»œ" scheme="https://summxu.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>fixed å®šä½å¤±æ•ˆ ä¸ CSS å±‚å ä¸Šä¸‹æ–‡</title>
    <link href="https://summxu.github.io/2019/fixed-stacking-context/"/>
    <id>https://summxu.github.io/2019/fixed-stacking-context/</id>
    <published>2019-05-22T15:38:51.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€éƒ¨åˆ†ï¼Œposition: fixedå¤±æ•ˆçš„é—®é¢˜ï¼›<br>ç¬¬äºŒéƒ¨åˆ†ï¼Œäº†è§£ä¸€ä¸‹ç”±æ­¤æ‰¯å‡ºçš„ä¸€ä¸ªStacking Contextå±‚å ä¸Šä¸‹æ–‡ã€‚</p><h1 id="å…³äº-position-fixed"><a href="#å…³äº-position-fixed" class="headerlink" title="å…³äº position: fixed"></a>å…³äº position: fixed</h1><p><strong>position: fixed</strong> åœ¨æ—¥å¸¸å¸ƒå±€ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå¦‚ç§»åŠ¨ç«¯å¤´éƒ¨å’Œåº•éƒ¨å¯¼èˆªå®šä½ã€æ¨¡æ€æ¡†ã€æ‚¬æµ®æŒ‰é’®ç­‰ï¼Œè®¾ç½®äº†è¿™ä¸ªå±æ€§å€¼å¾—å…ƒç´ ä¼šç›¸å¯¹äºå±å¹•è§†å£ï¼ˆviewportï¼‰è¿›è¡Œå®šä½ï¼Œå…¶ä½ç½®åœ¨å±å¹•è¿›è¡Œæ»šåŠ¨æ—¶ä¼šä¿æŒä¸å˜ï¼Œä¸å ç”¨æ–‡æ¡£æµä¸­çš„ä½ç½®ï¼Œè€Œä¸”æ‰“å°æ—¶è¿™ä¸ªå…ƒç´ ä¼šå‡ºç°åœ¨ æ¯ä¸€é¡µ çš„ç›¸åŒä½ç½®ã€‚è®¾ç½®äº† <strong>position: fixed</strong> çš„å…ƒç´ æœ€ç»ˆçš„ä½ç½®ç”±å®ƒçš„ <strong>top, right, bottom, left</strong> æ¥å†³å®šï¼Œè¿™ä¸ªå€¼ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>stacking context</strong><br>ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œè¿™ç§å®šä½æ–¹å¼ä¼šå¤±æ•ˆï¼Œä½¿å¾—å…ƒç´ ç›¸å¯¹äºè§†çª—å®šä½çš„å®šä½ä¸ç¬¦åˆé¢„æœŸï¼ˆå…¶å®æ˜¯ <strong>fixed</strong> å®šä½çš„å‚è€ƒå…ƒç´ å˜äº†ï¼‰ã€‚å½“è¯¥å…ƒç´ çš„çˆ¶å…ƒç´ ä¸­ï¼ˆå¹¿ä¹‰ï¼ŒåŒ…å«ç¥–å…ˆå…ƒç´ ï¼‰æœ‰å…ƒç´ çš„ <strong>transform</strong> æˆ– <strong>perspective</strong> çš„å€¼ä¸æ˜¯ <strong>none</strong>ï¼Œè¯¥å…ƒç´ å°±ä¼šç›¸å¯¹äºè¿™ä¸ªçˆ¶å…ƒç´ è€Œä¸æ˜¯è§†å£è¿›è¡Œå®šä½ã€‚<br>å…·ä½“çš„åŸå› æ˜¯è¿™æ ·ï¼š</p><blockquote><p>Specifying a value other than none for the transform property establishes a new local coordinate system at the element that it is applied to. The mapping from where the element would have rendered into that local coordinate system is given by the elementâ€™s transformation matrix. Transformations are cumulative. That is, elements establish their local coordinate system within the coordinate system of their parent. From the perspective of the user, an element effectively accumulates all the transform properties of its ancestors as well as any local transform applied to it. The accumulation of these transforms defines a current transformation matrix for the element.</p></blockquote><p>è§£é‡Šä¸€ä¸‹ï¼Œ<strong>transform</strong> æˆ– perspective çš„é none å€¼ä¼šå½±å“å…ƒç´ çš„åŒ…å«å—å’Œå±‚å ä¸Šä¸‹æ–‡ï¼Œè¿™äº›å€¼ä¼šåœ¨åº”ç”¨å®ƒçš„å…ƒç´ ä¸Šå»ºç«‹ä¸€ä¸ªå±€éƒ¨çš„åæ ‡ç³»ï¼ˆXè½´å‘å³æ°´å¹³å¢åŠ ; Yè½´å‚ç›´å‘ä¸‹å¢åŠ ï¼‰ï¼Œç”±å˜æ¢çŸ©é˜µï¼ˆ<strong>transform</strong> çš„å€¼ï¼‰ç»™å‡ºå…ƒç´ åˆ°è¯¥å±€éƒ¨åæ ‡ç³»çš„æ˜ å°„ï¼Œè€Œä¸” <strong>transform</strong> å¸¦æ¥çš„å±€éƒ¨åæ ‡ç³»çš„æ”¹å˜æ˜¯å¯ä»¥ç´¯ç§¯çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå­å…ƒç´ ä¼šåœ¨å®ƒçš„çˆ¶å…ƒç´ çš„åæ ‡ç³»å†…å»ºç«‹å­å…ƒç´ è‡ªå·±çš„å±€éƒ¨åæ ‡ç³»ï¼š<br>çˆ¶å…ƒç´ çš„ <strong>transform</strong> ä»¬ä¸€å±‚å±‚ç§¯ç´¯å®šä¹‰äº†å­å…ƒç´ å½“å‰çš„å˜æ¢çŸ©é˜µï¼ˆä¸€ä¸ªå…ƒç´ çš„å˜æ¢çŸ©é˜µæ˜¯ä» <strong>transform</strong> å’Œ <strong>transform</strong>-origin å±æ€§ä¸­è®¡ç®—å‡ºæ¥çš„ï¼‰ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡ <strong>transform-origin</strong> çš„å€¼å¯¹åæ ‡åŸç‚¹ X å’Œ Y çš„ä½ç½®è¿›è¡Œè½¬æ¢</li><li>ä»¥å˜æ¢åçš„ Xã€Y ä¸ºåæ ‡åŸç‚¹åŸç‚¹ï¼Œæ ¹æ® <strong>transform</strong> çš„å±æ€§å€¼è¿›è¡Œå˜æ¢</li><li>X å’Œ Y æ ¹æ® <strong>transform-origin</strong> çš„ç›¸åå€¼å¹³ç§»å›å»</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20180102175637761?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUGFuZGFfbQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="å¦‚å›¾" title>                </div>                <div class="image-caption">å¦‚å›¾</div>            </figure><p><strong>transform</strong> ä¼šå½±å“æœ€ç»ˆçš„æ¸²æŸ“æ•ˆæœï¼Œä½†æ˜¯ä¸å½±å“é™¤overflowå¤–çš„CSSå¸ƒå±€ï¼Œå½“é€šè¿‡ <strong>getClientRects()</strong>ã€<strong>getBoundingClientRect()</strong> è¿™äº›æ¥å£è·å– <strong>client rectangles</strong> æ—¶ï¼Œ<strong>transform</strong> çš„æ•ˆæœä¹Ÿä¼šè¢«è€ƒè™‘è¿›å»ã€‚</p><p>å¯ä»¥åº”ç”¨ <strong>transform</strong> çš„å…ƒç´ ï¼ˆ<strong>transformable elements</strong>ï¼‰æœ‰ï¼š</p><ul><li>æ»¡è¶³CSSç›’æ¨¡å‹çš„å—çº§å…ƒç´ æˆ–è¡Œå†…å…ƒç´ ï¼Œæˆ–è€…å®ƒçš„ display å€¼ä¸º table-row, table-row-group, table-header-group, table-footer-group, table-cell, table-caption ä¸­çš„ä¸€ä¸ª</li><li>SVG å‘½åç©ºé—´ä¸­å…·æœ‰ transform, patternTransform æˆ– gradientTransform å±æ€§çš„å…ƒç´ </li></ul><p>p.s. å…³äºä¸Šé¢çš„åº”ç”¨<strong>transform</strong>åå…ƒç´ ä½ç½®çš„è®¡ç®—æ–¹å¼ã€‚åŸæ–‡å¦‚ä¸‹ï¼š</p><ol><li>Start with the identity matrix.</li><li>Translate by the computed X and Y of transform-origin</li><li>Multiply by each of the transform functions in transform property from left to right</li><li>Translate by the negated computed X and Y values of transform-origin</li></ol><p>å‚è€ƒæ–‡æ¡£ï¼š</p><p><a href="https://www.w3.org/TR/css-transforms-1/#propdef-transform" target="_blank" rel="noopener">The transform Property - W3C Working Draft - 30 November 2017</a></p><p><a href="https://www.w3.org/TR/css-transforms-1/#transform-rendering" target="_blank" rel="noopener">The Transform Rendering Model - W3C Working Draft - 30 November 2017</a></p><h1 id="å±‚å ä¸Šä¸‹æ–‡-Stacking-Context"><a href="#å±‚å ä¸Šä¸‹æ–‡-Stacking-Context" class="headerlink" title="å±‚å ä¸Šä¸‹æ–‡ Stacking Context"></a>å±‚å ä¸Šä¸‹æ–‡ Stacking Context</h1><p>é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“äº†æœ‰å±‚å ä¸Šä¸‹æ–‡è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œå±‚å ä¸Šä¸‹æ–‡æ˜¯HTMLå…ƒç´ çš„ä¸‰ç»´æ¦‚å¿µï¼Œè¿™äº›HTMLå…ƒç´ åœ¨ä¸€æ¡å‡æƒ³çš„ç›¸å¯¹äºé¢å‘ï¼ˆç”µè„‘å±å¹•çš„ï¼‰è§†çª—zè½´ä¸Šå»¶ä¼¸ï¼ŒHTMLå…ƒç´ ä¾æ®å…¶è‡ªèº«å±æ€§æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºå ç”¨å±‚å ä¸Šä¸‹æ–‡çš„ç©ºé—´ã€‚å’ŒBFCè¿˜æœ‰IFCè¿™äº›xx contextä¸€æ ·ï¼Œåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯æœ‰æ¡ä»¶çš„ï¼Œæ–‡æ¡£ä¸­çš„å±‚å ä¸Šä¸‹æ–‡ç”±æ»¡è¶³ä»¥ä¸‹ä»»æ„ä¸€ä¸ªæ¡ä»¶çš„å…ƒç´ å½¢æˆï¼š</p><ul><li>æ ¹å…ƒç´  (HTML),</li><li>z-index å€¼ä¸ä¸º auto çš„ ç»å¯¹/ç›¸å¯¹å®šä½å…ƒç´ </li><li>position ä¸æ˜¯ static çš„å…ƒç´ ï¼ˆsticky ä¹Ÿä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„å®éªŒä¸­çš„å±æ€§å€¼ï¼‰</li><li>ä¸€ä¸ª z-index å€¼ä¸ä¸º auto çš„ flex é¡¹ç›® (flex item)</li><li>opacity å±æ€§å€¼å°äº 1 çš„å…ƒç´ ï¼ˆå‚è€ƒ the specification for opacityï¼‰</li><li>transform å±æ€§å€¼ä¸ä¸º none çš„å…ƒç´ </li><li>mix-blend-mode å±æ€§å€¼ä¸ä¸º normal çš„å…ƒç´ </li><li>æœ‰ transformã€filterã€perspectiveã€clip-pathã€mask / mask-image / mask-border è¿™äº›å±æ€§ä¸­ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„å…ƒç´ </li><li>isolation å±æ€§è¢«è®¾ç½®ä¸º isolateçš„å…ƒç´ </li><li>åœ¨ will-change ä¸­æŒ‡å®šäº†ä»»æ„CSS` å±æ€§çš„å…ƒç´ ï¼ˆå³ä½¿æ²¡æœ‰ç›´æ¥æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼‰</li><li>-webkit-overflow-scrolling å±æ€§è¢«è®¾ç½® touchçš„å…ƒç´ </li><li>è®¾ç½®äº† transform-style: preserve-3d çš„å…ƒç´ </li></ul><p>åœ¨å±‚å ä¸Šä¸‹æ–‡ä¸­çš„å­å…ƒç´ ä¹Ÿä¼šæŒ‰ç…§ä¸Šé¢çš„è§„åˆ™è¿›è¡Œå±‚å ï¼Œå­å…ƒç´ çš„ z-index å€¼åªåœ¨çˆ¶çº§å±‚å ä¸Šä¸‹æ–‡ä¸­æœ‰æ„ä¹‰ï¼Œå­çº§å±‚å ä¸Šä¸‹æ–‡è¢«è‡ªåŠ¨è§†ä¸ºçˆ¶çº§å±‚å ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒã€‚</p><p>ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯åˆ›å»ºäº†æ–°çš„å±‚å ä¸Šä¸‹æ–‡çš„å…ƒç´ å¹¶ä¸ä¸€å®šéƒ½ä¼šå¯¹å…¶æ‹¥æœ‰position: fixedçš„å­å…ƒç´ çš„æ•ˆæœäº§ç”Ÿå½±å“ï¼Œ<br>åœ¨Chromeï¼ˆBlinkå†…æ ¸ï¼‰ä¸­ï¼Œå¯ä»¥æ˜ç¡®çœ‹åˆ°äº§ç”Ÿäº†å½±å“çš„æ˜¯ï¼š</p><ul><li>transform å±æ€§å€¼ä¸ä¸º none çš„å…ƒç´ </li><li>è®¾ç½®äº† transform-style: preserve-3d çš„å…ƒç´ </li><li>perspective å€¼ä¸ä¸º none çš„å…ƒç´ </li><li>åœ¨ will-change ä¸­æŒ‡å®šäº†ä»»æ„ CSS å±æ€§çš„å…ƒç´ </li><li>ä½†æ˜¯ï¼Œåœ¨ä¸åŒçš„æµè§ˆå™¨å†…æ ¸ä¸‹ï¼Œä¸Šè¿°ç»“è®ºä¹Ÿä¼šæœ‰æ‰€å·®å¼‚ï¼Œä¾‹å¦‚ï¼Œåœ¨ Safariï¼ˆWebkitå†…æ ¸ï¼‰ ä¸­ï¼Œåªæœ‰transform å±æ€§å€¼ä¸ä¸º none çš„å…ƒç´ ä¼šå¯¹ fixed å®šä½çš„æ•ˆæœäº§ç”Ÿå½±å“.</li></ul><p>å‚è€ƒæ–‡æ¡£ï¼š</p><p><a href="https://www.w3.org/TR/css-color-3/#transparency" target="_blank" rel="noopener">the specification for opacity - W3C</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context" target="_blank" rel="noopener">The stacking context - MDN</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç¬¬ä¸€éƒ¨åˆ†ï¼Œposition: fixedå¤±æ•ˆçš„é—®é¢˜ï¼›&lt;br&gt;ç¬¬äºŒéƒ¨åˆ†ï¼Œäº†è§£ä¸€ä¸‹ç”±æ­¤æ‰¯å‡ºçš„ä¸€ä¸ªStacking Contextå±‚å ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å…³äº-position-fixed&quot;&gt;&lt;a href=&quot;#å…³äº-position-fixed&quot; class=&quot;h
      
    
    </summary>
    
    
    
      <category term="CSS" scheme="https://summxu.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>css3 transformå¯¹æ™®é€šå…ƒç´ çš„nå¤šæ¸²æŸ“å½±å“</title>
    <link href="https://summxu.github.io/2019/transform-element-impact/"/>
    <id>https://summxu.github.io/2019/transform-element-impact/</id>
    <published>2019-05-18T15:15:18.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é—®é¢˜åŸå› ï¼šé¡¹ç›®ä¸­ç”¨åˆ°äº†vantæ¡†æ¶ï¼Œåœ¨dilogä¸­æƒ³è¦å¼¹å‡ºActionsheetå‘ç°ç»å¯¹å®šä½æ˜¯è·Ÿç€dilogå¤–å±‚å…ƒç´ å®šä½ï¼Œæ­¤æ—¶çš„ <code>position:fixed</code> æ— æ•ˆï¼Œé—®é¢˜æ˜¯å› ä¸ºdilogå®šä½æ—¶ç”¨äº†transformï¼Œæ·±ç©¶ä¸‹é—®é¢˜åŸå› ï¼Œå‘ç°äº‹æƒ…å¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼</p></blockquote><p>ä¸€ä¸ªæ™®æ™®é€šé€šçš„å…ƒç´ ï¼Œå¦‚æœåº”ç”¨äº†CSS3 transformå˜æ¢ï¼Œå³ä¾¿è¿™ä¸ªtransformå±æ€§å€¼ä¸ä¼šæ”¹å˜å…¶ä»»ä½•è¡¨é¢çš„å˜åŒ–ï¼ˆå¦‚scale(1), translate(0,0)ï¼‰ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œå¯¹è¿™äº›å…ƒç´ è¿˜æ˜¯é€ æˆäº†å¾ˆæ·±è¿œçš„å½±å“ã€‚</p><h1 id="transformæå‡å…ƒç´ çš„å‚ç›´åœ°ä½"><a href="#transformæå‡å…ƒç´ çš„å‚ç›´åœ°ä½" class="headerlink" title="transformæå‡å…ƒç´ çš„å‚ç›´åœ°ä½"></a>transformæå‡å…ƒç´ çš„å‚ç›´åœ°ä½</h1><p>å½“é­é‡å…ƒç´ marginè´Ÿå€¼é‡å çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰staticä»¥å¤–çš„positionå±æ€§å€¼çš„è¯ï¼Œåé¢çš„å…ƒç´ æ˜¯ä¼šè¦†ç›–å‰é¢çš„å…ƒç´ çš„ã€‚<br><code>img src=&quot;mm1&quot;&gt;&lt;img src=&quot;mm2&quot; style=&quot;margin-left:-60px;&quot;&gt;</code><br>åœ¨transformå‡ºç°ä¹‹å‰ï¼Œè¿™ä¸ªè§„åˆ™ä¸€ç›´å¾ˆç¨³å¥ï¼›ä½†æ˜¯ï¼Œè‡ªä»transformé™ä¸´ï¼Œè¿™ä¸ªè§„åˆ™å°±å˜äº†ã€‚å…ƒç´ åº”ç”¨äº†transformå±æ€§ä¹‹åï¼Œå°±ä¼šå˜å¾—åº”ç”¨äº†position:relativeä¸€ä¸ªå°¿æ€§ï¼ŒåŸæœ¬åº”è¯¥è¢«è¦†ç›–çš„å…ƒç´ ä¼šé›„èµ·ï¼Œå˜æˆè¦†ç›–å…¶ä»–å…ƒç´ ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"mm1"</span> <span class="attr">style</span>=<span class="string">"-ms-transform:scale(1);transform:scale(1);"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"mm2"</span> <span class="attr">style</span>=<span class="string">"margin-left:-60px;"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åªè¦æ˜¯æ”¯æŒtransformå…ƒç´ çš„æµè§ˆå™¨ï¼ŒåŒ…æ‹¬IE9(-ms-), éƒ½ä¼šæé«˜æ™®é€šå…ƒç´ çš„å‚ç›´åœ°ä½ï¼Œä½¿å…¶è¦†ç›–å…¶ä»–å…ƒç´ è€Œä¸æ˜¯è¢«è¦†ç›–ã€‚</p><p>è¿™ç§ç‰¹æ€§åº•å±‚åŸç†æ˜¯å±‚å ä¸Šä¸‹æ–‡ï¼Œå…·ä½“å¯å‚è§â€œ<a href="www.baidu.com">æ·±å…¥ç†è§£CSSä¸­çš„å±‚å ä¸Šä¸‹æ–‡å’Œå±‚å é¡ºåº</a>â€ä¸€æ–‡ã€‚</p><h1 id="transformé™åˆ¶position-fixedçš„è·Ÿéšæ•ˆæœ"><a href="#transformé™åˆ¶position-fixedçš„è·Ÿéšæ•ˆæœ" class="headerlink" title="transformé™åˆ¶position:fixedçš„è·Ÿéšæ•ˆæœ"></a>transformé™åˆ¶position:fixedçš„è·Ÿéšæ•ˆæœ</h1><p>æˆ‘ä»¬åº”è¯¥éƒ½çŸ¥é“ï¼Œ<code>position:fixed</code>å¯ä»¥è®©å…ƒç´ ä¸è·Ÿéšæµè§ˆå™¨çš„æ»šåŠ¨æ¡æ»šåŠ¨ï¼Œè€Œä¸”è¿™ç§è·Ÿéšæ•ˆæœè¿å®ƒçš„å…„å¼Ÿä»¬<code>position:relative/absolute</code>éƒ½é™åˆ¶ä¸äº†ã€‚ä½†æ˜¯ï¼ŒçœŸæ˜¯ä¸€ç‰©é™ä¸€ç‰©ï¼Œ<code>position:fixed</code>å›ºå®šæ•ˆæœå´è¢«å°å°çš„<code>transform</code>ç»™å¹²æ‰äº†ï¼Œç›´æ¥é™çº§å˜æˆ<code>position:absolute</code>çš„è›‹ç–¼è¡¨ç°ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢ç¤ºæ„ä»£ç ï¼š</p><p><code>&lt;p style=&quot;transform:scale(1);&quot;&gt;&lt;img src=&quot;mm1.jpg&quot;style=&quot;position:fixed;&quot; /&gt;&lt;/p&gt;</code><br>ç»“æœï¼Œæœ¬æ¥åº”è¯¥ä¸è·Ÿç€æ»šåŠ¨æ¡æ»šåŠ¨çš„å‚²å¨‡<code>fixed</code>å…ƒç´ ï¼Œå˜æˆ<code>absolute</code>ä¸€æ ·çš„è¡Œä¸ºè¡¨ç°ï¼Œå½’æ ¹ç»“åº•å°±æ˜¯çˆ¶å…ƒç´ åŠ äº†ä¸ªå°å°çš„<code>transform</code>å±æ€§å€¼ã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸ªç‰¹æ€§è¡¨ç°ï¼Œç›®å‰åªåœ¨Chromeæµè§ˆå™¨/FireFoxæµè§ˆå™¨ä¸‹æœ‰ï¼ŒIEæµè§ˆå™¨ï¼ŒåŒ…æ‹¬IE11, <code>fixed</code>è¿˜æ˜¯<code>fixed</code>çš„è¡¨ç°ã€‚</p><h1 id="transformæ”¹å˜overflowå¯¹absoluteå…ƒç´ çš„é™åˆ¶"><a href="#transformæ”¹å˜overflowå¯¹absoluteå…ƒç´ çš„é™åˆ¶" class="headerlink" title="transformæ”¹å˜overflowå¯¹absoluteå…ƒç´ çš„é™åˆ¶"></a>transformæ”¹å˜overflowå¯¹absoluteå…ƒç´ çš„é™åˆ¶</h1><p>åœ¨ä»¥å‰ï¼Œ<code>overflow</code>ä¸<code>absolute</code>ä¹‹é—´çš„é™åˆ¶è§„èŒƒå†…å®¹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><p><code>absolute</code>ç»å¯¹å®šä½å…ƒç´ ï¼Œå¦‚æœå«æœ‰<code>overflow</code>ä¸ä¸º<code>visible</code>çš„çˆ¶çº§å…ƒç´ ï¼ŒåŒæ—¶ï¼Œè¯¥çˆ¶çº§å…ƒç´ ä»¥åŠåˆ°è¯¥ç»å¯¹å®šä½å…ƒç´ ä¹‹é—´ä»»ä½•åµŒå¥—å…ƒç´ éƒ½æ²¡æœ‰<code>position</code>ä¸ºé<code>static</code>å±æ€§çš„å£°æ˜ï¼Œåˆ™<code>overflow</code>å¯¹è¯¥<code>absolute</code>å…ƒç´ ä¸èµ·ä½œç”¨ã€‚</p><p>æ¯”æ–¹è¯´å¦‚ä¸‹ç¤ºæ„ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"width:96px; height:96px; border:2px solid #beceeb; overflow:hidden;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"mm1.jpg"</span><span class="attr">style</span>=<span class="string">"position:absolute;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬ç»™<code>overflow</code>å®¹å™¨æˆ–è€…ä¸å›¾ç‰‡æœ‰åµŒå¥—å…³ç³»çš„å­å…ƒç´ ä½¿ç”¨<code>transform</code>å£°æ˜ï¼Œä¼°è®¡<code>absolute</code>å…ƒç´ å°±è¦å»é¢†ä¾¿å½“äº†ï¼</p><p>æ— è®ºæ˜¯<code>overflow</code>å®¹å™¨è¿˜æ˜¯åµŒå¥—å­å…ƒç´ ï¼Œåªè¦æœ‰<code>transform</code>å±æ€§ï¼Œå°±ä¼š<code>hidden</code>æº¢å‡ºçš„<code>absolute</code>å…ƒç´ ã€‚</p><h1 id="transformé™åˆ¶absoluteçš„100-å®½åº¦å¤§å°"><a href="#transformé™åˆ¶absoluteçš„100-å®½åº¦å¤§å°" class="headerlink" title="transformé™åˆ¶absoluteçš„100%å®½åº¦å¤§å°"></a>transformé™åˆ¶absoluteçš„100%å®½åº¦å¤§å°</h1><p>ä»¥å‰ï¼Œæˆ‘ä»¬è®¾ç½®<code>absolute</code>å…ƒç´ å®½åº¦100%, åˆ™éƒ½ä¼šå‚ç…§ç¬¬ä¸€ä¸ªé<code>static</code>å€¼çš„<code>position</code>ç¥–å…ˆå…ƒç´ è®¡ç®—ï¼Œæ²¡æœ‰å°±<code>window</code>. ç°åœ¨ï¼Œéœ€è¦æŠŠ<code>transform</code>ä¹Ÿè€ƒè™‘åœ¨å†…äº†ã€‚</p><p>ç»“æœï¼Œæ— è®ºæ˜¯IE9+ï¼Œè¿˜æ˜¯Chromeè¿˜æ˜¯FireFoxæµè§ˆå™¨ï¼Œæ‰€æœ‰ç»å¯¹å®šä½å›¾ç‰‡100%å®½åº¦ï¼Œéƒ½æ˜¯ç›¸å¯¹è®¾ç½®äº†<code>transform</code>çš„å®¹å™¨è®¡ç®—äº†ï¼Œäºæ˜¯ï¼Œä¸Šé¢çš„å›¾ç‰‡æ‹‰é•¿åˆ°äº†è¥¿ä¼¯åˆ©äºšï¼›ä¸‹é¢çš„å›¾ç‰‡è¢«é™åˆ¶æˆäº†å°èƒ–å¢©ã€‚</p><p><code>transform</code>å¯¹<code>absolute</code>å®½åº¦100%é™åˆ¶~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;é—®é¢˜åŸå› ï¼šé¡¹ç›®ä¸­ç”¨åˆ°äº†vantæ¡†æ¶ï¼Œåœ¨dilogä¸­æƒ³è¦å¼¹å‡ºActionsheetå‘ç°ç»å¯¹å®šä½æ˜¯è·Ÿç€dilogå¤–å±‚å…ƒç´ å®šä½ï¼Œæ­¤æ—¶çš„ &lt;code&gt;position:fixed&lt;/code&gt; æ— æ•ˆï¼Œé—®é¢˜æ˜¯å› ä¸ºdilogå®šä½æ—¶ç”¨äº†transformï¼Œæ·±ç©¶ä¸‹
      
    
    </summary>
    
    
    
      <category term="CSS" scheme="https://summxu.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº document.execCommand çš„å¯Œæ–‡æœ¬</title>
    <link href="https://summxu.github.io/2019/rich-text-editor-by-execCommand/"/>
    <id>https://summxu.github.io/2019/rich-text-editor-by-execCommand/</id>
    <published>2019-04-30T13:05:35.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­å‡†å¤‡é›†æˆä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŸæ¥ä½¿ç”¨çš„æ˜¯ Quillï¼Œä¹‹åå‘ç°é¡¹ç›®æ‰“åŒ…ä½“ç§¯ç¬å¢äº† 200kbã€‚è™½ç„¶ Quill å®Œå…¨èƒ½å¤Ÿæ»¡è¶³é¡¹ç›®éœ€æ±‚ï¼Œä½†å…¶æä¾›çš„è¯¸å¤šåŠŸèƒ½æ˜¯ç”¨ä¸ä¸Šçš„ï¼Œå¯ä»¥ä½¿ç”¨æ›´è½»é‡çš„å®ç°ä»£æ›¿ã€‚</p><p>åœ¨å¯»æ‰¾æ–°çš„æ›¿ä»£å“æ—¶ï¼Œä¹Ÿé¡ºä¾¿ç„äº†ä¸‹å„ç§ç¼–è¾‘å™¨çš„å†…éƒ¨å®ç°ã€‚ä¸€äº›ä½“ç§¯åºå¤§çš„ç¼–è¾‘å™¨ä¸€èˆ¬éƒ½å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œä¸å¾—ä¸å†™å¾ˆå¤šå…¼å®¹æ€§çš„ä»£ç ã€‚è€Œä¸€äº› MINIã€è½»é‡çš„ç¼–è¾‘å™¨æ˜¯ä¸å¯¹ä½ç«¯æµè§ˆå™¨ä½œå…¼å®¹çš„ï¼Œä½¿ç”¨<code>Selection</code>ã€<code>Range</code>æˆ–è€…<code>document.execCommand</code>å®ç°ã€‚</p><p>ä¹‹å‰åœ¨ JavaScript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ ä¸­æåˆ°è¿‡<code>Selection</code>å’Œ<code>Range</code>ï¼Œè¿™æ¬¡å°±è¯´è¯´<code>document.execCommand</code>ã€‚</p><h1 id="document-execCommand"><a href="#document-execCommand" class="headerlink" title="document.execCommand"></a>document.execCommand</h1><p>è¯¥æ–¹æ³•å¯ä»¥å¯¹å¯ç¼–è¾‘å™¨åŒºåŸŸè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚åŠ ç²—æ–‡å­—ã€æ”¹å˜å­—å·ã€æ’å…¥é“¾æ¥ç­‰ã€‚å¯ç¼–è¾‘åŒºåŸŸä¹Ÿå°±æ˜¯è®¾ç½®äº†<code>contentEditable</code>å±æ€§çš„å…ƒç´ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è¯­æ³•</span><br><span class="line">bool = document.execCommand(commandName, showDefaultUI[, arg])</span><br></pre></td></tr></table></figure><ul><li><code>commandName</code>ï¼šStringï¼Œå‘½ä»¤çš„åç§°</li><li><code>showDefaultUI</code>ï¼šBooleanï¼Œæ˜¯å¦å±•ç¤ºç”¨æˆ·ç•Œé¢ï¼ˆæš‚æ—¶æ²¡æœ‰å‘ç°â€œç”¨æˆ·ç•Œé¢â€æŒ‡çš„æ˜¯ä»€ä¹ˆï¼‰ï¼Œä¸€èˆ¬ä¸ºfalse</li><li><code>arg</code>ï¼šStringï¼Œè¦ä¼ é€’çš„å‚æ•°ï¼Œæ¯”å¦‚æ’å…¥é“¾æ¥éœ€è¦ä¼ å…¥ä¸€ä¸ª URLï¼Œå¯é€‰</li><li>è¿”å›å€¼ï¼šBooleanï¼Œè¡¨ç¤ºæ“ä½œæ˜¯å¦æ”¯æŒæˆ–æ˜¯å¦å¯ç”¨<br>å‡å¦‚è¦æŠŠé€‰ä¸­çš„æ–‡å­—åŠ ç²—ï¼Œåªéœ€è¦è¿™æ ·ï¼š</li></ul><p><code>document.execCommand(&#39;bold&#39;, false)</code></p><h1 id="å…¼å®¹æ€§"><a href="#å…¼å®¹æ€§" class="headerlink" title="å…¼å®¹æ€§"></a>å…¼å®¹æ€§</h1><p>[<a href="http://static.imys.net/execCommand-support-2017113.jpg]" target="_blank" rel="noopener">http://static.imys.net/execCommand-support-2017113.jpg]</a></p><p>å¯¹äºç°ä»£æµè§ˆå™¨çš„å…¼å®¹åº¦è¾ƒå¥½ï¼Œä¸è¿‡ Android 53 å–æ¶ˆå…¼å®¹çš„ä»€ä¹ˆé¬¼ï¼Ÿ</p><p>é™¤äº†äº†è§£è¯¥æ–¹æ³•çš„å…¼å®¹æ€§å¤–ï¼Œè¿˜éœ€è¦äº†è§£æ¯ä¸€ç§å¯æ‰§è¡Œå‘½ä»¤çš„å…¼å®¹æ€§ã€‚æ¯”å¦‚<code>decreaseFontSize</code>ï¼Œç»™é€‰ä¸­æ–‡å­—æ·»åŠ <code>small</code>æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯å°å·å­—ä½“ï¼Œè°·æ­Œæ˜¯ä¸æ”¯æŒçš„ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ£€æµ‹å‘½ä»¤æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­æ”¯æŒï¼š</p><p><code>document.queryCommandSupported(commandName)</code></p><h1 id="ç®€é™‹çš„å®ç°"><a href="#ç®€é™‹çš„å®ç°" class="headerlink" title="ç®€é™‹çš„å®ç°"></a>ç®€é™‹çš„å®ç°</h1><p>ä¸åˆ° 50 è¡Œä»£ç ï¼ŒåŸºäº<a href="https://imys.net/demo/cmdEditor.html" target="_blank" rel="noopener">document.execCommandå®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</a>ã€‚</p><p>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä»¥æ­¤ä¸ºå‡ºå‘ç‚¹ï¼Œå»å¼€å‘ä¸€ä¸ªå…·å¤‡å®Œæ•´åŠŸèƒ½çš„ç¼–è¾‘å™¨ã€‚æ‡’å¾—æŠ˜è…¾çš„å¯ä»¥åƒæˆ‘ä¸€æ ·å¤šæœç´¢å‡ ä¸‹ï¼Œæ‰¾ä¸€ä¸ªåˆé€‚çš„è½®å­ã€‚ğŸ˜…</p><p>å‚è€ƒ<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand" target="_blank" rel="noopener">MDN: document.execCommand</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨é¡¹ç›®ä¸­å‡†å¤‡é›†æˆä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŸæ¥ä½¿ç”¨çš„æ˜¯ Quillï¼Œä¹‹åå‘ç°é¡¹ç›®æ‰“åŒ…ä½“ç§¯ç¬å¢äº† 200kbã€‚è™½ç„¶ Quill å®Œå…¨èƒ½å¤Ÿæ»¡è¶³é¡¹ç›®éœ€
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>WebpackæŒ‰éœ€æ‰“åŒ…Lodashçš„å‡ ç§æ–¹å¼</title>
    <link href="https://summxu.github.io/2019/webpack-use-lodash/"/>
    <id>https://summxu.github.io/2019/webpack-use-lodash/</id>
    <published>2019-04-16T05:23:06.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ•°æ®æ“ä½œæ—¶ï¼ŒLodash å°±æ˜¯æˆ‘çš„å¼¹è¯åº“ï¼Œä¸ç®¡é‡åˆ°å¤šå¤æ‚çš„æ•°æ®ç»“æ„éƒ½èƒ½ç”¨ä¸€äº›å‡½æ•°è½»æ¾æ‹†è§£ã€‚</p><p>ES6 ä¸­ä¹Ÿæ–°å¢äº†è¯¸å¤šæ–°çš„å¯¹è±¡å‡½æ•°ï¼Œä¸€äº›ç®€å•çš„é¡¹ç›®ä¸­ ES6 å°±è¶³å¤Ÿä½¿ç”¨äº†ï¼Œä½†è¿˜æ˜¯ä¼šæœ‰ä¾‹å¤–çš„æƒ…å†µå¼•ç”¨äº†å°‘æ•°çš„ Lodash å‡½æ•°ã€‚ä¸€ä¸ªå®Œæ•´çš„ Lodash åº“ï¼Œå³ä½¿æ˜¯å‹ç¼©åï¼Œç°æœ€æ–°ç‰ˆæœ¬ä¹Ÿæœ‰ 71k çš„ä½“ç§¯ã€‚ä¸èƒ½ä¸ºäº†åƒä¸€å£é¥­è€Œä¹°ä¸‹ä¸€ä¸ªé¥­åº—å•Šã€‚</p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®å·²ç»æœ‰å¾ˆå¤šå¯é€‰æ–¹æ¡ˆäº†ã€‚</p><h1 id="å‡½æ•°æ¨¡å—"><a href="#å‡½æ•°æ¨¡å—" class="headerlink" title="å‡½æ•°æ¨¡å—"></a>å‡½æ•°æ¨¡å—</h1><p>Lodash ä¸­çš„æ¯ä¸ªå‡½æ•°åœ¨ NPM éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å‘å¸ƒæ¨¡å—ã€‚<code>NPM: results for â€˜lodashâ€™</code><br>å‡å¦‚ä½ åªéœ€è¦ä½¿ç”¨<code>_.isEqual</code>ï¼Œé‚£ä¹ˆä½ åªéœ€è¦å®‰è£…<code>lodash.isequal</code>æ¨¡å—ï¼Œç„¶åæŒ‰ä»¥ä¸‹æ–¹å¼å¼•ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isEqual = <span class="built_in">require</span>(<span class="string">'lodash.isequal'</span>)</span><br><span class="line"><span class="comment">// or ES6</span></span><br><span class="line"><span class="keyword">import</span> isEqual <span class="keyword">from</span> <span class="string">'lodash.isequal'</span></span><br><span class="line">isEqual([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h1 id="å…¨è·¯å¾„å¼•ç”¨"><a href="#å…¨è·¯å¾„å¼•ç”¨" class="headerlink" title="å…¨è·¯å¾„å¼•ç”¨"></a>å…¨è·¯å¾„å¼•ç”¨</h1><p>åœ¨ä½ å®Œæ•´å®‰è£… Lodash åï¼Œå¯ä»¥æŒ‰<code>lodash/å‡½æ•°å</code>çš„æ ¼å¼å•ç‹¬å¼•å…¥éœ€è¦çš„å‡½æ•°æ¨¡å—ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> difference = <span class="built_in">require</span>(<span class="string">'lodash/difference'</span>)</span><br><span class="line"><span class="comment">// or ES6</span></span><br><span class="line"><span class="keyword">import</span> difference <span class="keyword">from</span> <span class="string">'lodash/difference'</span></span><br><span class="line">difference([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">3</span>])  <span class="comment">// [2]</span></span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æ’ä»¶ä¼˜åŒ–"><a href="#ä½¿ç”¨æ’ä»¶ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨æ’ä»¶ä¼˜åŒ–"></a>ä½¿ç”¨æ’ä»¶ä¼˜åŒ–</h1><p>åœ¨ç®€å•åœºæ™¯ä¸‹ï¼Œä»¥ä¸Šä¸¤ç§æ–¹å¼è¶³ä»¥è§£å†³é—®é¢˜ã€‚<br>è€Œé‡åˆ°å¤æ‚çš„æ•°æ®å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¼•å…¥å¤šä¸ª Lodash å‡½æ•°ï¼Œè¿™æ ·å°±éœ€è¦åœ¨æ–‡ä»¶ä¸­å†™å¤šä¸ª<code>require</code>æˆ–<code>import</code>ç›¸å…³å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> remove <span class="keyword">from</span> <span class="string">'lodash/remove'</span></span><br><span class="line"><span class="keyword">import</span> uniq <span class="keyword">from</span> <span class="string">'lodash/uniq'</span></span><br><span class="line"><span class="keyword">import</span> invokeMap <span class="keyword">from</span> <span class="string">'lodash/invokeMap'</span></span><br><span class="line"><span class="keyword">import</span> sortBy <span class="keyword">from</span> <span class="string">'lodash/sortBy'</span></span><br><span class="line"><span class="comment">// more...</span></span><br></pre></td></tr></table></figure><p>æ­£å†™åˆ°å…³é”®å¤„å´å› ä¸ºå¼•å…¥ä¸€ä¸ªå‡½æ•°è¦æ‹‰åˆ°æ–‡ä»¶å¤´éƒ¨å»å®šä¹‰å¼•ç”¨è€Œæ‰“ä¹±äº†æ€è·¯ï¼Œå¾ˆä¸çˆ½ï¼</p><p>äºæ˜¯æˆ‘æœºæ™ºçš„åˆ° Github å»æœç´¢äº†webpackå’Œlodashä¸¤ä¸ªå…³é”®è¯çš„ç»„åˆï¼Œæ’åœ¨é¦–ä½çš„ lodash-webpack-plugin å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿã€‚</p><p>ä½¿ç”¨æ—¶éœ€è¦ä»¥ä¸‹æ¨¡å—ï¼Œå…¶å®é™¤äº†å‰ä¸¤ä¸ªå‰©ä¸‹çš„ä¸€èˆ¬éƒ½å·²å®‰è£…äº†ï¼š</p><p><code>$ npm i -S lodash-webpack-plugin babel-plugin-lodash babel-core babel-loader babel-preset-es2015 webpack</code><br><strong>é…ç½®ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">webpack.config.js</span><br><span class="line"><span class="keyword">var</span> LodashModuleReplacementPlugin = <span class="built_in">require</span>(<span class="string">'lodash-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      loader: <span class="string">'babel'</span>,</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      query: &#123;</span><br><span class="line">        plugins: [<span class="string">'transform-runtime'</span>, <span class="string">'lodash'</span>],</span><br><span class="line">        presets: [<span class="string">'es2015'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> LodashModuleReplacementPlugin,</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.OccurrenceOrderPlugin,</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>babel-plugin-lodash</code>çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯<code>plugins: [&#39;lodash&#39;]</code>ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦åœ¨<code>loaders</code>ä¸­ï¼Œä¹Ÿå¯ä»¥å•ç‹¬å®šä¹‰<code>babel</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">webpack.config.js</span><br><span class="line"><span class="keyword">var</span> LodashModuleReplacementPlugin = <span class="built_in">require</span>(<span class="string">'lodash-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      loader: <span class="string">'babel'</span>,</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  babel: &#123;</span><br><span class="line">    presets: [<span class="string">'es2015'</span>],</span><br><span class="line">    plugins: [<span class="string">'transform-runtime'</span>, <span class="string">'lodash'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> LodashModuleReplacementPlugin,</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.OccurrenceOrderPlugin,</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆæˆ–è€…æ˜¯<code>.babelrc</code>æ–‡ä»¶ä¸­ã€‚</p><p>ä»¥ä¸Šå·¥ä½œå®Œæˆäº†ï¼Œåœ¨æ¯ä¸ªä½ éœ€è¦ä½¿ç”¨ lodash å‡½æ•°çš„æ–‡ä»¶ä¸­åªéœ€è¦å¼•ç”¨ä¸€æ¬¡ lodashï¼Œå³å¯è°ƒç”¨ä»»æ„å‡½æ•°è€Œä¸ä¼šé€ æˆå®Œå…¨æ‰“åŒ…ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line">_.add(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment">// æ‰“åŒ…æ—¶åªä¼šå¼•å…¥è¿™ä¸€ä¸ªå‡½æ•°æ¨¡å—</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¿…é¡»è¦ä½¿ç”¨ ES2015 çš„æ¨¡å—å¼•ç”¨æ–¹å¼æ‰æœ‰æ•ˆã€‚</p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>ä»¥ä¸Šå³æ˜¯æˆ‘ç›®å‰æ‰€çŸ¥é“çš„å‡ ç§æ–¹å¼ï¼Œå¦‚æœå“ªä½æœ‹å‹æœ‰æ›´å¥½çš„æ–¹å¼ï¼ˆæ¯”å¦‚åªéœ€è¦å…¨å±€å¼•å…¥ä¸€æ¬¡ï¼‰ï¼Œè¯·ä¸€å®šåˆ†äº«ä¸æˆ‘ï¼ğŸ˜‹</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨æ•°æ®æ“ä½œæ—¶ï¼ŒLodash å°±æ˜¯æˆ‘çš„å¼¹è¯åº“ï¼Œä¸ç®¡é‡åˆ°å¤šå¤æ‚çš„æ•°æ®ç»“æ„éƒ½èƒ½ç”¨ä¸€äº›å‡½æ•°è½»æ¾æ‹†è§£ã€‚&lt;/p&gt;
&lt;p&gt;ES6 ä¸­ä¹Ÿæ–°å¢äº†è¯¸å¤šæ–°çš„å¯¹è±¡å‡½æ•°ï¼Œä¸€äº›ç®€å•çš„é¡¹ç›®ä¸­ ES6 å°±è¶³å¤Ÿä½¿ç”¨äº†ï¼Œä½†è¿˜æ˜¯ä¼šæœ‰ä¾‹å¤–çš„æƒ…å†µå¼•ç”¨äº†å°‘æ•°çš„ Lodash å‡½æ•°ã€‚ä¸€ä¸ªå®Œæ•´çš„ Lodash åº“ï¼Œå³ä½¿æ˜¯
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>æ­£ç¡®ä½¿ç”¨VueæŒ‡ä»¤çš„é’©å­å‡½æ•°</title>
    <link href="https://summxu.github.io/2019/vue-directive-hook/"/>
    <id>https://summxu.github.io/2019/vue-directive-hook/</id>
    <published>2019-03-24T07:28:24.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Vue ä¸­å¯ä»¥æŠŠä¸€ç³»åˆ—<strong>å¤æ‚çš„æ“ä½œ</strong>åŒ…è£…ä¸ºä¸€ä¸ªæŒ‡ä»¤ã€‚</p><blockquote><p><strong>ä»€ä¹ˆæ˜¯å¤æ‚çš„æ“ä½œï¼Ÿ</strong><br>æˆ‘çš„ç†è§£æ˜¯ï¼šå¤æ‚é€»è¾‘åŠŸèƒ½çš„åŒ…è£…ã€è¿èƒŒæ•°æ®é©±åŠ¨çš„ DOM æ“ä½œä»¥åŠå¯¹ä¸€äº› Hack æ‰‹æ®µçš„æ©ç›–ç­‰ã€‚æˆ‘ä»¬æ€»æ˜¯æœŸæœ›ä»¥æ“ä½œæ•°æ®çš„å½¢å¼æ¥å®ç°åŠŸèƒ½é€»è¾‘ã€‚</p></blockquote><h1 id="é’©å­å‡½æ•°"><a href="#é’©å­å‡½æ•°" class="headerlink" title="é’©å­å‡½æ•°"></a>é’©å­å‡½æ•°</h1><p>å¯¹äºè‡ªå®šä¹‰æŒ‡ä»¤çš„å®šä¹‰ï¼ŒVue2 æœ‰ 5 ä¸ªå¯é€‰çš„é’©å­å‡½æ•°ã€‚</p><ul><li>bind: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ï¼Œç”¨è¿™ä¸ªé’©å­å‡½æ•°å¯ä»¥å®šä¹‰ä¸€ä¸ªåœ¨ç»‘å®šæ—¶æ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–åŠ¨ä½œã€‚</li><li>inserted: è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼ˆçˆ¶èŠ‚ç‚¹å­˜åœ¨å³å¯è°ƒç”¨ï¼Œä¸å¿…å­˜åœ¨äº document ä¸­ï¼‰ã€‚</li><li>update: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨çš„æ¨¡æ¿æ›´æ–°æ—¶è°ƒç”¨ï¼Œè€Œä¸è®ºç»‘å®šå€¼æ˜¯å¦å˜åŒ–ã€‚</li><li>componentUpdated: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨æ¨¡æ¿å®Œæˆä¸€æ¬¡æ›´æ–°å‘¨æœŸæ—¶è°ƒç”¨ã€‚</li><li>unbind: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚<br>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„æŒ‡ä»¤ä»¥éªŒè¯è¿™äº›é’©å­å‡½æ•°çš„è§¦å‘æ—¶æœºã€‚<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-comp</span> <span class="attr">v-if</span>=<span class="string">"msg"</span> <span class="attr">:msg</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"update"</span>&gt;</span>æ›´æ–°<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"uninstall"</span>&gt;</span>å¸è½½<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"install"</span>&gt;</span>å®‰è£…<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'hello'</span>, &#123;</span><br><span class="line">    bind: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'bind'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'inserted'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'update'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    componentUpdated: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'componentUpdated'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    unbind: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'unbind'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> myComp = &#123;</span><br><span class="line">    template: <span class="string">'&lt;h1 v-hello&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;'</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        msg: <span class="built_in">String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        msg: <span class="string">'Hello'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        myComp: myComp</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        update: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.msg = <span class="string">'Hi'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        uninstall: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.msg = <span class="string">''</span></span><br><span class="line">        &#125;,</span><br><span class="line">        install: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.msg = <span class="string">'Hello'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="é¡µé¢åŠ è½½æ—¶"><a href="#é¡µé¢åŠ è½½æ—¶" class="headerlink" title="é¡µé¢åŠ è½½æ—¶"></a>é¡µé¢åŠ è½½æ—¶</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind</span><br><span class="line">inserted</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶æ›´æ–°æ—¶"><a href="#ç»„ä»¶æ›´æ–°æ—¶" class="headerlink" title="ç»„ä»¶æ›´æ–°æ—¶"></a>ç»„ä»¶æ›´æ–°æ—¶</h2><p>ç‚¹å‡»â€œæ›´æ–°â€æŒ‰é’®ï¼Œæ›´æ”¹æ•°æ®è§¦å‘ç»„ä»¶æ›´æ–°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update</span><br><span class="line">componentUpdated</span><br></pre></td></tr></table></figure><h2 id="å¸è½½ç»„ä»¶æ—¶"><a href="#å¸è½½ç»„ä»¶æ—¶" class="headerlink" title="å¸è½½ç»„ä»¶æ—¶"></a>å¸è½½ç»„ä»¶æ—¶</h2><p>ç‚¹å‡»â€œå¸è½½â€æŒ‰é’®ï¼Œæ•°æ®ç½®ç©ºå¦å®šåˆ¤æ–­ä»¥è§¦å‘ç»„ä»¶å¸è½½ã€‚</p><p><code>unbind</code></p><h2 id="é‡æ–°å®‰è£…ç»„ä»¶æ—¶"><a href="#é‡æ–°å®‰è£…ç»„ä»¶æ—¶" class="headerlink" title="é‡æ–°å®‰è£…ç»„ä»¶æ—¶"></a>é‡æ–°å®‰è£…ç»„ä»¶æ—¶</h2><p>ç‚¹å‡»â€œå®‰è£…â€æŒ‰é’®ï¼Œæ•°æ®èµ‹å€¼è‚¯å®šåˆ¤æ–­ä»¥è§¦å‘ç»„ä»¶é‡æ–°å®‰è£…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind</span><br><span class="line">inserted</span><br></pre></td></tr></table></figure><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p>ä»æ¡ˆä¾‹çš„è¿è¡Œä¸­ï¼Œå¯¹ 5 ä¸ªé’©å­å‡½æ•°çš„è§¦å‘æ—¶æœºæœ‰äº†åˆæ­¥çš„è®¤è¯†ã€‚å­˜ç–‘çš„ä¹Ÿå°±æ˜¯<code>bind</code>å’Œ<code>inserted</code>ã€<code>update</code>å’Œ<code>componentUpdated</code>çš„åŒºåˆ«äº†ã€‚</p><h3 id="bind-å’Œ-inserted"><a href="#bind-å’Œ-inserted" class="headerlink" title="bind å’Œ inserted"></a>bind å’Œ inserted</h3><p>æ®æ–‡æ¡£æ‰€è¯´ï¼Œæ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ insertedï¼Œæ¥ä¸ªæµ‹è¯•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bind: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el.parentNode)  <span class="comment">// null</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bind'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el.parentNode)  <span class="comment">// &lt;div id="app"&gt;...&lt;/div&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'inserted'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«åœ¨ä¸¤ä¸ªé’©å­å‡½æ•°ä¸­è¾“å‡ºçˆ¶èŠ‚ç‚¹ï¼š<strong>bind æ—¶çˆ¶èŠ‚ç‚¹ä¸º nullï¼Œinserted æ—¶çˆ¶èŠ‚ç‚¹å­˜åœ¨ã€‚</strong></p><h3 id="update-å’Œ-componentUpdated"><a href="#update-å’Œ-componentUpdated" class="headerlink" title="update å’Œ componentUpdated"></a><strong>update</strong> å’Œ <strong>componentUpdated</strong></h3><p>å…³äºè¿™ä¸¤ä¸ªçš„ä»‹ç»ï¼Œä»å­—çœ¼ä¸Šçœ‹æ„Ÿè§‰æ˜¯ç»„ä»¶æ›´æ–°å‘¨æœŸæœ‰å…³ï¼Œç»§ç»­éªŒè¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">update: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el.innerHTML)   <span class="comment">// Hello</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'update'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">componentUpdated: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el.innerHTML)   <span class="comment">// Hi</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'componentUpdated'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æ¯›ç—…ï¼Œ<strong>update å’Œ componentUpdated å°±æ˜¯ç»„ä»¶æ›´æ–°å‰å’Œæ›´æ–°åçš„åŒºåˆ«ã€‚</strong></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ–‡æ¡£è¯´çš„æ²¡é”™â€¦ğŸ˜’<br><a href="https://jsfiddle.net/imys/twbv0sov/1/" target="_blank" rel="noopener">Demo</a></p><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p>æ ¹æ®éœ€æ±‚çš„ä¸åŒï¼Œæˆ‘ä»¬è¦é€‰æ‹©æ°å½“çš„æ—¶æœºå»åˆå§‹åŒ–æŒ‡ä»¤ã€æ›´æ–°æŒ‡ä»¤è°ƒç”¨å‚æ•°ä»¥åŠé‡Šæ”¾æŒ‡ä»¤å­˜åœ¨æ—¶çš„å†…å­˜å ç”¨ç­‰ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„åœºæ™¯æ˜¯ï¼šç”¨æŒ‡ä»¤åŒ…è£…ä¸€äº›æ— ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ä»¥æ‰©å±•ç»„ä»¶åŠŸèƒ½ã€‚è€Œä¸€ä¸ªå¥å£®çš„åº“é€šå¸¸ä¼šåŒ…å«ï¼šåˆå§‹åŒ–å®ä¾‹ã€å‚æ•°æ›´æ–°å’Œé‡Šæ”¾å®ä¾‹èµ„æºå ç”¨ç­‰æ“ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'hello'</span>, &#123;</span><br><span class="line">    bind: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// åœ¨ bind é’©å­ä¸­åˆå§‹åŒ–åº“å®ä¾‹</span></span><br><span class="line">        <span class="comment">// å¦‚æœéœ€è¦ä½¿ç”¨çˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨ inserted é’©å­ä¸­æ‰§è¡Œ</span></span><br><span class="line">        el.__library__ = <span class="keyword">new</span> Library(el, binding.value)</span><br><span class="line">    &#125;,</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡ç‰ˆæ›´æ–°æ„å‘³ç€æŒ‡ä»¤çš„å‚æ•°å¯èƒ½è¢«æ”¹å˜ï¼Œè¿™é‡Œå¯ä»¥å¯¹åº“å®ä¾‹çš„å‚æ•°ä½œæ›´æ–°</span></span><br><span class="line">        <span class="comment">// é…Œæƒ…ä½¿ç”¨ update æˆ– componentUpdated é’©å­</span></span><br><span class="line">        el.__library__.setOptions(<span class="built_in">Object</span>.assign(binding.oldValue, binding.value))</span><br><span class="line">    &#125;,</span><br><span class="line">    unbind: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾å®ä¾‹</span></span><br><span class="line">        el.__library__.destory()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ Vue ä¸­å¯ä»¥æŠŠä¸€ç³»åˆ—&lt;strong&gt;å¤æ‚çš„æ“ä½œ&lt;/strong&gt;åŒ…è£…ä¸ºä¸€ä¸ªæŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯å¤æ‚çš„æ“ä½œï¼Ÿ&lt;/strong&gt;&lt;br&gt;æˆ‘çš„ç†è§£æ˜¯ï¼šå¤æ‚é€»è¾‘åŠŸèƒ½çš„åŒ…è£…ã€è¿èƒŒæ•°æ®é©±åŠ¨çš„ DOM æ“ä½œä»¥åŠå¯¹ä¸€äº› Hack æ‰‹æ®µ
      
    
    </summary>
    
    
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨é˜Ÿåˆ—è§£å†³æ’é˜Ÿä¸šåŠ¡åœºæ™¯</title>
    <link href="https://summxu.github.io/2019/queue-solve-continuous/"/>
    <id>https://summxu.github.io/2019/queue-solve-continuous/</id>
    <published>2019-03-01T01:02:36.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†è¾¾åˆ°æ“ä½œå˜åŒ–çš„å®æ—¶æ€§ï¼Œåœ¨å¤šé€‰æ‹©é¡¹çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€ç‚¹å‡»ä¸€æ¬¡å°±ä¼šå‘é€ä¸€æ¬¡ HTTP è¯·æ±‚ã€‚<br>ä½†åŒæ—¶åˆé¢ä¸´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿ç»­ç‚¹å‡»åŒä¸€ä¸ªé€‰æ‹©é¡¹æ—¶ï¼Œå°±ä¼šè¿ç»­è§¦å‘é’ˆå¯¹æ­¤é¡¹çš„åˆ é™¤æˆ–æ·»åŠ é€»è¾‘ï¼Œè¿›è€Œè¿ç»­å‘é€ POST æˆ– DELETE è¯·æ±‚ã€‚<br>ç†æƒ³çš„çŠ¶æ€æ˜¯ä¸Šä¸€ä¸ªè¯·æ±‚ç»“æŸåæ‰å¼€å§‹ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç½‘ç»œè¯·æ±‚æ˜¯å¼‚æ­¥çš„ã€è¯·æ±‚è€—æ—¶æ˜¯ä¸å¯æ§çš„ï¼Œä¹Ÿå°±æœ‰å¯èƒ½åœ¨æ­¤é¡¹çš„æ·»åŠ è¯·æ±‚æœªå®Œæˆå‰ï¼Œåˆ é™¤è¯·æ±‚å…ˆå®Œæˆäº†ã€‚</p><p>æˆ‘è§‰å¾—ç”¨â€œæ’é˜Ÿâ€æ¥æè¿°è¿™ä¸ªåœºæ™¯çœŸæ˜¯å†å¥½ä¸è¿‡äº†ã€‚</p><h1 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h1><p>æ—¢ç„¶æœ‰äººè¦â€œæ’é˜Ÿâ€ï¼Œæˆ‘ä»¬å°±è¦å®šä¹‰ä¸€ä¸ªè§„åˆ™ï¼šå…ˆè¿›å…ˆå‡ºã€‚<br>ä¹Ÿå°±æ˜¯æ•°æ®ç»“æ„ä¸­çš„â€œé˜Ÿåˆ—â€äº†ã€‚</p><p>javascript ä¸­é˜Ÿåˆ—çš„å®ç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç°1</span></span><br><span class="line"><span class="keyword">var</span> queue = []</span><br><span class="line"><span class="comment">// è¿›é˜Ÿ</span></span><br><span class="line">queue.push(<span class="number">1</span>)</span><br><span class="line">queue.push(<span class="number">2</span>)</span><br><span class="line">queue.push(<span class="number">3</span>)</span><br><span class="line"><span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">queue.shift() <span class="comment">// 1</span></span><br><span class="line">queue.shift() <span class="comment">// 2</span></span><br><span class="line">queue.shift() <span class="comment">// 3</span></span><br><span class="line"><span class="comment">// å®ç°2</span></span><br><span class="line"><span class="keyword">var</span> queue2 = []</span><br><span class="line"><span class="comment">// è¿›é˜Ÿ</span></span><br><span class="line">queue2.unshift(<span class="number">1</span>)</span><br><span class="line">queue2.unshift(<span class="number">2</span>)</span><br><span class="line">queue2.unshift(<span class="number">3</span>)</span><br><span class="line"><span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">queue2.pop() <span class="comment">// 1</span></span><br><span class="line">queue2.pop() <span class="comment">// 2</span></span><br><span class="line">queue2.pop() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><p>å®šä¹‰ä¸€ä¸ªæ•°ç»„å­˜æ”¾æ¯ä¸€æ¬¡ç‚¹å‡»çš„ HTTP è¯·æ±‚ï¼Œæ­¤å¤–ä¸ç®¡ä½ ä½¿ç”¨ä½•ç§å¼€å‘æŠ€æœ¯éƒ½åº”è¯¥æœ‰ä¸ªå‘é€è¯·æ±‚çš„å‡½æ•°æˆ–åº“ï¼Œå¦‚æœæ˜¯åŸºäº promise å°±æ›´å¥½äº†ï¼Œè¿™é‡Œç®€å•ç”¨ XHR ä»£æ›¿ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> requestQueue = []</span><br><span class="line"><span class="keyword">var</span> XHR = <span class="function"><span class="keyword">function</span>(<span class="params">method, url, param</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»æ“ä½œçš„å…¥å£å‡½æ•°ï¼Œå…ˆåˆ›å»ºè¯·æ±‚è¿›é˜Ÿã€‚<br>å› ä¸ºç¬¬äºŒæ¬¡è¯·æ±‚å¿…é¡»è¦åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚å®Œæˆä¹‹åï¼Œæ‰€ä»¥åªæœ‰é˜Ÿåˆ—ä¸­ä»…å­˜åœ¨ä¸€ä¸ªè¯·æ±‚æ—¶æ‰å»è§¦å‘æ›´æ–°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myClick</span>(<span class="params">method, url, param</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = requestQueue.push(XHR(method, url, param))</span><br><span class="line">    <span class="keyword">if</span>(len === <span class="number">1</span>) &#123;</span><br><span class="line">        update()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œçš„æ°¸è¿œæ˜¯é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ã€‚<br>å½“ä¸€ä¸ªè¯·æ±‚å®Œæˆåï¼Œå°±å‡ºé˜Ÿï¼Œé˜Ÿåˆ—ä¸­å‰©ä½™çš„è¯·æ±‚ä¾æ¬¡å‰è¿›ä¸€ä¸ªä½ç½®ã€‚<br>å¦‚æœå­˜åœ¨æœªå®Œæˆçš„è¯·æ±‚ï¼Œç»§ç»­è°ƒç”¨æ›´æ–°æ“ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    requestQueue[<span class="number">0</span>].then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// request success</span></span><br><span class="line">        requestQueue.shift()</span><br><span class="line">        requestQueue.length &amp;&amp; update()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸ºäº†è¾¾åˆ°æ“ä½œå˜åŒ–çš„å®æ—¶æ€§ï¼Œåœ¨å¤šé€‰æ‹©é¡¹çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€ç‚¹å‡»ä¸€æ¬¡å°±ä¼šå‘é€ä¸€æ¬¡ HTTP è¯·æ±‚ã€‚&lt;br&gt;ä½†åŒæ—¶åˆé¢ä¸´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿ç»­ç‚¹å‡»åŒä¸€ä¸ªé€‰æ‹©é¡¹æ—¶ï¼Œå°±ä¼šè¿ç»­è§¦å‘é’ˆå¯¹æ­¤é¡¹çš„åˆ é™¤æˆ–æ·»åŠ é€»è¾‘ï¼Œè¿›è€Œè¿ç»­å‘é€ POST æˆ– DELETE è¯·æ±‚ã€‚&lt;br&gt;ç†æƒ³çš„çŠ¶æ€æ˜¯ä¸Šä¸€ä¸ªè¯·æ±‚ç»“æŸå
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä¸ºCanvasä¸­ç‰¹å®šå›¾å½¢ç»‘å®šäº‹ä»¶ï¼Ÿ</title>
    <link href="https://summxu.github.io/2019/canvas-event/"/>
    <id>https://summxu.github.io/2019/canvas-event/</id>
    <published>2019-02-14T10:47:15.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>Canvas æœ¬èº«ä¹Ÿå±äº HTMLElementï¼Œè‡ªç„¶ä¹Ÿæ˜¯æ”¯æŒå„ç§äº‹ä»¶ç»‘å®šçš„ã€‚<br>ä½†ç»˜åˆ¶åœ¨å…¶ä¸­çš„å›¾å½¢å¹¶ä¸ä½œä¸ºå…¶å­å…ƒç´ å­˜åœ¨ï¼Œè¿™å°±ä¸èƒ½æ–¹ä¾¿çš„ä¸º Canvas ä¸­çš„æŸä¸ªç‰¹å®šå›¾å½¢å»ç»‘å®šäº‹ä»¶ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ js ä¸­çš„äº‹ä»¶å§”æ‰˜ï¼Œå°†äº‹ä»¶ç»‘å®šåˆ°çˆ¶èŠ‚ç‚¹ä¸Šï¼Œå¾…åˆ°çˆ¶èŠ‚ç‚¹å“åº”äº‹ä»¶æ—¶ï¼ŒåŠ¨æ€åˆ¤æ–­å½“å‰å“åº”å…ƒç´ ä¸ºç›®æ ‡å­èŠ‚ç‚¹æ—¶å†æ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚</p><p>è¿™ä¸ªæ€æƒ³åŒæ ·ä¹Ÿå¯ä»¥ç”¨åœ¨ Canvas ä¸Šï¼Œåªéœ€è¦ä¸º <code>canvas</code> å…ƒç´ ç»‘å®šäº‹ä»¶ï¼Œäº‹ä»¶å“åº”æ—¶åˆ¤æ–­å½“å‰é¼ æ ‡ä½ç½®å¤„äºå“ªä¸ªå›¾å½¢ä¹‹ä¸Šï¼Œæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚</p><h1 id="isPointInPath"><a href="#isPointInPath" class="headerlink" title="isPointInPath"></a>isPointInPath</h1><p><code>context.isPointInPath(x, y);</code></p><p>ç†è®ºä¸Šè®²ï¼Œæƒ³è¦çŸ¥é“ä¸€ä¸ªç‚¹æ˜¯å¦å¤„äºä¸€ä¸ªå›¾å½¢ä¹‹ä¸­ï¼Œç°æˆçš„ç®—æ³•åº”è¯¥æ˜¯æœ‰å¾ˆå¤šäº†ã€‚ä¸è¿‡éš¾å¾— canvas æœ¬èº«å°±æä¾›äº†è¿™æ ·çš„å‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦å¤„äºå½“å‰è·¯å¾„ä¸­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = c.getContext(<span class="string">'2d'</span>);</span><br><span class="line">ctx.rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ctx.isPointInPath(<span class="number">50</span>, <span class="number">100</span>))  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å°±åƒè¿™æ ·ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªçŸ©å½¢æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªè·¯å¾„ï¼Œæ­¤æ—¶å°±å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•å»åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦å­˜åœ¨äºè¯¥è·¯å¾„ã€‚</p><p>äº§ç”Ÿè·¯å¾„çš„å‡½æ•°è¿˜æœ‰å…¶ä»–ï¼Œæ¯”å¦‚ï¼š<code>lineTo()</code>ã€<code>clip()</code>ã€<code>arc()</code>ã€<code>arcTo()</code> ç­‰ã€‚</p><h1 id="å®ç°å›¾å½¢çš„äº‹ä»¶ç»‘å®š"><a href="#å®ç°å›¾å½¢çš„äº‹ä»¶ç»‘å®š" class="headerlink" title="å®ç°å›¾å½¢çš„äº‹ä»¶ç»‘å®š"></a>å®ç°å›¾å½¢çš„äº‹ä»¶ç»‘å®š</h1><p>å…ˆæ¥ä¸ªç®€å•çš„é¥¼å›¾å§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'c'</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"><span class="keyword">var</span> r = canvas.width / <span class="number">2</span>;</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.arc(r, r, r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">1</span>);</span><br><span class="line">ctx.fillStyle = <span class="string">'#2196f3'</span>; <span class="comment">//è“è‰²</span></span><br><span class="line">ctx.fill();</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.arc(r, r, r, <span class="built_in">Math</span>.PI * <span class="number">1</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</span><br><span class="line">ctx.fillStyle = <span class="string">'#f44336'</span>; <span class="comment">//çº¢è‰²</span></span><br><span class="line">ctx.fill();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isInPath</span> (<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">    ctx.arc(r, r, r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> ctx.isPointInPath(x, y);</span><br><span class="line">&#125;</span><br><span class="line">canvas.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isInPath(e.offsetX, e.offsetY)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç°åœ¨åˆ›å»ºä¸€ä¸ªçº¢è“æ‹¼æ¥çš„é¥¼å›¾ï¼Œ<code>isInPath</code> æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦å¤„äºè“è‰²åŒºã€‚ç†æƒ³çš„ç»“æœæ˜¯åªæœ‰å½“é¼ æ ‡ç‚¹å‡»åŒºåŸŸä¸ºè“è‰²åŒºåŸŸæ—¶æ‰è¾“å‡º<code>helloã€‚</code></p><p>ä½†äº‹å®ç¡®ä¸æ˜¯å¦‚æ­¤ï¼Œç¤ºä¾‹Demoã€‚æ— è®ºç‚¹å‡»çº¢è‰²è¿˜æ˜¯è“è‰²åŒºåŸŸå‡ä¼šè¾“å‡º <code>hello</code>ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢</p><h2 id="è·¯å¾„"><a href="#è·¯å¾„" class="headerlink" title="è·¯å¾„"></a>è·¯å¾„</h2><p>æ—¢ç„¶ <code>isPointInPath(x, y)</code> çš„åŸºäºè·¯å¾„åˆ¤æ–­çš„ï¼Œé‚£æˆ‘ä»¬å°±ä»è·¯å¾„å…¥æ‰‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctx.arc(r, r, r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">1</span>);</span><br><span class="line">ctx.fillStyle = <span class="string">'#2196f3'</span>;</span><br><span class="line">ctx.fill();</span><br><span class="line">ctx.arc(r, r, r, <span class="built_in">Math</span>.PI * <span class="number">1</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</span><br><span class="line">ctx.fillStyle = <span class="string">'#f44336'</span>;</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æŠŠç”»å›¾æ—¶çš„ <code>ctx.beginPath()</code> å»æ‰åï¼Œå‘ç°ç”Ÿæˆçš„å›¾å½¢å˜æˆä¸€ä¸ªçº¢è‰²çš„æ•´åœ†äº†ï¼šç¤ºä¾‹Demoã€‚</p><p><code>beginPath()</code> ç”¨æ¥é‡ç½®è·¯å¾„ï¼Œç”±äºç¬¬ä¸€ä¸ªåŠåœ†ç”»å®Œè·¯å¾„æœªé‡ç½®ï¼Œç¬¬äºŒä¸ªåŠåœ†å°±ç»˜åˆ¶äº†ä¸¤æ¡è·¯å¾„ã€‚è¿™ä¼¼ä¹è§£é‡Šäº†ä¸Šä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚</p><p>åœ¨ <code>isInPath(x, y)</code>å‡½æ•°ä¸­ï¼Œç”±äºè·¯å¾„æ²¡æœ‰é‡ç½®ï¼Œæ‰€ä»¥æœ€ç»ˆæœ€ç»ˆåˆ¤æ–­çš„ä¸æ­¢æ˜¯ <code>ctx.arc(r, r, r, 0, Math.PI * 1)</code> è¿™ä¸ªè·¯å¾„ï¼Œè¿˜æœ‰æ–¹æ³•å¤–çš„ç”»çº¢è‰²åœ†çš„è·¯å¾„ã€‚ä¸¤ä¸ªè·¯å¾„åŠ ä¸€èµ·è‡ªç„¶å°±æ˜¯ä¸ªæ•´åœ†ï¼Œæ‰€ä»¥æ— è®ºè“è‰²åŒºè¿˜æ˜¯çº¢è‰²åŒºéƒ½ä¼šè¾“å‡ºã€‚</p><h2 id="æ­£ç¡®ç»“æœ"><a href="#æ­£ç¡®ç»“æœ" class="headerlink" title="æ­£ç¡®ç»“æœ"></a>æ­£ç¡®ç»“æœ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isInPath</span> (<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.arc(r, r, r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> ctx.isPointInPath(x, y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>isInPath</code> å‡½æ•°ï¼ŒåŠ å…¥é‡ç½®è·¯å¾„ï¼Œç»“æœæ­£ç¡®è¾“å‡º</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Canvas æœ¬èº«ä¹Ÿå±äº HTMLElementï¼Œè‡ªç„¶ä¹Ÿæ˜¯æ”¯æŒå„ç§äº‹ä»¶ç»‘å®šçš„ã€‚&lt;br&gt;ä½†ç»˜åˆ¶åœ¨å…¶ä¸­çš„å›¾å½¢å¹¶ä¸ä½œä¸ºå…¶å­å…ƒç´ å­˜åœ¨ï¼Œè¿™å°±ä¸èƒ½æ–¹ä¾¿çš„ä¸º Canvas ä¸­çš„æŸä¸ªç‰¹å®šå›¾å½¢å»ç»‘å®šäº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ js ä¸­çš„äº‹ä»¶å§”æ‰˜ï¼Œå°†äº‹ä»¶ç»‘å®šåˆ°çˆ¶èŠ‚ç‚¹ä¸Šï¼Œå¾…åˆ°çˆ¶èŠ‚ç‚¹å“åº”äº‹ä»¶
      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Vueç»„ä»¶é—´æ ·å¼æ±¡æŸ“å¤§å‘</title>
    <link href="https://summxu.github.io/2018/vue-scoped-keng/"/>
    <id>https://summxu.github.io/2018/vue-scoped-keng/</id>
    <published>2018-12-03T16:00:00.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒVue ç»„ä»¶å†…çš„æ ·å¼å¯ä»¥å†™åœ¨ Style æ ‡ç­¾ä¸‹ï¼Œè€Œå„ç»„ä»¶ä¹‹é—´çš„æ ·å¼å†²çª(æ±¡æŸ“)é—®é¢˜ä¹Ÿååˆ†å¸¸è§ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥å°½é‡é¿å…èµ·ç›¸åŒçš„ç±»åï¼Œä½†é¡¹ç›®è¾ƒå¤§çš„æ—¶å€™ï¼ŒClassç±»åæ—¶è€Œä¼šå†²çªã€‚</p><p>å½“ç„¶ Vueå®˜æ–¹ä¹Ÿç»™äº†æˆ‘ä»¬è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯å®šä¹‰äº† scoped è¿™ä¸ªå±æ€§çš„è®¾ç½®ï¼š</p><blockquote><p>è¿™ä¸ªå¯é€‰ scoped å±æ€§ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„å±æ€§ (æ¯”å¦‚ data-v-21e5b78) ä¸ºç»„ä»¶å†… CSS æŒ‡å®šä½œç”¨åŸŸï¼Œç¼–è¯‘çš„æ—¶å€™ .list-container:hover ä¼šè¢«ç¼–è¯‘æˆç±»ä¼¼ .list-container[data-v-21e5b78]:hoverã€‚</p></blockquote><blockquote><p>æœ€åï¼ŒVue çš„å•æ–‡ä»¶ç»„ä»¶é‡Œçš„æ ·å¼è®¾ç½®æ˜¯éå¸¸çµæ´»çš„ã€‚é€šè¿‡ vue-loaderï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»æ„é¢„å¤„ç†å™¨ã€åå¤„ç†å™¨ï¼Œç”šè‡³æ·±åº¦é›†æˆ CSS Modulesâ€”â€”å…¨éƒ¨éƒ½åœ¨ <style> æ ‡ç­¾å†…ã€‚</p></blockquote><p>ä½†æ˜¯é—®é¢˜å°±åœ¨äº <strong>è™½ç„¶åŠ äº†scoped,ä½†æ˜¯å´ä»çƒ­æ— æ³•é”ä½ç”¨@importå¼•å…¥çš„å¤–éƒ¨cssæ–‡ä»¶</strong></p><p>è¿™é‡Œçš„è§£å†³æ–¹æ³•ä¹Ÿæ¯”è¾ƒç¥å¥‡ï¼Œå°±æ˜¯æŠŠå¼•å…¥çš„cssæ–‡ä»¶æ”¹ä¸ºä½¿ç”¨é¢„å¤„ç†å™¨å¤„ç†çš„ less sass æˆ–è€… styl æ–‡ä»¶ï¼Œå…·ä½“åŸç†æš‚æ—¶è¿˜ä¸å¾—è€ŒçŸ¥</p><p>ä½¿ç”¨ /deep/ æ¥è§£å†³æ›´æ·±ä¸€çº§çš„æ ‡ç­¾</p></style></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒVue ç»„ä»¶å†…çš„æ ·å¼å¯ä»¥å†™åœ¨ Style æ ‡ç­¾ä¸‹ï¼Œè€Œå„ç»„ä»¶ä¹‹é—´çš„æ ·å¼å†²çª(æ±¡æŸ“)é—®é¢˜ä¹Ÿååˆ†å¸¸è§ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥å°½é‡é¿å…èµ·ç›¸åŒçš„ç±»åï¼Œä½†é¡¹ç›®è¾ƒå¤§çš„æ—¶å€™ï¼ŒClassç±»åæ—¶è€Œä¼šå†²çªã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ Vueå®˜æ–¹ä¹Ÿç»™äº†æˆ‘ä»¬è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯å®šä¹‰äº† scoped è¿™ä¸ªå±æ€§çš„
      
    
    </summary>
    
    
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Vue.$emit Promise å›è°ƒåçš„æ·±å‘</title>
    <link href="https://summxu.github.io/2018/vue-emit-keng/"/>
    <id>https://summxu.github.io/2018/vue-emit-keng/</id>
    <published>2018-09-24T16:00:00.000Z</published>
    <updated>2023-08-25T10:01:39.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ‰ä¸ªç™»å½•éœ€æ±‚ï¼Œæ˜¯ login.vue å±äº App.vue çš„å­ç»„ä»¶ï¼Œé»˜è®¤è·¯ç”±é¡µé¢æ˜¯è¿›å…¥ login.vue å› ä¸ºä½ ä¸€å¼€å§‹éœ€è¦éªŒè¯ç™»å½•ç”¨æˆ·ï¼Œåˆè¦é€šè¿‡ç™»å½•ç”¨æˆ·æ¥è¿›è¡Œ</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ‰ä¸ªç™»å½•éœ€æ±‚ï¼Œæ˜¯ login.vue å±äº App.vue çš„å­ç»„ä»¶ï¼Œé»˜è®¤è·¯ç”±é¡µé¢æ˜¯è¿›å…¥ login.vue å› ä¸ºä½ ä¸€å¼€å§‹éœ€è¦éªŒè¯ç™»å½•ç”¨æˆ·ï¼Œåˆè¦é€šè¿‡ç™»å½•ç”¨æˆ·æ¥è¿›è¡Œ&lt;/p&gt;
&lt;/blockquote&gt;

      
    
    </summary>
    
    
    
      <category term="JavaScript" scheme="https://summxu.github.io/tags/JavaScript/"/>
    
      <category term="Vue" scheme="https://summxu.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Express + æ¨¡æ¿å¼•æ“ + jQuery load å®ç°å±€éƒ¨é¡µé¢çš„å¼‚æ­¥åŠ è½½</title>
    <link href="https://summxu.github.io/2018/express-jqueryload/"/>
    <id>https://summxu.github.io/2018/express-jqueryload/</id>
    <published>2018-09-11T16:00:00.000Z</published>
    <updated>2023-08-25T10:01:39.582Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é¡¹ç›®åŒ¿åè¯„è®ºç³»ç»Ÿçš„å±€éƒ¨å¼‚æ­¥åŠ è½½æœåŠ¡çš„å®ç°</p></blockquote><h2 id="é—®é¢˜éœ€æ±‚"><a href="#é—®é¢˜éœ€æ±‚" class="headerlink" title="é—®é¢˜éœ€æ±‚"></a>é—®é¢˜éœ€æ±‚</h2><p>ç›®å‰çš„è®ºå›ç³»ç»Ÿå¸¦æœ‰èŠå¤©å®¤ï¼Œåœ¨æµè§ˆå¸–å­çš„åŒæ—¶å¯ä»¥éšæ—¶èŠå¤©ï¼Œè¿™å°±æ„å‘³ç€é¡µé¢ä¸èƒ½ç»å¸¸åˆ·æ–°ï¼Œä¸€æ˜¯åˆ·æ–°å°±ä¼šé‡è¿æœåŠ¡å™¨ï¼Œå¯¼è‡´ä¸€ç›´æ–­å¼€é‡è¿çš„çŠ¶æ€ï¼ŒäºŒæ˜¯åˆ·æ–°ä¹‹åèŠå¤©è®°å½•æ¶ˆå¤±ï¼Œè¿˜è¦åšæ•°æ®çš„æŒä¹…åŒ–ï¼Œå†è€…å°±æ˜¯å½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å¼‚æ­¥åŠ è½½å±€éƒ¨é¡µé¢ã€‚å‰åç«¯åˆ†ç¦»æ˜¯æŒºå¥½åšï¼Œç›´æ¥loadåŠ è½½æœ¬åœ°é¡µé¢å°±å¯ä»¥ï¼Œä½†ä¸€å’Œexpressç»“åˆèµ·æ¥å°±ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠäº†ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://p5oqx8gut.bkt.clouddn.com/18-9-12/5563645.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å…¶å®ä»”ç»†æ€è€ƒè¿™ä¸ªé—®é¢˜å¹¶ä¸å¤æ‚ï¼Œå’Œå‰åç«¯åˆ†ç¦»çš„æ¨¡å¼æ˜¯å®Œå…¨ä¸€æ¨¡ä¸€æ ·çš„ï¼Œ<strong>åªæ˜¯æŠŠæœ¬åœ°è¦åŠ è½½çš„å±€éƒ¨é¡µé¢æ¢æˆäº†æœåŠ¡å™¨ä¸Šæ¸²æŸ“å‡ºæ¥çš„å±€éƒ¨é¡µé¢</strong> ã€‚ è¿™æ—¶å°±éœ€è¦é‡æ–°é…ç½®expressçš„è·¯ç”±å’Œ render çš„é¡µé¢åˆ†ç¦»ï¼Œè·¯ç”±å¤šäº†ä¸¤æ¡ï¼š </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.get(<span class="string">'/main'</span>,(req,res) =&gt; &#123;</span><br><span class="line">  mongo.Post.find(<span class="function">(<span class="params">err, postdata</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.status(<span class="number">500</span>)</span><br><span class="line">    <span class="comment">/* å¯¹è±¡å±æ€§æŠ½ç¦»ï¼Œè§£å†³templateé™·å…¥é€’å½’ */</span></span><br><span class="line">    <span class="comment">/* mogonå–å‡ºçš„å¯¹è±¡ä¸æ­£å¸¸ï¼Œè½¬æ¢ä¸€ä¸‹ */</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.stringify(postdata)</span><br><span class="line">    data = <span class="built_in">JSON</span>.parse(data)</span><br><span class="line">    <span class="keyword">var</span> images = []</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">element, a</span>) =&gt;</span> &#123;</span><br><span class="line">      images.push(element.images)</span><br><span class="line">      <span class="keyword">delete</span> element.images</span><br><span class="line">    &#125;);</span><br><span class="line">    res.render(<span class="string">'./components/main.html'</span>, &#123;</span><br><span class="line">      post: data,</span><br><span class="line">      images: images</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.get(<span class="string">'/sendpost'</span>,(req,res) =&gt; &#123;</span><br><span class="line">  res.render(<span class="string">'./components/sendpost.html'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“å‡ºç‹¬ç«‹é¡µé¢ï¼Œè¿™æ˜¯å„ä¸ªé¡µé¢çš„è·¯å¾„åˆ†é…ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://p5oqx8gut.bkt.clouddn.com/18-9-12/52866315.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>è¿™æ ·ä¸¤ä¸ªåœ¨æœåŠ¡å™¨è·¯å¾„ä¸­çœŸå®å­˜åœ¨çš„é¡µé¢å‡ºæ¥äº†ï¼Œé€šè¿‡æµè§ˆå™¨ä¹Ÿèƒ½è®¿é—®ï¼Œåªä¸è¿‡æ²¡äº†æ ·å¼ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://p5oqx8gut.bkt.clouddn.com/18-9-12/99119243.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://p5oqx8gut.bkt.clouddn.com/18-9-12/67452684.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>åœ¨å®¢æˆ·ç«¯ä¸Šå†™ä¸Šè¿™ä¹ˆä¸€å¥ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼ï¼</p><p><code>$(&#39;.center .left&#39;).load(&quot;/main&quot;);</code><br><code>$(&#39;.center .left&#39;).load(&quot;/sendpost&quot;);</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®åŒ¿åè¯„è®ºç³»ç»Ÿçš„å±€éƒ¨å¼‚æ­¥åŠ è½½æœåŠ¡çš„å®ç°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é—®é¢˜éœ€æ±‚&quot;&gt;&lt;a href=&quot;#é—®é¢˜éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜éœ€æ±‚&quot;&gt;&lt;/a&gt;é—®é¢˜éœ€æ±‚&lt;/h2&gt;&lt;p&gt;ç›®å‰çš„è®ºå›ç³»ç»Ÿ
      
    
    </summary>
    
    
    
      <category term="jQuery" scheme="https://summxu.github.io/tags/jQuery/"/>
    
      <category term="Node.js" scheme="https://summxu.github.io/tags/Node-js/"/>
    
  </entry>
  
</feed>
